ESTRUCTURA DEL PROJECTE (./src)

â”œâ”€â”€ actions
â”‚   â””â”€â”€ contact.ts
â”œâ”€â”€ adapters
â”‚   â”œâ”€â”€ google
â”‚   â”‚   â””â”€â”€ PageSpeedAdapter.ts
â”‚   â”œâ”€â”€ GooglePageSpeedAdapter.ts
â”‚   â”œâ”€â”€ interfaces
â”‚   â””â”€â”€ IWebScanner.ts
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ actions
â”‚   â”‚   â””â”€â”€ get-users.ts
â”‚   â”œâ”€â”€ api
â”‚   â”‚   â”œâ”€â”€ track
â”‚   â”‚   â””â”€â”€ web-audit
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ manifest.ts
â”‚   â”œâ”€â”€ robots.ts
â”‚   â”œâ”€â”€ sitemap.ts
â”‚   â””â”€â”€ [locale]
â”‚       â”œâ”€â”€ (marketing)
â”‚       â”‚   â”œâ”€â”€ blog
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â”‚   â””â”€â”€ [slug]
â”‚       â”‚   â”‚       â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â”œâ”€â”€ legal
â”‚       â”‚   â”‚   â”œâ”€â”€ avis-legal
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ cookies
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”‚   â””â”€â”€ privacitat
â”‚       â”‚   â”‚       â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â””â”€â”€ projectes
â”‚       â”‚       â””â”€â”€ page.tsx
â”‚       â”œâ”€â”€ admin
â”‚       â”‚   â”œâ”€â”€ analytics
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ debug
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â””â”€â”€ users
â”‚       â”‚       â””â”€â”€ page.tsx
â”‚       â”œâ”€â”€ auth
â”‚       â”‚   â”œâ”€â”€ callback
â”‚       â”‚   â”‚   â””â”€â”€ route.ts
â”‚       â”‚   â”œâ”€â”€ forgot-password
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ login
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ register
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â””â”€â”€ reset-password
â”‚       â”‚       â””â”€â”€ page.tsx
â”‚       â”œâ”€â”€ dashboard
â”‚       â”‚   â”œâ”€â”€ audits
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â”‚   â””â”€â”€ [id]
â”‚       â”‚   â”‚       â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â”œâ”€â”€ MobilBottomBar.tsx
â”‚       â”‚   â”œâ”€â”€ new-audit
â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â””â”€â”€ page.tsx
â”‚       â””â”€â”€ layout.tsx
â”œâ”€â”€ assets
â”‚   â””â”€â”€ images
â”‚       â”œâ”€â”€ hero.webp
â”‚       â”œâ”€â”€ og-image.jpg
â”‚       â”œâ”€â”€ pantalla-ribotflow.jpg
â”‚       â”œâ”€â”€ pantalla-salutflow.jpg
â”‚       â”œâ”€â”€ ribotflow.png
â”‚       â”œâ”€â”€ salutflow.png
â”‚       â””â”€â”€ testimoni-garatgeestacio.jpg
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ admin
â”‚   â”‚   â””â”€â”€ AminMobileMenu.tsx
â”‚   â”œâ”€â”€ charts
â”‚   â”‚   â””â”€â”€ ScoreRing.tsx
â”‚   â”œâ”€â”€ dashboard
â”‚   â”‚   â”œâ”€â”€ AuditCard.tsx
â”‚   â”‚   â”œâ”€â”€ DashboardHeader.tsx
â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”œâ”€â”€ landing
â”‚   â”‚   â”œâ”€â”€ AuditSection.tsx
â”‚   â”‚   â”œâ”€â”€ BenefitsSection.tsx
â”‚   â”‚   â”œâ”€â”€ ContactSection.tsx
â”‚   â”‚   â”œâ”€â”€ HeroSection.tsx
â”‚   â”‚   â”œâ”€â”€ ProblemSolutionsSection.tsx
â”‚   â”‚   â”œâ”€â”€ ProductTeaser.tsx
â”‚   â”‚   â”œâ”€â”€ ServicesGrid.tsx
â”‚   â”‚   â”œâ”€â”€ SocialSection.tsx
â”‚   â”‚   â”œâ”€â”€ TechStackSection.tsx
â”‚   â”‚   â””â”€â”€ TestimonialsSection.tsx
â”‚   â”œâ”€â”€ layout
â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ LegalLayout.tsx
â”‚   â”‚   â””â”€â”€ Navbar.tsx
â”‚   â”œâ”€â”€ theme-provider.tsx
â”‚   â””â”€â”€ ui
â”‚       â”œâ”€â”€ button.tsx
â”‚       â”œâ”€â”€ card.tsx
â”‚       â”œâ”€â”€ checkbox.tsx
â”‚       â”œâ”€â”€ input.tsx
â”‚       â””â”€â”€ theme-toggle.tsx
â”œâ”€â”€ features
â”‚   â”œâ”€â”€ analytics
â”‚   â”‚   â”œâ”€â”€ actions.ts
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â”œâ”€â”€ AnalyticsTracker.tsx
â”‚   â”‚       â”œâ”€â”€ BarListChart.tsx
â”‚   â”‚       â”œâ”€â”€ DeviceChart.tsx
â”‚   â”‚       â”œâ”€â”€ TopPagesCard.tsx
â”‚   â”‚       â”œâ”€â”€ TrafficChart.tsx
â”‚   â”‚       â”œâ”€â”€ UnifiedStatBar.tsx
â”‚   â”‚       â””â”€â”€ VerticalBarChart.tsx
â”‚   â”œâ”€â”€ audit
â”‚   â”‚   â”œâ”€â”€ actions.ts
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â”œâ”€â”€ AuditForm.tsx
â”‚   â”‚       â”œâ”€â”€ components
â”‚   â”‚       â”‚   â”œâ”€â”€ AuditHeader.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ CoreVitalsGrid.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ CreateAuditForm.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ DownloadAuditButton.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ IssuesList.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ MobilePreviw.tsx
â”‚   â”‚       â”‚   â””â”€â”€ ScoreGrid.tsx
â”‚   â”‚       â””â”€â”€ pdf
â”‚   â”‚           â””â”€â”€ AuditPdfDocument.tsx
â”‚   â”œâ”€â”€ auth
â”‚   â”‚   â”œâ”€â”€ actions
â”‚   â”‚   â”‚   â””â”€â”€ reset-password.ts
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â”œâ”€â”€ ForgotPasswordForm.tsx
â”‚   â”‚       â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚       â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚       â””â”€â”€ ResetPasswordForm.tsx
â”‚   â”œâ”€â”€ blog
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â””â”€â”€ MDXContent.tsx
â”‚   â”œâ”€â”€ email
â”‚   â”‚   â””â”€â”€ templates
â”‚   â”‚       â””â”€â”€ AuditReadyEmail.tsx
â”‚   â””â”€â”€ projects
â”‚       â”œâ”€â”€ data
â”‚       â”‚   â””â”€â”€ projects-data.ts
â”‚       â”œâ”€â”€ index.ts
â”‚       â””â”€â”€ ui
â”‚           â”œâ”€â”€ ProjectCard.tsx
â”‚           â”œâ”€â”€ ProjectList.tsx
â”‚           â”œâ”€â”€ ProjectsCTA.tsx
â”‚           â””â”€â”€ ProjectsHero.tsx
â”œâ”€â”€ i18n
â”‚   â””â”€â”€ request.ts
â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ audit-dictionary.ts
â”‚   â”œâ”€â”€ auth
â”‚   â”‚   â””â”€â”€ admin-guard.ts
â”‚   â”œâ”€â”€ data.ts
â”‚   â”œâ”€â”€ mock-audit.ts
â”‚   â”œâ”€â”€ supabase
â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”œâ”€â”€ middleware.ts
â”‚   â”‚   â””â”€â”€ server.ts
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ validations
â”œâ”€â”€ proxy.ts
â”œâ”€â”€ repositories
â”‚   â”œâ”€â”€ interfaces
â”‚   â”‚   â”œâ”€â”€ IAnalyticsRepository.ts
â”‚   â”‚   â”œâ”€â”€ IAuditRepository.ts
â”‚   â”‚   â””â”€â”€ IPostRepository.ts
â”‚   â””â”€â”€ supabase
â”‚       â”œâ”€â”€ SupabaseAnalyticsRepository.ts
â”‚       â”œâ”€â”€ SupabaseAuditRepository.ts
â”‚       â””â”€â”€ SupabasePostRepository.ts
â”œâ”€â”€ routing.ts
â”œâ”€â”€ services
â”‚   â”œâ”€â”€ AuditService.ts
â”‚   â”œâ”€â”€ container.ts
â”‚   â”œâ”€â”€ email
â”‚   â”‚   â””â”€â”€ ResendEmailService.ts
â”‚   â””â”€â”€ PostService.ts
â””â”€â”€ types
    â”œâ”€â”€ database.types.ts
    â”œâ”€â”€ index.ts
    â””â”€â”€ models.ts


CONTINGUT DELS FITXERS


// =================== FILE: src/actions/contact.ts ===================

'use server';

import { z } from 'zod';
import { createClient } from '@/lib/supabase/server';
// 1. Definim el tipus per al 'prevState' per evitar l'error d'ESLint


export type FormState = {
  success: boolean;
  message?: string;
  errors?: {
    fullName?: string[];
    email?: string[];
    service?: string[];
    message?: string[];
    privacy?: string[];
  };
};

// 2. Corregim l'schema de Zod
const ContactSchema = z.object({
  fullName: z.string().min(2, "Nom massa curt"),
  email: z.string().email("Email invÃ lid"),
  service: z.string().min(1, "Selecciona un servei"),
  message: z.string().min(10, "Explica'ns una mica mÃ©s"),
  // SOLUCIÃ“ ZOD: Usem errorMap aquÃ­ o simplement 'message'
  privacy: z.literal("on", { 
    message: "Has d'acceptar la polÃ­tica de privacitat" 
  }),
});

export async function submitContactForm(
  prevState: FormState, // Tipatge correcte
  formData: FormData
): Promise<FormState> {
  const rawData = Object.fromEntries(formData.entries());
  
  // Validar dades
  const validated = ContactSchema.safeParse(rawData);
  if (!validated.success) {
    return { 
      success: false, 
      errors: validated.error.flatten().fieldErrors 
    };
  }

  try {
   // 1. Creem el client tipat
  const supabase = await createClient(); 
  
  // 2. InserciÃ³ TIPADA i CORRECTA
  // NO facis: .from('contact_leads' as ContactLead) <- AixÃ² dÃ³na l'error que tenies
  // Has de fer servir l'string literal tal qual:
  const { error } = await supabase
    .from('contact_leads') 
    .insert({
      full_name: validated.data.fullName,
      email: validated.data.email,
      service: validated.data.service,
      message: validated.data.message,
      source: 'landing_contact_form'
    });

  if (error) {
    console.error("Error saving lead:", error);
    return { success: false, message: "Error tÃ¨cnic. Torna-ho a provar." };
  }

  return { success: true, message: "Missatge enviat! Et contactarem aviat." };
}
catch (err) {
    console.error("Unexpected error:", err);
    return { success: false, message: "Error inesperat. Torna-ho a provar." };
    }
  }

// =================== FILE: src/adapters/google/PageSpeedAdapter.ts ===================

import { IWebScanner, ScanResult, AuditIssue } from '@/adapters/IWebScanner';

export class PageSpeedAdapter implements IWebScanner {
  private apiKey: string;
  private apiUrl = 'https://www.googleapis.com/pagespeedonline/v5/runPagespeed';

  constructor(apiKey: string) {
    this.apiKey = apiKey;
  }

  async scanUrl(url: string): Promise<ScanResult> {
    // Demanem categories: PERFORMANCE, SEO, BEST_PRACTICES, ACCESSIBILITY
    const endpoint = `${this.apiUrl}?url=${encodeURIComponent(url)}&key=${this.apiKey}&category=PERFORMANCE&category=SEO&category=ACCESSIBILITY&strategy=mobile`;

    const response = await fetch(endpoint);
    
    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`Google API Error: ${response.status} - ${errorText}`);
    }

    const data = await response.json();
    const lighthouse = data.lighthouseResult;

    // 1. Extraure Puntuacions
    const performanceScore = Math.round((lighthouse.categories.performance?.score || 0) * 100);
    const seoScore = Math.round((lighthouse.categories.seo?.score || 0) * 100);

    // 2. Extraure la Captura de Pantalla (Base64)
    // Google la torna a 'lighthouse.audits["final-screenshot"].details.data'
    const screenshot = lighthouse.audits['final-screenshot']?.details?.data;

    // 3. Extraure Problemes (Issues)
    // Busquem audits que tinguin un score baix (< 0.9) i que siguin rellevants
    const issues: AuditIssue[] = [];
    const auditsObj = lighthouse.audits;

    // Llista d'IDs d'auditoria que ens interessen (Google en tÃ© molts)
    const criticalAudits = [
        'first-contentful-paint',
        'largest-contentful-paint',
        'cumulative-layout-shift',
        'server-response-time',
        'render-blocking-resources',
        'uses-optimized-images',
        'meta-description',
        'document-title',
        'link-text'
    ];

    criticalAudits.forEach((key) => {
        const audit = auditsObj[key];
        // Si existeix i la puntuaciÃ³ no Ã©s perfecta (< 0.9) o Ã©s informativa
        if (audit && typeof audit.score === 'number' && audit.score < 0.9) {
            issues.push({
                title: audit.title,
                description: audit.description,
                score: audit.score,
                displayValue: audit.displayValue
            });
        }
    });

    return {
      seoScore,
      performanceScore,
      screenshot, // Ara tenim la foto!
      issues,     // Ara tenim la llista de problemes!
      reportData: data // Guardem l'original per si de cas
    };
  }
}

// =================== FILE: src/adapters/GooglePageSpeedAdapter.ts ===================

import { IWebScanner, ScanResult, AuditIssue } from './IWebScanner';
import { translateIssue } from '@/lib/audit-dictionary';

// 1. Definim el tipus per a l'audit "cru" que ve de l'API de Google
// AixÃ² evita els errors de "Unexpected any"
type LighthouseAuditRaw = {
  id: string;
  title: string;
  description: string;
  score: number | null;
  displayValue?: string;
  numericValue?: number;
  details?: unknown;
};

export class GooglePageSpeedAdapter implements IWebScanner {
    private apiKey?: string;
    private apiUrl = 'https://www.googleapis.com/pagespeedonline/v5/runPagespeed';

    constructor(apiKey?: string) {
        this.apiKey = apiKey;
    }

    async scanUrl(url: string): Promise<ScanResult> {
        // 1. PRE-CHECK: Validem que la web existeix (evita 100% score en webs 404)
        try {
            const check = await fetch(url, { method: 'HEAD' });
            if (check.status >= 400) {
                throw new Error(`La web retorna un error ${check.status}. Verifica que sigui pÃºblica.`);
            }
        } catch (e) {
            console.error("Error connectant amb la web:", e);
            throw new Error(`No s'ha pogut accedir a la web: ${url}`);
        }

        // 2. PREPARAR URL API
        // ConstruÃ¯m la query string manualment per assegurar que els arrays (category) es passen bÃ©
        const params = new URLSearchParams({
            url: url,
            strategy: 'mobile', // Mobile first, com Google vol
            locale: 'ca',       // Demanem els textos en catalÃ 
        });

        let queryString = params.toString();
        
        // Afegim totes les categories d'anÃ lisi
        const categories = ['PERFORMANCE', 'SEO', 'ACCESSIBILITY', 'BEST_PRACTICES'];
        categories.forEach(cat => {
             queryString += `&category=${cat}`;
        });

        if (this.apiKey) {
            queryString += `&key=${this.apiKey}`;
        }

        // 3. CRIDA A GOOGLE
        const response = await fetch(`${this.apiUrl}?${queryString}`);

        if (!response.ok) {
            const errText = await response.text();
            // Gestionem errors comuns de l'API
            if (response.status === 400) throw new Error("URL invÃ lida o no analitzable.");
            if (response.status === 500) throw new Error("Error intern de Google PageSpeed. Prova mÃ©s tard.");
            throw new Error(`Google API Error (${response.status}): ${errText}`);
        }

        const data = await response.json();
        
        // VerificaciÃ³ de seguretat per si l'API canvia l'estructura
        if (!data.lighthouseResult || !data.lighthouseResult.audits) {
             throw new Error("Format de resposta de Google inesperat.");
        }

        const lh = data.lighthouseResult;

        // 4. EXTRACCIÃ“ DE PUNTUACIONS (0-100)
        const scores = {
            performance: Math.round((lh.categories.performance?.score || 0) * 100),
            seo: Math.round((lh.categories.seo?.score || 0) * 100),
            accessibility: Math.round((lh.categories.accessibility?.score || 0) * 100),
            best_practices: Math.round((lh.categories['best-practices']?.score || 0) * 100),
        };

        // Fem un cast segur a un diccionari tipat
        const audits = lh.audits as Record<string, LighthouseAuditRaw>;

        // 5. EXTRACCIÃ“ DE CORE WEB VITALS (Per al Dashboard)
        // AixÃ² Ã©s el que faltava al codi antic i Ã©s vital per a la UI nova
        const metrics = {
            fcp: {
                value: audits['first-contentful-paint']?.displayValue,
                score: audits['first-contentful-paint']?.score,
                description: "Temps fins al primer contingut visible."
            },
            lcp: {
                value: audits['largest-contentful-paint']?.displayValue,
                score: audits['largest-contentful-paint']?.score,
                description: "Temps de cÃ rrega de l'element mÃ©s gran."
            },
            cls: {
                value: audits['cumulative-layout-shift']?.displayValue,
                score: audits['cumulative-layout-shift']?.score,
                description: "Estabilitat visual."
            },
            tbt: {
                value: audits['total-blocking-time']?.displayValue,
                score: audits['total-blocking-time']?.score,
                description: "Temps de bloqueig del navegador."
            },
            si: {
                value: audits['speed-index']?.displayValue,
                score: audits['speed-index']?.score,
                description: "Ãndex de velocitat visual."
            }
        };

        // 6. PROCESSAMENT D'ERRORS (ISSUES)
        // Filtrem qualsevol auditoria amb puntuaciÃ³ baixa (< 0.9)
        const issues: AuditIssue[] = Object.values(audits)
            .filter((a) => a.score !== null && a.score < 0.9 && a.details) 
            .map((a) => {
                // TraduÃ¯m el tÃ­tol usant el nostre diccionari 'audit-dictionary.ts'
                const translated = translateIssue(a.id, a.title, a.description);
                return {
                    title: translated.title,
                    description: translated.description,
                    score: a.score || 0,
                    displayValue: a.displayValue
                };
            })
            // Ordenem per gravetat (score 0 primer)
            .sort((a, b) => a.score - b.score)
            .slice(0, 8); // Agafem els 8 pitjors

        // 7. RETORNAR RESULTAT FINAL
        return {
            seoScore: scores.seo,
            performanceScore: scores.performance,
            screenshot: lh.audits['final-screenshot']?.details?.data, // Base64
            issues: issues,
            metrics: metrics,
            reportData: data // Guardem el JSON original per si de cas
        };
    }
}

// =================== FILE: src/adapters/IWebScanner.ts ===================

import { AuditMetric } from '@/features/audit/ui/components/CoreVitalsGrid';

export type AuditIssue = {
  title: string;       // âœ… ABANS NO HI ERA O ES DEIA 'text' AL MAPATGE
  description: string;
  score: number;       
  displayValue?: string;
  
  // âœ¨ AFEGIM AQUESTS CAMPS PER A LA UI
  impact?: string;     // Ex: "CrÃ­tic", "Millorable"
  type?: 'error' | 'warning' | 'success';
};

export type ScanResult = {
  seoScore: number;
  performanceScore: number;
  screenshot?: string; 
  issues: AuditIssue[]; 
  reportData: unknown; 
  metrics?: {
    fcp?: AuditMetric;
    lcp?: AuditMetric;
    cls?: AuditMetric;
    tbt?: AuditMetric;
    si?: AuditMetric;
  };
};

export interface IWebScanner {
  scanUrl(url: string): Promise<ScanResult>;
}

// =================== FILE: src/app/actions/get-users.ts ===================

'use server'

import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';

export type UserProfile = {
  id: string;
  email: string;
  role: 'admin' | 'client' | 'lead';
  created_at: string;
  full_name: string | null;
};

export async function getAdminUsersList(): Promise<UserProfile[]> {
  const supabase = await createClient();
 
  // 1. Verificar sessiÃ³ actual
  const { data: { user }, error: authError } = await supabase.auth.getUser();
  if (authError || !user) redirect('/auth/login');

  // 2. ğŸ›¡ï¸ SUPER ADMIN CHECK
  // Si el correu Ã©s el de la variable d'entorn, ets admin SI o SI.
  const isSuperAdmin = user.email === process.env.ADMIN_EMAIL;

  if (!isSuperAdmin) {
    // Si no ets el Super Admin per variable, comprovem la base de dades
    const { data: currentUserProfile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', user.id)
      .single();

    if (currentUserProfile?.role !== 'admin') {
      redirect('/'); // Fora d'aquÃ­
    }
  }

  // 3. Obtenir dades
  // NOTA IMPORTANT: Encara que el codi et deixi passar, el RLS (Row Level Security) 
  // de Supabase et pot bloquejar les dades si el teu rol a la DB no Ã©s 'admin'.
  const { data: profiles, error } = await supabase
    .from('profiles')
    .select('*')
    .order('created_at', { ascending: false });

  if (error) {
    console.error('Error fetching users:', error);
    return [];
  }

  return profiles as UserProfile[];
}

// =================== FILE: src/app/globals.css ===================

@import "tailwindcss";
@plugin "tailwindcss-animate";
/* ğŸ‘‡ AQUESTA Ã‰S LA LÃNIA MÃ€GICA ğŸ‘‡ */
@custom-variant dark (&:is(.dark *));
/* =========================================
   1. VARIABLES DE COLOR
   ========================================= */
:root {
  /* Mode Clar (EstÃ ndard) */
  --background: 0 0% 100%;
  --foreground: 260 10% 3.9%; /* Lleugerament tintat */
  --card: 0 0% 100%;
  --card-foreground: 260 10% 3.9%;
  --popover: 0 0% 100%;
  --popover-foreground: 260 10% 3.9%;
  --primary: 262 83% 58%;
  --primary-foreground: 0 0% 98%;
  --secondary: 260 4.8% 95.9%;
  --secondary-foreground: 260 5.9% 10%;
  --muted: 260 4.8% 95.9%;
  --muted-foreground: 260 3.8% 46.1%;
  --accent: 260 4.8% 95.9%;
  --accent-foreground: 260 5.9% 10%;
  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 0 0% 98%;
  --border: 260 5.9% 90%;
  --input: 260 5.9% 90%;
  --ring: 262 83% 58%;
  --radius: 0.75rem;
  --p: 222 47% 11%;
}

.dark {
  /* âœ¨ EL COLOR QUE BUSCAVES: Negre Apagat amb toc Lila */
  /* HSL: Hue 260 (Lila), Sat 14% (Apagat), Light 4% (Fosc casi negre) */
  --background: 260 8% %; 
  --foreground: 260 10% 98%;

  /* Les targetes un pÃ¨l mÃ©s clares que el fons per fer capa */
  --card: 260 14% 7%;
  --card-foreground: 260 10% 98%;

  --popover: 260 14% 4%;
  --popover-foreground: 260 10% 98%;

  /* El morat de la marca (Vibrant) */
  --primary: 263 70% 50%;
  --primary-foreground: 0 0% 98%;

  /* Elements secundaris (Gris fosc lilos) */
  --secondary: 260 15% 12%;
  --secondary-foreground: 0 0% 98%;

  /* Gris "Muted" (Slate lilos) */
  --muted: 260 15% 12%;
  --muted-foreground: 260 10% 65%; /* Gris suau */

  --accent: 260 15% 12%;
  --accent-foreground: 0 0% 98%;

  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 0 0% 98%;

  /* Vores molt subtils */
  --border: 260 15% 12%;
  --input: 260 15% 12%;
  --ring: 263 70% 50%;

  --p: 216 12% 84%; /* slate-300 */
}

/* =========================================
   2. CONFIGURACIÃ“ DEL TEMA (Tailwind v4)
   ========================================= */
@theme inline {
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));
  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));

  --radius-xl: calc(var(--radius) + 4px);
  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --animate-floating: floating 6s ease-in-out infinite;
  --animate-pulse-glow: pulse-glow 2s ease-in-out infinite alternate;

  @keyframes floating {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }
  @keyframes pulse-glow {
    from { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
    to { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
  }
}

/* =========================================
   3. BASE & COMPONENTS
   ========================================= */
@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

@layer components {
  
  /* ICONES MODERNS (Tal com sortien a les imatges) */
  .benefit-icon {
    @apply w-14 h-14 rounded-2xl flex items-center justify-center mb-6 transition-all duration-300;
    /* Degradat molt subtil sobre el fons fosc */
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
    border: 1px solid rgba(168, 85, 247, 0.2);
    box-shadow: 0 0 0 1px rgba(168, 85, 247, 0.05); /* Ring subtil */
  }

  /* Efecte Hover Glow */
  .group:hover .benefit-icon {
    @apply scale-110 border-primary/50;
    box-shadow: 0 0 25px rgba(168, 85, 247, 0.3);
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.25) 0%, rgba(99, 102, 241, 0.25) 100%);
  }

  /* Targetes Futuristes (MÃ©s netes, estil "Glass") */
  .solution-card-futuristic {
    @apply bg-white/[0.03] border border-white/[0.08] backdrop-blur-sm rounded-2xl p-8 transition-all duration-300;
  }
  
  .solution-card-futuristic:hover {
    @apply border-primary/40 bg-white/[0.06] -translate-y-1;
  }

  /* Inputs (Fons transparent o molt fosc) */
  .input-dark {
    @apply bg-white/[0.03] border border-white/10 text-white placeholder:text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary rounded-lg;
  }

  .testimonial-card {
    @apply bg-white/[0.03] border border-white/10 backdrop-blur-md rounded-2xl p-8 transition-all duration-300;
  }
}

@layer utilities {
  .gradient-text {
    @apply bg-gradient-to-r from-[#a855f7] to-[#6366f1] bg-clip-text text-transparent;
  }
  .gradient-bg {
    @apply bg-gradient-to-r from-[#a855f7] to-[#6366f1];
  }
  .section-divider {
     /* LÃ­nia divisÃ²ria molt subtil, quasi invisible */
     @apply h-[1px] w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-12;
  }
}

// =================== FILE: src/app/layout.tsx ===================

// src/app/layout.tsx
import { ReactNode } from 'react';

type Props = {
  children: ReactNode;
};

// Aquest component nomÃ©s existeix perquÃ¨ Next.js no es queixi.
// El middleware s'encarrega d'enviar l'usuari a /[locale]/..., 
// per tant, l'usuari mai veurÃ  aquest HTML "buit".
export default function RootLayout({ children }: Props) {
  return children;
}

// =================== FILE: src/app/manifest.ts ===================

import { MetadataRoute } from 'next';

export default function manifest(): MetadataRoute.Manifest {
  return {
    name: 'DigitAI Studios',
    short_name: 'DigitAI',
    description: 'AgÃ¨ncia de desenvolupament web, apps i automatitzaciÃ³ IA.',
    start_url: '/',
    display: 'standalone', // Fa que sembli una App real (sense barra de navegador)
    background_color: '#020817', // El color "Midnight Indigo" del teu dark mode
    theme_color: '#020817',
    orientation: 'portrait',
    icons: [
      {
        "src": "/web-app-manifest-192x192.png",
        "sizes": "192x192",
        "type": "image/png",
        "purpose": "maskable"
      },
      {
        "src": "/web-app-manifest-512x512.png",
        "sizes": "512x512",
        "type": "image/png",
        "purpose": "maskable"
      },
      {
        src: '/icons/apple-icon.png',
        sizes: '180x180',
        type: 'image/png',
        purpose: 'maskable', // Important per a Android modern
      },
    ],
  };
}

// =================== FILE: src/app/robots.ts ===================

import { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
      disallow: ['/admin/', '/dashboard/'], // ğŸ›¡ï¸ Protegim les zones privades
    },
    sitemap: 'https://digitaistudios.com/sitemap.xml', // URL final
  };
}

// =================== FILE: src/app/sitemap.ts ===================

import { MetadataRoute } from 'next';
import { postService } from '@/services/container';

// âš ï¸ IMPORTNAT: Canvia aixÃ² pel teu domini real quan despleguis
const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const posts = await postService.getLatestPosts();
  const locales = ['es', 'ca', 'en']; // Els teus idiomes

  // 1. PÃ gines estÃ tiques (Home, Blog) per a cada idioma
  const staticPages = locales.flatMap((locale) => [
    {
      url: `${BASE_URL}/${locale}`,
      lastModified: new Date(),
      changeFrequency: 'weekly' as const,
      priority: 1,
    },
    {
      url: `${BASE_URL}/${locale}/blog`,
      lastModified: new Date(),
      changeFrequency: 'daily' as const,
      priority: 0.8,
    },
  ]);

  // 2. Entrades del Blog per a cada idioma
  const postEntries = posts.flatMap((post) => 
    locales.map((locale) => ({
      url: `${BASE_URL}/${locale}/blog/${post.slug}`,
      lastModified: post.date ? new Date(post.date) : new Date(),
      changeFrequency: 'monthly' as const,
      priority: 0.7,
    }))
  );

  return [...staticPages, ...postEntries];
}

// =================== FILE: src/app/[locale]/(marketing)/blog/page.tsx ===================

import { Link } from '@/routing';
// ğŸ‘‡ Importem el servei des del container
import { postService } from '@/services/container';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

// ISR: Refresca el llistat cada hora per si hi ha posts nous
export const revalidate = 3600;

export default async function BlogIndexPage() {
  // Opcional: Si vols traduir els tÃ­tols "Blog & Recursos" pots fer servir 't'
  // const t = await getTranslations('BlogIndex'); 

  // 1. Obtenim TOTS els posts publicats
  const posts = await postService.getLatestPosts();

  return (
    <div className="container mx-auto py-12 px-4">
      <div className="text-center mb-12">
        <h1 className="text-4xl font-bold tracking-tight mb-4">Blog & Recursos</h1>
        <p className="text-muted-foreground text-lg max-w-2xl mx-auto">
          AprÃ¨n a optimitzar la teva presÃ¨ncia digital amb les nostres guies.
        </p>
      </div>

      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {posts.map((post) => (
          <Link key={post.slug} href={`/blog/${post.slug}`} className="block transition-transform hover:scale-[1.02]">
            <Card className="h-full flex flex-col overflow-hidden border-slate-200 shadow-sm hover:shadow-md transition-shadow">
              
              {/* Imatge de Cover */}
              <div 
                className="h-48 w-full bg-slate-100 flex items-center justify-center text-slate-300 bg-cover bg-center"
                style={post.coverImage ? { backgroundImage: `url(${post.coverImage})` } : undefined}
              >
                {!post.coverImage && <span>Sense Imatge</span>}
              </div>

              <CardHeader>
                <div className="text-xs font-bold text-indigo-600 mb-2 tracking-wide uppercase">
                  {post.tags[0] ?? 'TECH'}
                </div>
                <CardTitle className="text-xl leading-snug font-bold text-slate-900">
                  {post.title}
                </CardTitle>
              </CardHeader>
              
              <CardContent className="flex-1 flex flex-col justify-between">
                <p className="text-muted-foreground text-sx line-clamp-3 mb-4">
                  {post.description}
                </p>
                
                <div className="text-xs text-slate-400 font-medium pt-4 border-t border-slate-100 mt-auto">
                  {post.date ? new Date(post.date).toLocaleDateString() : 'Recentment'}
                </div>
              </CardContent>
            </Card>
          </Link>
        ))}

        {posts.length === 0 && (
          <div className="col-span-full py-20 text-center bg-slate-50 rounded-lg border border-dashed">
            <p className="text-slate-500">Encara no hi ha articles publicats.</p>
          </div>
        )}
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/blog/[slug]/page.tsx ===================

import { notFound } from 'next/navigation';
import { postService } from '@/services/container';
import { MDXContent } from '@/features/blog/ui/MDXContent';
import { Link } from '@/routing';
import { Button } from '@/components/ui/button';
import { ArrowLeft, Calendar, User } from 'lucide-react';
import { Metadata } from 'next';

type Props = {
  params: Promise<{ slug: string }>;
};

export const revalidate = 3600;

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const post = await postService.getPost(slug);

  if (!post) {
    return { title: 'Article no trobat' };
  }

  return {
    title: post.title,
    description: post.description,
    openGraph: {
      title: post.title,
      description: post.description || '',
      type: 'article',
      publishedTime: post.date || undefined,
      tags: post.tags,
      images: post.coverImage ? [{ url: post.coverImage }] : undefined,
    },
    twitter: {
      card: 'summary_large_image',
      title: post.title,
      description: post.description || '',
      images: post.coverImage ? [post.coverImage] : [],
    },
  };
}

export default async function BlogPostPage({ params }: Props) {
  const { slug } = await params;
  const post = await postService.getPost(slug);

  if (!post) notFound();

  return (
    <div className="min-h-screen bg-background pb-20">

      {/* 1. HERO SECTION (FOSC PER DEFECTE) */}
      <div className="relative w-full flex items-end justify-center overflow-hidden min-h-[60vh] lg:min-h-[70vh] bg-slate-950">

        {/* CAPA 1: La Imatge de fons (Fixed per efecte parallax suau) */}
        <div className="absolute inset-0 bg-slate-900">
          {post.coverImage ? (
            <div
              className="absolute inset-0 bg-cover bg-center opacity-50"
              style={{ backgroundImage: `url(${post.coverImage})` }}
            />
          ) : (
            <div className="absolute inset-0 bg-linear-to-br from-blue-900 via-indigo-900 to-slate-900 opacity-80" />
          )}

          {/* CAPA 2: L'Overlay fosc (Essencial per llegir el text blanc) */}
          <div className="absolute inset-0 bg-linear-to-t from-background via-background/60 to-transparent" />
        </div>

        {/* Contingut del Hero */}
        <div className="relative z-10 container px-4 text-center max-w-4xl mx-auto pb-24 pt-32">


          {/* TÃ­tol Gran */}
          <h1 className="text-3xl md:text-5xl lg:text-7xl font-extrabold tracking-tight text-foreground mb-6 leading-tight drop-shadow-xl animate-in fade-in slide-in-from-bottom-6 duration-1000">
            {post.title}
          </h1>

          {/* Meta Info */}
          <div className="flex flex-wrap justify-center items-center gap-4 md:gap-8 text-muted-foreground font-medium text-sm md:text-base animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-100">
            {/* Tags */}
            <div className="flex flex-wrap justify-center gap-2 mb-6 animate-in fade-in slide-in-from-bottom-4 duration-700">
              {post.tags.map(tag => (
                <span key={tag} className="px-3 py-1 rounded-full bg-foreground/10 text-foreground backdrop-blur-md border border-primary/30 text-[10px] md:text-xs font-bold uppercase tracking-wider">
                  {tag}
                </span>
              ))}
            </div>
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 rounded-full bg-muted flex items-center justify-center border border-border">
                <User className="w-4 h-4" />
              </div>
              <span>DigitAI Team</span>
            </div>

            <div className="flex items-center gap-2">
              <Calendar className="w-4 h-4 opacity-70" />
              <span>{post.date ? new Date(post.date).toLocaleDateString() : 'Avui'}</span>
            </div>
          </div>


        </div>
      </div>

      {/* 2. CONTINGUT (FONS ADAPTABLE) */}
      <div className="container px-4 -mt-12 relative z-20 max-w-4xl mx-auto">
        {/* Card principal del contingut */}
        <div className="bg-card text-card-foreground rounded-3xl p-6 md:p-12 lg:p-16 shadow-2xl ring-1 ring-border/50">

          {/* Intro / Description */}
          <p className="text-xl md:text-2xl lg:text-3xl font-serif text-muted-foreground leading-relaxed mb-8 md:mb-12 border-b border-border pb-8">
            {post.description}
          </p>

          {/* Cos de l'article (MDX) */}
          <div className="prose prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-a:text-primary prose-img:rounded-xl prose-img:shadow-lg">
            <MDXContent source={post.content || ''} />
          </div>

          {/* Footer Card dins del post */}
          <div className="mt-16 p-6 md:p-10 rounded-2xl bg-muted/30 border border-border text-center">
            <h3 className="text-xl md:text-2xl font-bold mb-4">T'ha resultat Ãºtil?</h3>
            <p className="text-muted-foreground mb-6 max-w-md mx-auto text-sm md:text-base">Comparteix aquest article o descobreix com podem ajudar-te a aplicar aquestes estratÃ¨gies.</p>

            <div className="flex flex-col sm:flex-row justify-center gap-4">
              <Link href="/blog">
                <Button variant="outline" className="w-full sm:w-auto">
                  <ArrowLeft className="mr-2 h-4 w-4" /> Altres Articles
                </Button>
              </Link>
              <Link href="/">
                <Button className="w-full sm:w-auto gradient-bg text-white border-0 shadow-lg hover:opacity-90">
                  Auditar la meva web
                </Button>
              </Link>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/layout.tsx ===================

import { Navbar } from '@/components/layout/Navbar';
import { Footer } from '@/components/layout/Footer';
import { createClient } from '@/lib/supabase/server';

export default async function MarketingLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // 1. Obtenim la sessiÃ³ al Layout (es comparteix per a totes les rutes marketing)
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  return (
    <div className="flex min-h-screen flex-col bg-background selection:bg-primary/30">
      {/* 2. Passem l'usuari al Navbar */}
      <Navbar user={user} />
      
      <main className="flex-1">
        {children}
      </main>

      <Footer />
    </div>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/legal/avis-legal/page.tsx ===================

import LegalLayout from '@/components/layout/LegalLayout';
import { Building2, Mail, MapPin, Fingerprint, AlertTriangle, Gavel } from 'lucide-react';

export const metadata = {
  title: 'AvÃ­s Legal | DigitAI Studios',
  description: 'InformaciÃ³ legal i condicions d\'Ãºs de DigitAI Studios.',
};

export default function AvisLegalPage() {
  return (
    <LegalLayout>
      <div className="border-b border-border pb-8 mb-8">
        <h1 className="text-3xl md:text-4xl font-extrabold mb-4">AvÃ­s Legal</h1>
        <p className="text-xl text-muted-foreground leading-relaxed">
          La transparÃ¨ncia Ã©s la nostra prioritat. AquÃ­ tens tota la informaciÃ³ legal sobre qui som i les regles d'aquest lloc web.
        </p>
        <p className="text-sm text-muted-foreground mt-4">Ãšltima actualitzaciÃ³: {new Date().toLocaleDateString()}</p>
      </div>

      {/* SECCIÃ“ 1: DADES IDENTIFICATIVES (GRID VISUAL) */}
      <section className="mb-12">
        <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
            1. Dades Identificatives
        </h2>
        <p className="mb-6">
           En compliment de la Llei 34/2002 (LSSI-CE), informem que el titular del lloc web Ã©s:
        </p>
        
        <div className="grid sm:grid-cols-2 gap-4 not-prose">
           <InfoCard 
              icon={Building2} 
              label="RaÃ³ Social / Nom" 
              value="[EL TEU NOM EMPRESA]" 
           />
           <InfoCard 
              icon={Fingerprint} 
              label="NIF / CIF" 
              value="[EL TEU NIF]" 
           />
           <InfoCard 
              icon={MapPin} 
              label="Domicili Social" 
              value="[Carrer Exemple 123], Girona, Espanya" 
           />
           <InfoCard 
              icon={Mail} 
              label="Contacte" 
              value="info@digitaistudios.com" 
           />
        </div>
      </section>

      {/* SECCIÃ“ 2: OBJECTE */}
      <section className="mb-12">
        <h2>2. Condicions d'Ãšs</h2>
        <p>
          L'accÃ©s a aquest lloc web Ã©s lliure i gratuÃ¯t. El simple accÃ©s no implica l'establiment de cap relaciÃ³ comercial entre <strong>DigitAI Studios</strong> i l'usuari.
        </p>
        <p>
          L'usuari es compromet a utilitzar el lloc web de conformitat amb la llei i el present AvÃ­s Legal, abstenint-se d'utilitzar-lo amb finalitats ilÂ·lÃ­cites o que puguin danyar els interessos de tercers.
        </p>
      </section>

      {/* SECCIÃ“ 3: PROPIETAT INTELÂ·LECTUAL */}
      <section className="mb-12">
        <h2>3. Propietat IntelÂ·lectual i Industrial</h2>
        <div className="bg-muted/30 p-6 rounded-xl border-l-4 border-primary not-prose">
            <p className="text-sm text-muted-foreground">
                Tots els continguts (marques, logotips, textos, fotografies, icones, imatges, etc.), aixÃ­ com el disseny grÃ fic, codi font i software, sÃ³n propietat exclusiva de <strong>DigitAI Studios</strong> o de tercers que han autoritzat el seu Ãºs, estant protegits per la legislaciÃ³ nacional i internacional.
            </p>
        </div>
      </section>

      {/* SECCIÃ“ 4: RESPONSABILITAT */}
      <section className="mb-12">
         <h2 className="flex items-center gap-2">
            <AlertTriangle className="w-6 h-6 text-yellow-500" /> ExempciÃ³ de Responsabilitat
         </h2>
         <p>DigitAI Studios no es fa responsable de:</p>
         <ul>
            <li>Les possibles fallades de seguretat que es puguin produir ni dels possibles danys al sistema informÃ tic de l'usuari (virus, malware, etc.).</li>
            <li>La informaciÃ³ i continguts emmagatzemats en fÃ²rums, xarxes socials o qualsevol altre mitjÃ  que permeti a tercers publicar continguts de forma independent.</li>
            <li>La precisiÃ³ exacta de les auditories automÃ tiques, que sÃ³n orientatives i basades en l'API de Google Lighthouse.</li>
         </ul>
      </section>

      {/* SECCIÃ“ 5: LLEI */}
      <section>
         <h2 className="flex items-center gap-2">
            <Gavel className="w-6 h-6 text-primary" /> Llei Aplicable i JurisdicciÃ³
         </h2>
         <p>
            Per a la resoluciÃ³ de totes les controvÃ¨rsies relacionades amb el present lloc web, serÃ  d'aplicaciÃ³ la legislaciÃ³ espanyola, a la qual se sotmeten expressament les parts, sent competents per a la resoluciÃ³ de tots els conflictes els Jutjats i Tribunals de la ciutat de Girona.
         </p>
      </section>

    </LegalLayout>
  );
}

// Component petit per a les targetes de dades
import { LucideIcon } from 'lucide-react';

interface InfoCardProps {
    icon: LucideIcon;
    label: string;
    value: string;
}

function InfoCard({ icon: Icon, label, value }: InfoCardProps) {
    return (
        <div className="bg-background border border-border p-4 rounded-lg flex items-start gap-4 shadow-sm hover:border-primary/30 transition-colors">
            <div className="p-2 bg-primary/10 rounded-md shrink-0">
                <Icon className="w-5 h-5 text-primary" />
            </div>
            <div>
                <p className="text-xs text-muted-foreground font-medium uppercase tracking-wider">{label}</p>
                <p className="text-sm font-bold text-foreground mt-1">{value}</p>
            </div>
        </div>
    )
}

// =================== FILE: src/app/[locale]/(marketing)/legal/cookies/page.tsx ===================

import LegalLayout from '@/components/layout/LegalLayout';
import { Cookie, Settings, BarChart3, XCircle } from 'lucide-react';

export const metadata = {
  title: 'PolÃ­tica de Cookies | DigitAI Studios',
  description: 'InformaciÃ³ sobre l\'Ãºs de cookies a DigitAI Studios.',
};

export default function CookiesPage() {
  return (
    <LegalLayout>
      <div className="border-b border-border pb-8 mb-8">
        <h1 className="text-3xl md:text-4xl font-extrabold mb-4">PolÃ­tica de Cookies</h1>
        <p className="text-xl text-muted-foreground leading-relaxed">
          Utilitzem galetes (cookies) per assegurar que la web funcioni correctament i per entendre com podem millorar-la. AquÃ­ tens tots els detalls.
        </p>
      </div>

      <div className="space-y-12">

        {/* BLOC 1: DEFINICIÃ“ */}
        <section>
          <h2 className="text-2xl font-bold flex items-center gap-2 mb-4">
            <Cookie className="text-orange-500" /> 1. QuÃ¨ sÃ³n les Cookies?
          </h2>
          <div className="bg-muted/30 p-6 rounded-xl border border-border">
            <p className="m-0">
              Una cookie Ã©s un petit fitxer de text que s'emmagatzema al teu navegador quan visites gairebÃ© qualsevol pÃ gina web. La seva utilitat Ã©s que la web sigui capaÃ§ de recordar la teva visita quan tornis a navegar per aquesta pÃ gina, o mantenir la teva sessiÃ³ oberta.
            </p>
          </div>
        </section>

        {/* BLOC 2: TIPUS DE COOKIES (GRID) */}
        <section>
          <h2>2. Quines cookies utilitzem?</h2>
          <p>Aquesta web utilitza els segÃ¼ents tipus de cookies:</p>
          
          <div className="grid md:grid-cols-2 gap-6 not-prose my-6">
             {/* Cookies TÃ¨cniques */}
             <div className="p-5 rounded-xl border border-border bg-card shadow-sm">
                <div className="flex items-center gap-3 mb-3">
                   <div className="p-2 bg-primary/10 rounded-lg text-primary">
                      <Settings className="w-5 h-5" />
                   </div>
                   <h4 className="font-bold text-lg">NecessÃ ries (TÃ¨cniques)</h4>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                   SÃ³n imprescindibles per al funcionament de la web. Sense elles, no podries iniciar sessiÃ³ ni navegar correctament.
                </p>
                <ul className="space-y-2 text-sm">
                   <li className="flex items-center gap-2">
                      <span className="w-1.5 h-1.5 bg-primary rounded-full"></span>
                      <strong>Supabase Auth:</strong> Gestiona la sessiÃ³ segura.
                   </li>
                   <li className="flex items-center gap-2">
                      <span className="w-1.5 h-1.5 bg-primary rounded-full"></span>
                      <strong>Next-Intl:</strong> Recorda l'idioma preferit.
                   </li>
                </ul>
             </div>

             {/* Cookies AnalÃ­tiques */}
             <div className="p-5 rounded-xl border border-border bg-card shadow-sm">
                <div className="flex items-center gap-3 mb-3">
                   <div className="p-2 bg-blue-500/10 rounded-lg text-blue-500">
                      <BarChart3 className="w-5 h-5" />
                   </div>
                   <h4 className="font-bold text-lg">AnalÃ­tiques</h4>
                </div>
                <p className="text-sm text-muted-foreground mb-4">
                   Ens permeten quantificar el nombre d'usuaris i analitzar la utilitzaciÃ³ que fan del servei per millorar-lo.
                </p>
                <ul className="space-y-2 text-sm">
                   <li className="flex items-center gap-2">
                      <span className="w-1.5 h-1.5 bg-blue-500 rounded-full"></span>
                      <strong>Analytics Propi:</strong> EstadÃ­stiques anÃ²nimes respectuoses amb la privacitat (sense rastreig invasiu de Google).
                   </li>
                </ul>
             </div>
          </div>
        </section>

        {/* BLOC 3: DESACTIVACIÃ“ */}
        <section>
           <h2 className="flex items-center gap-2">
              <XCircle className="text-red-500" /> 3. Com desactivar-les?
           </h2>
           <p>
             Pots permetre, bloquejar o eliminar les cookies instalÂ·lades al teu equip mitjanÃ§ant la configuraciÃ³ de les opcions del navegador:
           </p>
           
           <div className="flex flex-wrap gap-4 not-prose mt-4">
              <a href="https://support.google.com/chrome/answer/95647" target="_blank" rel="noopener" className="px-4 py-2 bg-card border border-border rounded-lg text-sm font-medium hover:border-primary transition-colors">
                 Google Chrome
              </a>
              <a href="https://support.apple.com/es-es/guide/safari/sfri11471/mac" target="_blank" rel="noopener" className="px-4 py-2 bg-card border border-border rounded-lg text-sm font-medium hover:border-primary transition-colors">
                 Safari
              </a>
              <a href="https://support.mozilla.org/es/kb/habilitar-y-deshabilitar-cookies-sitios-web-rastrear-preferencias" target="_blank" rel="noopener" className="px-4 py-2 bg-card border border-border rounded-lg text-sm font-medium hover:border-primary transition-colors">
                 Firefox
              </a>
              <a href="https://support.microsoft.com/es-es/microsoft-edge/eliminar-las-cookies-en-microsoft-edge-63947406-40ac-c23d-37fd-6b7ac978ce4a" target="_blank" rel="noopener" className="px-4 py-2 bg-card border border-border rounded-lg text-sm font-medium hover:border-primary transition-colors">
                 Microsoft Edge
              </a>
           </div>
        </section>

      </div>
    </LegalLayout>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/legal/privacitat/page.tsx ===================

import LegalLayout from '@/components/layout/LegalLayout';
import { ShieldCheck, Server, Eye, Lock } from 'lucide-react';

export const metadata = {
  title: 'PolÃ­tica de Privacitat | DigitAI Studios',
};

export default function PrivacitatPage() {
  return (
    <LegalLayout>
      <div className="border-b border-border pb-8 mb-8">
        <h1 className="text-3xl md:text-4xl font-extrabold mb-4">PolÃ­tica de Privacitat</h1>
        <p className="text-xl text-muted-foreground leading-relaxed">
          La teva privacitat Ã©s sagrada. AquÃ­ t'expliquem clarament quines dades recollim, per quÃ¨, i com les protegim.
        </p>
      </div>

      <div className="space-y-12">
          
          {/* BLOC 1: RESPONSABLE */}
          <section>
              <h2 className="text-2xl font-bold flex items-center gap-2 mb-4">
                  <ShieldCheck className="text-green-500" /> 1. Qui Ã©s el responsable de les teves dades?
              </h2>
              <div className="bg-muted/30 p-6 rounded-xl border border-border">
                  <p className="m-0">
                      El responsable Ã©s <strong>DigitAI Studios</strong> (veure AvÃ­s Legal per a dades completes). Pots contactar amb el nostre Delegat de ProtecciÃ³ de Dades a: <a href="mailto:dpd@digitaistudios.com">dpd@digitaistudios.com</a>.
                  </p>
              </div>
          </section>

          {/* BLOC 2: QUINES DADES */}
          <section>
              <h2>2. Quines dades recollim?</h2>
              <p>NomÃ©s recollim les dades estrictament necessÃ ries per oferir els nostres serveis:</p>
              <div className="grid md:grid-cols-2 gap-6 not-prose my-6">
                  <div className="p-4 rounded-lg border border-border bg-card">
                      <h4 className="font-bold text-lg mb-2 flex items-center gap-2">ğŸ” Auditoria Web</h4>
                      <p className="text-sm text-muted-foreground">La URL de la web que vols analitzar i el teu correu electrÃ²nic per enviar-te l'informe.</p>
                  </div>
                  <div className="p-4 rounded-lg border border-border bg-card">
                      <h4 className="font-bold text-lg mb-2 flex items-center gap-2">ğŸ‘¤ Compte d'Usuari</h4>
                      <p className="text-sm text-muted-foreground">El teu nom, correu electrÃ²nic i contrasenya encriptada quan et registres al Dashboard.</p>
                  </div>
              </div>
          </section>

          {/* BLOC 3: TERCERS */}
          <section>
              <h2 className="flex items-center gap-2"><Server className="text-blue-500" /> 3. Amb qui compartim les dades?</h2>
              <p>No venem les teves dades a ningÃº. NomÃ©s les compartim amb proveÃ¯dors tecnolÃ²gics necessaris per al funcionament del servei:</p>
              <ul className="not-prose space-y-2 mt-4">
                  <li className="flex items-center gap-3 p-2 rounded hover:bg-muted/50">
                      <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                      <span><strong>Supabase:</strong> Base de dades i autenticaciÃ³ (Allotjat a la UE/AWS).</span>
                  </li>
                  <li className="flex items-center gap-3 p-2 rounded hover:bg-muted/50">
                      <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                      <span><strong>Resend:</strong> Enviament d'emails transaccionals.</span>
                  </li>
                  <li className="flex items-center gap-3 p-2 rounded hover:bg-muted/50">
                      <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                      <span><strong>Google Cloud:</strong> API per processar les auditories web.</span>
                  </li>
              </ul>
          </section>

          {/* BLOC 4: DRETS */}
          <section>
              <h2 className="flex items-center gap-2"><Lock className="text-primary" /> 4. Els teus drets</h2>
              <p>Tens el control total sobre les teves dades. En qualsevol moment pots:</p>
              <ul>
                  <li>Accedir, rectificar o suprimir les teves dades.</li>
                  <li>Limitar el seu tractament.</li>
                  <li>Oposar-te a rebre comunicacions.</li>
                  <li>SolÂ·licitar la portabilitat de les dades.</li>
              </ul>
              <p>Per exercir-los, envia un email a <strong>info@digitaistudios.com</strong>.</p>
          </section>

      </div>
    </LegalLayout>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/page.tsx ===================

import { HeroSection } from '@/components/landing/HeroSection';
import { TechStackSection } from '@/components/landing/TechStackSection';
import { ProblemSolutionSection } from '@/components/landing/ProblemSolutionsSection';
import { ServicesGrid } from '@/components/landing/ServicesGrid';
import { ProductTeaser } from '@/components/landing/ProductTeaser';
import { AuditSection } from '@/components/landing/AuditSection';
import { TestimonialsSection } from '@/components/landing/TestimonialsSection';
import { ContactSection } from '@/components/landing/ContactSection';

// Importem les dades des del fitxer net
import { TESTIMONIALS } from '@/lib/data';

// ConfiguraciÃ³ de Vercel (si la necessites)
export const maxDuration = 60; 

export default function MarketingPage() {
  return (
    <>
      <HeroSection />
      <TechStackSection />
      <ProblemSolutionSection />
      <ServicesGrid />
      <ProductTeaser />
      <AuditSection />
      
      {/* Passem les dades netes */}
      <TestimonialsSection testimonials={TESTIMONIALS} />
      
      <ContactSection />
    </>
  );
}

// =================== FILE: src/app/[locale]/(marketing)/projectes/page.tsx ===================

// ARA (Import net des de la feature):
import { ProjectsHero, ProjectsList, ProjectsCTA } from '@/features/projects';

export default function ProjectsPage() {
  return (
    <main className="min-h-screen flex flex-col bg-background selection:bg-primary/30 transition-colors duration-300">
      <ProjectsHero />
      <ProjectsList />
      <ProjectsCTA />
    </main>
  );
}

// =================== FILE: src/app/[locale]/admin/analytics/page.tsx ===================

import { requireAdmin } from '@/lib/auth/admin-guard';
import { analyticsRepository } from '@/services/container';
import { TrafficChart } from '@/features/analytics/ui/TrafficChart';
import { TopPagesCard } from '@/features/analytics/ui/TopPagesCard';
import { DeviceChart } from '@/features/analytics/ui/DeviceChart';
import { BarListChart } from '@/features/analytics/ui/BarListChart';
import { VerticalBarChart } from '@/features/analytics/ui/VerticalBarChart';
import { UnifiedStatBar } from '@/features/analytics/ui/UnifiedStatBar';


export const revalidate = 60;

export default async function AdminAnalyticsPage() {
  await requireAdmin();

  const [dailyStats, adv] = await Promise.all([
    analyticsRepository.getLast7DaysStats(),
    analyticsRepository.getAdvancedStats()
  ]);

  const totalViews = dailyStats.reduce((acc, day) => acc + day.views, 0);
  const totalVisitors = dailyStats.reduce((acc, day) => acc + day.visitors, 0);

  return (
    // CANVI CLAU:
    // MÃ²bil: h-auto (alÃ§ada automÃ tica) + overflow-y-auto (scroll vertical)
    // Escriptori (lg): h-[calc(100vh-2rem)] (alÃ§ada fixa) + overflow-hidden (sense scroll global)
    <div className="flex flex-col gap-4 pb-4 h-auto overflow-y-auto lg:h-[calc(100vh-2rem)] lg:overflow-hidden">
      
      {/* 1. BARRA D'ESTAT UNIFICADA */}
      <div className="shrink-0">
         <UnifiedStatBar 
            views={totalViews} 
            visitors={totalVisitors} 
            events={totalViews} 
            avgTime="~45s" 
         />
      </div>

      {/* 2. GRAELLA PRINCIPAL */}
      {/* MÃ²bil: flex-col (un sota l'altre). Escriptori: grid (graella original) */}
      <div className="flex-1 flex flex-col lg:grid lg:grid-cols-3 gap-4 min-h-0">
         
         {/* --- COLUMNA ESQUERRA --- */}
         <div className="lg:col-span-2 flex flex-col gap-4 lg:h-full lg:min-h-0">
            
            {/* A. TrÃ nsit */}
            {/* MÃ²bil: AlÃ§ada fixa 300px. Escriptori: 50% de l'espai */}
            <div className="h-[300px] lg:h-1/2 lg:min-h-0">
                <TrafficChart data={dailyStats} />
            </div>

            {/* B. Detalls Importants */}
            {/* MÃ²bil: flex-col (stack). Escriptori: grid-cols-2 */}
            <div className="flex flex-col lg:grid lg:grid-cols-2 gap-4 lg:h-1/2 lg:min-h-0">
                <div className="h-[300px] lg:h-full lg:min-h-0">
                    <TopPagesCard data={adv.topPages} />
                </div>
                <div className="h-[300px] lg:h-full lg:min-h-0">
                    <BarListChart title="Fonts de TrÃ nsit" data={adv.referrers} />
                </div>
            </div>
         </div>

         {/* --- COLUMNA DRETA --- */}
         <div className="lg:col-span-1 flex flex-col gap-4 lg:h-full lg:min-h-0">
            
            {/* C. Dispositius */}
            <div className="h-[300px] lg:flex-1 lg:min-h-0">
               <DeviceChart data={adv.devices} />
            </div>

            {/* D. PaÃ¯sos */}
            <div className="h-[300px] lg:flex-1 lg:min-h-0">
               <VerticalBarChart title="Top PaÃ¯sos" data={adv.countries} />
            </div>

            {/* E. Navegadors */}
            <div className="h-[300px] lg:flex-1 lg:min-h-0">
               <BarListChart title="Navegadors" data={adv.browsers} />
            </div>
         </div>

      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/admin/debug/page.tsx ===================

'use client';

import { useState, useEffect } from 'react';
import { createClient } from '@/lib/supabase/client';

// Definim una interfÃ­cie simple per al resultat que esperem de Supabase
interface SupabaseCountResult {
  count: number | null;
  error: {
    message: string;
    code?: string;
  } | null;
}

export default function DebugAnalyticsPage() {
  const [logs, setLogs] = useState<string[]>([]);
  const [envStatus] = useState({
    url: !!process.env.NEXT_PUBLIC_SUPABASE_URL,
    key: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
  });

  // 1. Comprovem variables nomÃ©s carregar
  // Eliminat useEffect perquÃ¨ la inicialitzaciÃ³ es fa directament a useState

  const addLog = (msg: string) => setLogs(prev => [...prev, `${new Date().toLocaleTimeString()} > ${msg}`]);

  const testConnection = async () => {
    addLog('ğŸš€ INICIANT TEST...');
    
    // ValidaciÃ³ prÃ¨via
    if (!process.env.NEXT_PUBLIC_SUPABASE_URL) {
      addLog('âŒ ERROR FATAL: Falta NEXT_PUBLIC_SUPABASE_URL');
      return;
    }

    try {
      addLog('1. Creant client Supabase...');
      const supabase = createClient();
      
      addLog('2. Enviant peticiÃ³ (SELECT)...');
      
      // Fem un timeout manual per si es queda penjat
      const timeoutPromise = new Promise<never>((_, reject) => 
        setTimeout(() => reject(new Error("Timeout: La xarxa estÃ  bloquejada (AdBlock?)")), 5000)
      );

      const dbPromise = supabase
        .from('analytics_events')
        .select('count', { count: 'exact', head: true });

      // Cursa entre la DB i el Timeout. Forcem el tipus a 'unknown' primer i desprÃ©s al nostre tipus.
      const result = await Promise.race([dbPromise, timeoutPromise]) as unknown as SupabaseCountResult;

      if (result.error) {
        addLog(`âŒ ERROR DB: ${result.error.message}`);
        console.error(result.error);
      } else {
        addLog(`âœ… CONNEXIÃ“ CORRECTA! Files a la taula: ${result.count}`);
      }

    } catch (err: unknown) { 
      // CANVI CLAU: Usem 'unknown' en lloc de 'any'
      let errorMessage = 'Error desconegut';
      
      if (err instanceof Error) {
        errorMessage = err.message;
      } else if (typeof err === 'string') {
        errorMessage = err;
      }

      addLog(`ğŸ’¥ EXCEPCIÃ“: ${errorMessage}`);
      console.error(err);
    }
  };

  return (
    <div className="p-8 text-white bg-slate-950 min-h-screen">
      <h1 className="text-3xl font-bold mb-6 text-red-500">ğŸš‘ DIAGNÃ’STIC D'URGÃˆNCIA</h1>
      
      {/* Estat Variables */}
      <div className="grid grid-cols-2 gap-4 mb-6">
        <div className={`p-4 rounded border ${envStatus.url ? 'border-green-500 bg-green-900/20' : 'border-red-500 bg-red-900/20'}`}>
          <div className="font-bold">SUPABASE_URL</div>
          <div className="text-2xl">{envStatus.url ? 'âœ… OK' : 'âŒ MISSING'}</div>
        </div>
        <div className={`p-4 rounded border ${envStatus.key ? 'border-green-500 bg-green-900/20' : 'border-red-500 bg-red-900/20'}`}>
          <div className="font-bold">ANON_KEY</div>
          <div className="text-2xl">{envStatus.key ? 'âœ… OK' : 'âŒ MISSING'}</div>
        </div>
      </div>

      <button 
        onClick={testConnection}
        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg text-lg mb-6 transition-colors"
      >
        FORÃ‡AR PROVA DE CONNEXIÃ“
      </button>

      <div className="bg-black rounded-lg p-4 font-mono text-sm border border-slate-800 h-64 overflow-y-auto">
        {logs.length === 0 ? <span className="text-slate-500">Els logs apareixeran aquÃ­...</span> : logs.map((log, i) => (
          <div key={i} className="mb-1 border-b border-slate-900 pb-1">{log}</div>
        ))}
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/admin/layout.tsx ===================

import { requireAdmin } from '@/lib/auth/admin-guard';
import { Link } from '@/routing';
import { ShieldAlert, LayoutDashboard, BarChart3, Users, Home } from 'lucide-react';
import { AdminBottomNav } from '@/components/admin/AminMobileMenu';

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // â›” BLOQUEIG DE SEGURETAT
  await requireAdmin();

  return (
    <div className="flex h-screen overflow-hidden bg-slate-950 text-slate-200">
      
      {/* === 1. SIDEBAR DESKTOP (NomÃ©s visible en pantalles mitjanes/grans) === */}
      <aside className="hidden md:flex w-64 border-r border-slate-800 p-6 flex-col bg-slate-950">
        <div className="flex items-center gap-2 font-bold text-white mb-10 text-xl">
           <ShieldAlert className="text-red-500" />
           TORRE DE CONTROL
        </div>
        
        <nav className="flex flex-col gap-2">
          <Link href="/admin" className="flex items-center gap-3 px-4 py-2 rounded hover:bg-slate-900 transition-colors text-slate-300 hover:text-white">
              <LayoutDashboard className="w-5 h-5" /> Dashboard
          </Link>
          <Link href="/admin/analytics" className="flex items-center gap-3 px-4 py-2 rounded hover:bg-slate-900 transition-colors text-blue-400 font-medium">
              <BarChart3 className="w-5 h-5" /> AnalÃ­tiques
          </Link>
          <Link href="/admin/users" className="flex items-center gap-3 px-4 py-2 rounded hover:bg-slate-900 transition-colors text-blue-400 font-medium">
              <Users className="w-5 h-5" /> Usuaris
          </Link>
          
          <div className="mt-auto pt-4 border-t border-slate-800">
            <Link href="/" className="flex items-center gap-3 px-4 py-2 rounded hover:bg-slate-900 transition-colors text-slate-500 text-sm">
               <Home className="w-4 h-4" /> â† Tornar a la Web
            </Link>
          </div>
        </nav>
      </aside>

      {/* === CONTINGUT PRINCIPAL === */}
      <div className="flex-1 flex flex-col min-w-0 relative">
        
        {/* Header MÃ²bil (Opcional: NomÃ©s tÃ­tol, sense menÃº perquÃ¨ tenim bottombar) */}
        <header className="md:hidden h-14 border-b border-slate-800 flex items-center justify-center bg-slate-950 shrink-0">
           <span className="flex items-center gap-2 font-bold text-white text-sm">
             <ShieldAlert className="w-4 h-4 text-red-500" /> ADMIN PANEL
           </span>
        </header>

        {/* Zona de contingut amb scroll */}
        {/* Afegim 'mb-16' a mÃ²bil per evitar que la bottombar tapi el final del contingut */}
        <main className="flex-1 overflow-y-auto p-4 md:p-8 mb-16 md:mb-0">
          {children}
        </main>

        {/* === 2. BOTTOM BAR (NomÃ©s visible a mÃ²bil) === */}
        <AdminBottomNav />
        
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/admin/page.tsx ===================

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export default function AdminDashboard() {
  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold text-white">Benvingut, Arquitecte.</h1>
      
      <div className="grid gap-4 md:grid-cols-3">
        <Card className="bg-slate-900 border-slate-800 text-slate-200">
           <CardHeader>
             <CardTitle className="text-sm font-medium text-slate-400">Estat del Sistema</CardTitle>
           </CardHeader>
           <CardContent>
             <div className="text-2xl font-bold text-green-500">OPERATIU ğŸŸ¢</div>
           </CardContent>
        </Card>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/admin/users/page.tsx ===================

import { getAdminUsersList } from '@/app/actions/get-users';
import { getTranslations } from 'next-intl/server';

export default async function AdminUsersPage() {
  const users = await getAdminUsersList();
  const t = await getTranslations('AdminDashboard');

  return (
    <div className="p-8">
      <div className="flex justify-between items-center mb-6">
        <div>
          <h1 className="text-2xl font-bold">Usuaris Registrats</h1>
          <p className="text-gray-500">GestiÃ³ de leads i clients ({users.length})</p>
        </div>
        <button className="bg-black text-white px-4 py-2 rounded-md text-sm">
          Exportar CSV
        </button>
      </div>

      <div className="border rounded-lg overflow-hidden bg-white shadow-sm">
        <table className="w-full text-sm text-left">
          <thead className="bg-gray-50 text-gray-700 font-medium border-b">
            <tr>
              <th className="px-6 py-3">Data Registre</th>
              <th className="px-6 py-3">Usuari / Email</th>
              <th className="px-6 py-3">Rol</th>
              <th className="px-6 py-3 text-right">Accions</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-100">
            {users.map((user) => (
              <tr key={user.id} className="hover:bg-gray-50 transition-colors">
                <td className="px-6 py-4 text-gray-500">
                  {/* SOLUCIÃ“N: Verificamos si existe created_at */}
                  {user.created_at ? (
                    <>
                      {new Date(user.created_at).toLocaleDateString('ca-ES', {
                        day: '2-digit', month: 'short', year: 'numeric'
                      })}
                      <div className="text-xs text-gray-400">
                        {new Date(user.created_at).toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' })}
                      </div>
                    </>
                  ) : (
                    <span className="text-gray-300">-</span>
                  )}
                </td>
                <td className="px-6 py-4">
                  <div className="font-medium text-gray-900">
                    {user.full_name || 'Sense nom'}
                  </div>
                  <div className="text-gray-500">{user.email}</div>
                </td>
                <td className="px-6 py-4">
                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                    ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' :
                      user.role === 'client' ? 'bg-green-100 text-green-800' :
                        'bg-blue-100 text-blue-800'
                    }`}>
                    {user.role ? user.role.toUpperCase() : 'UNKNOWN'}
                  </span>
                </td>
                <td className="px-6 py-4 text-right">
                  <a
                    href={`mailto:${user.email}`}
                    className="text-indigo-600 hover:text-indigo-900 font-medium"
                  >
                    Contactar
                  </a>
                </td>
              </tr>
            ))}

            {users.length === 0 && (
              <tr>
                <td colSpan={4} className="px-6 py-8 text-center text-gray-500">
                  Encara no hi ha usuaris registrats.
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/auth/callback/route.ts ===================

import { NextResponse } from 'next/server'
// El client de servidor que hem creat abans
import { createClient } from '@/lib/supabase/server'

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')
  // si tenim un parÃ metre "next", el fem servir per redirigir
  const next = searchParams.get('next') ?? '/dashboard'

  if (code) {
    const supabase = await createClient()
    const { error } = await supabase.auth.exchangeCodeForSession(code)
    
    if (!error) {
      // Si tot ha anat bÃ©, redirigim a l'usuari cap al dashboard (o on volguÃ©s anar)
      // Afegim el locale per defecte si cal, o detectem.
      // Per ara hardcodegem 'ca', perÃ² l'ideal seria guardar-ho en cookie abans.
      return NextResponse.redirect(`${origin}/ca${next}`)
    }
  }

  // Si hi ha error, tornem al login amb un missatge
  return NextResponse.redirect(`${origin}/ca/auth/login?error=auth-code-error`)
}

// =================== FILE: src/app/[locale]/auth/forgot-password/page.tsx ===================

// =================== FILE: src/app/[locale]/auth/forgot-password/page.tsx ===================

import { getTranslations } from 'next-intl/server';
import { Link } from '@/routing';
import { ForgotPasswordForm } from '@/features/auth/ui/ForgotPasswordForm';

export default async function ForgotPasswordPage() {
  const t = await getTranslations('Auth');

  return (
    <div className="flex min-h-screen items-center justify-center bg-muted/20 px-4 py-12">
      <div className="w-full max-w-md space-y-6">
        <div className="text-center">
          <h1 className="text-3xl font-bold tracking-tight">Recuperar compte</h1>
          <p className="mt-2 text-sm text-muted-foreground">
            Introdueix el teu email i t'enviarem les instruccions.
          </p>
        </div>

        <ForgotPasswordForm />

        <div className="text-center text-sm">
          <Link href="/auth/login" className="font-medium text-primary hover:underline">
            â† Tornar al login
          </Link>
        </div>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/auth/login/page.tsx ===================

import { LoginForm } from '@/features/auth/ui/LoginForm';
import { Sparkles } from 'lucide-react';
import Link from 'next/link';

export default function LoginPage() {
  return (
    <div className="min-h-screen w-full grid lg:grid-cols-2 bg-background overflow-hidden">
      
      {/* COLUMNA ESQUERRA (Visual / Marketing) - NomÃ©s visible en desktop */}
      <div className="hidden lg:flex relative flex-col justify-between p-12 bg-[#0f111a] border-r border-white/5">
         {/* Fons animat */}
         <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_left,var(--tw-gradient-stops))] from-primary/20 via-background to-background opacity-50"></div>
         <div className="absolute inset-0 bg-[url('/grid-pattern.svg')] opacity-10"></div> {/* Si tens un patrÃ³, si no treu-ho */}
         
         {/* Logo */}
         <div className="relative z-10">
            <Link href="/" className="flex items-center gap-2 text-2xl font-bold text-white">
               DigitAI <span className="gradient-text">Studios</span>
            </Link>
         </div>

         {/* Testimoni o Text inspirador */}
         <div className="relative z-10 max-w-lg">
            <div className="mb-6 inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/20 bg-primary/5 text-primary text-xs font-bold">
               <Sparkles className="w-3 h-3" />
               DIGITAL INTELLIGENCE
            </div>
            <h2 className="text-4xl font-bold text-white mb-4 leading-tight">
               Gestiona el teu ecosistema digital des d'un sol lloc.
            </h2>
            <p className="text-slate-400 text-lg">
               Accedeix a les teves auditories, gestiona els teus projectes web i controla les teves automatitzacions.
            </p>
         </div>

         {/* Footer petit */}
         <div className="relative z-10 text-sm text-slate-600">
            Â© DigitAI Studios. All rights reserved.
         </div>
      </div>

      {/* COLUMNA DRETA (Formulari) */}
      <div className="flex items-center justify-center p-8 relative">
         {/* BotÃ³ tornar enrere mÃ²bil */}
         <Link href="/" className="absolute top-8 right-8 text-sm text-muted-foreground hover:text-foreground lg:hidden">
            Tornar a l'inici
         </Link>

         <LoginForm />
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/auth/register/page.tsx ===================

import { RegisterForm } from '@/features/auth/ui/RegisterForm';
import { Link } from '@/routing'; // Assegura't que sigui del routing configurat
import { Sparkles, ArrowLeft } from 'lucide-react';

type Props = {
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
};

export default async function RegisterPage({ searchParams }: Props) {
  // 1. Obtenim les dades
  const params = await searchParams;
  const emailParam = typeof params.email === 'string' ? params.email : '';

  // 2. (Opcional) Si necessites traduccions extra aquÃ­, usa getTranslations
  // const t = await getTranslations('Auth');

  return (
    <div className="min-h-screen w-full grid lg:grid-cols-2 bg-background overflow-hidden">
      
      {/* COLUMNA ESQUERRA (Visual / Marketing) - NomÃ©s visible en desktop */}
      <div className="hidden lg:flex relative flex-col justify-between p-12 bg-[#0f111a] border-r border-white/5">
         {/* Fons animat */}
         <div className="absolute inset-0 bg-[radial-gradient(circle_at_bottom_right,var(--tw-gradient-stops))] from-primary/20 via-background to-background opacity-50"></div>
         <div className="absolute inset-0 bg-[url('/grid-pattern.svg')] opacity-10"></div>
         
         {/* Logo */}
         <div className="relative z-10">
            <Link href="/" className="flex items-center gap-2 text-2xl font-bold text-white no-underline">
               DigitAI <span className="gradient-text">Studios</span>
            </Link>
         </div>

         {/* Missatge de valor */}
         <div className="relative z-10 max-w-lg">
            <div className="mb-6 inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/20 bg-primary/5 text-primary text-xs font-bold">
               <Sparkles className="w-3 h-3" />
               UNEIX-TE A LA REVOLUCIÃ“
            </div>
            <h2 className="text-4xl font-bold text-white mb-4 leading-tight">
               ComenÃ§a a construir el futur del teu negoci avui mateix.
            </h2>
            <div className="space-y-4 mt-8">
                <div className="flex items-center gap-4 text-slate-400">
                    <div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white font-bold">1</div>
                    <p>Auditories web gratuÃ¯tes i ilÂ·limitades.</p>
                </div>
                <div className="flex items-center gap-4 text-slate-400">
                    <div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white font-bold">2</div>
                    <p>AccÃ©s al panell de control de projectes.</p>
                </div>
                <div className="flex items-center gap-4 text-slate-400">
                    <div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white font-bold">3</div>
                    <p>Suport prioritari per a digitalitzaciÃ³.</p>
                </div>
            </div>
         </div>

         {/* Footer petit */}
         <div className="relative z-10 text-sm text-slate-600">
            Â© {new Date().getFullYear()} DigitAI Studios.
         </div>
      </div>

      {/* COLUMNA DRETA (Formulari) */}
      <div className="flex items-center justify-center p-8 relative">
         {/* BotÃ³ tornar enrere mÃ²bil */}
         <Link href="/" className="absolute top-8 left-8 text-sm text-muted-foreground hover:text-foreground flex items-center gap-2 lg:hidden">
            <ArrowLeft className="w-4 h-4" /> Inici
         </Link>

         {/* Injectem el formulari amb l'email si ve de l'auditoria */}
         <RegisterForm prefilledEmail={emailParam} />
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/auth/reset-password/page.tsx ===================

// =================== FILE: src/app/[locale]/auth/reset-password/page.tsx ===================

import { redirect } from 'next/navigation';
import { createClient } from '@/lib/supabase/server';
import { getTranslations } from 'next-intl/server';
import { ResetPasswordForm } from '@/features/auth/ui/ResetPasswordForm';

export default async function ResetPasswordPage() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  // Si l'usuari no tÃ© sessiÃ³, vol dir que l'enllaÃ§ ha caducat o Ã©s invÃ lid.
  // El redirigim a "forgot-password" de nou.
  if (!user) {
    // Nota: AquÃ­ hauries de posar el locale dinÃ micament
    // Per simplicitat poso 'ca', perÃ² pots usar `params.locale`
    redirect('/ca/auth/forgot-password'); 
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-muted/20 px-4 py-12">
      <div className="w-full max-w-md space-y-6">
        <div className="text-center">
          <h1 className="text-3xl font-bold tracking-tight">Nova Contrasenya</h1>
          <p className="mt-2 text-sm text-muted-foreground">
            Escriu la teva nova contrasenya segura.
          </p>
        </div>

        <ResetPasswordForm />
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/audits/page.tsx ===================

import { getTranslations, getLocale } from 'next-intl/server';
import { Link } from '@/routing';
import { redirect } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Plus, Globe, Calendar, ArrowRight, Activity } from 'lucide-react';
import { createClient } from '@/lib/supabase/server'; 
import { auditRepository } from '@/services/container'; // El teu repositori

export default async function AuditsListPage() {
  const t = await getTranslations('Dashboard');
  const locale = await getLocale();
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();

  if (!user || !user.email) {
    redirect(`/${locale}/auth/login`); 
  }

  // Obtenim les dades reals
  const audits = await auditRepository.getAuditsByUserEmail(user.email);

  return (
    <div className="space-y-8">
      
      {/* Header de la secciÃ³ */}
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 pb-6 border-b border-border">
        <div>
          <h1 className="text-3xl font-bold text-foreground">{t('my_audits', { defaultMessage: "Les meves Auditories" })}</h1>
          <p className="text-muted-foreground mt-1">
            HistÃ²ric complet i anÃ lisi de rendiment.
          </p>
        </div>
        <Link href="/dashboard/new-audit">
          <Button className="gradient-bg text-white border-0 shadow-lg shadow-primary/20 hover:opacity-90 transition-opacity">
            <Plus className="w-4 h-4 mr-2" /> Nova Auditoria
          </Button>
        </Link>
      </div>

      {/* Grid de Targetes */}
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {audits.map((audit) => (
          <Link key={audit.id} href={`/dashboard/audits/${audit.id}`} className="block group h-full">
            <div className="bg-card border border-border rounded-xl p-6 h-full hover:border-primary/50 transition-all duration-300 shadow-sm hover:shadow-md hover:-translate-y-1 relative overflow-hidden flex flex-col">
              
              {/* CapÃ§alera Targeta: Icona i Estat */}
              <div className="flex justify-between items-start mb-6">
                 <div className="p-3 bg-primary/10 rounded-lg text-primary border border-primary/20 group-hover:bg-primary/20 transition-colors">
                    <Globe className="w-6 h-6" />
                 </div>
                 <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide border ${
                    audit.status === 'completed' 
                      ? 'bg-green-500/10 text-green-500 border-green-500/20' 
                      : audit.status === 'failed'
                      ? 'bg-red-500/10 text-red-500 border-red-500/20'
                      : 'bg-yellow-500/10 text-yellow-500 border-yellow-500/20'
                 }`}>
                    {audit.status === 'completed' ? 'COMPLETAT' : audit.status === 'failed' ? 'ERROR' : 'PROCESSANT'}
                 </span>
              </div>

              {/* Cos Targeta: URL i Data */}
              <div className="mb-6 grow">
                 <h3 className="text-lg font-bold text-foreground truncate mb-2" title={audit.url}>
                    {audit.url.replace(/^https?:\/\//, '').replace(/\/$/, '')}
                 </h3>
                 <div className="flex items-center gap-2 text-xs text-muted-foreground">
                    <Calendar className="w-3 h-3" />
                    {/* Formatem la data de manera llegible */}
                    {new Intl.DateTimeFormat(locale, { dateStyle: 'medium' }).format(audit.createdAt)}
                 </div>
              </div>

              {/* Peu Targeta: Puntuacions */}
              {audit.status === 'completed' && (
                 <div className="grid grid-cols-2 gap-3 mt-auto pt-4 border-t border-border">
                    <div className="flex flex-col">
                       <span className="text-[10px] text-muted-foreground uppercase font-bold mb-1">SEO</span>
                       <div className="flex items-center gap-1.5">
                          <Activity className="w-3 h-3 text-muted-foreground" />
                          <span className={`text-lg font-bold ${getScoreColor(audit.seoScore || 0)}`}>
                             {audit.seoScore || '-'}
                          </span>
                       </div>
                    </div>
                    <div className="flex flex-col border-l border-border pl-3">
                       <span className="text-[10px] text-muted-foreground uppercase font-bold mb-1">Rendiment</span>
                       <div className="flex items-center gap-1.5">
                          <Activity className="w-3 h-3 text-muted-foreground" />
                          <span className={`text-lg font-bold ${getScoreColor(audit.performanceScore || 0)}`}>
                             {audit.performanceScore || '-'}
                          </span>
                       </div>
                    </div>
                 </div>
              )}

              {/* Fletxa Hover (Decorativa) */}
              <div className="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-all transform translate-x-2 group-hover:translate-x-0">
                 <ArrowRight className="w-5 h-5 text-primary" />
              </div>
            </div>
          </Link>
        ))}

        {/* Estat Buit (Empty State) */}
        {audits.length === 0 && (
          <div className="col-span-full py-16 flex flex-col items-center justify-center text-center border-2 border-dashed border-border rounded-2xl bg-card/30">
            <div className="w-16 h-16 bg-muted/50 rounded-full flex items-center justify-center mb-4">
               <Globe className="w-8 h-8 text-muted-foreground" />
            </div>
            <h3 className="text-lg font-medium text-foreground mb-2">No tens cap auditoria registrada</h3>
            <p className="text-muted-foreground mb-6 max-w-sm">
              ComenÃ§a analitzant la teva primera pÃ gina web per obtenir mÃ¨triques de SEO i rendiment.
            </p>
            <Link href="/dashboard/new-audit">
               <Button variant="outline" className="border-border hover:bg-muted text-foreground">
                  Crear primera auditoria
               </Button>
            </Link>
          </div>
        )}
      </div>
    </div>
  );
}

// Helper per colors de puntuaciÃ³ (adaptat a Tailwind classes)
function getScoreColor(score: number) {
   if (score >= 90) return 'text-green-500';
   if (score >= 50) return 'text-yellow-500';
   return 'text-red-500';
}

// =================== FILE: src/app/[locale]/dashboard/audits/[id]/page.tsx ===================

import { notFound } from 'next/navigation';
import { auditRepository } from '@/services/container';
import { AuditHeader } from '@/features/audit/ui/components/AuditHeader';
import { ScoreGrid } from '@/features/audit/ui/components/ScoreGrid';
// Importem CoreVitalsGrid i el seu tipus
import { CoreVitalsGrid, AuditMetric } from '@/features/audit/ui/components/CoreVitalsGrid';
import { IssuesList } from '@/features/audit/ui/components/IssuesList';
import { MobilePreview } from '@/features/audit/ui/components/MobilePreviw';
// Tipus d'errors (Adaptats)
import { AuditIssue } from '@/adapters/IWebScanner';

// Tipus per llegir el JSON de Google
type LighthouseAudit = {
  id: string;
  title: string;
  description: string;
  score: number | null;
  displayValue?: string;
  numericValue?: number;
  details?: unknown; 
};

interface GoogleRawData {
  lighthouseResult?: { audits: Record<string, LighthouseAudit> };
  audits?: Record<string, LighthouseAudit>;
  issues?: AuditIssue[];
  screenshot?: string;
}

type Props = {
  params: Promise<{ id: string; locale: string }>;
};

export default async function AuditDetailsPage({ params }: Props) {
  const { id } = await params;
  const audit = await auditRepository.getAuditById(id);

  if (!audit) notFound();

  if (audit.status === 'processing') {
    return <div className="p-12 text-center text-foreground">Carregant resultats...</div>;
  }

  // 1. Recuperar dades
  const rawData = audit.reportData as unknown as GoogleRawData;
  const googleAudits = rawData?.lighthouseResult?.audits || rawData?.audits || {};

  // 2. Helper per extreure mÃ¨triques segures
  const extract = (key: string): AuditMetric => {
    const a = googleAudits[key];
    if (!a) return { score: null, value: 'N/A', description: '' };
    return {
      score: a.score,
      value: a.displayValue || (a.numericValue ? a.numericValue.toFixed(2) : 'N/A'),
      description: a.title
    };
  };

  // 3. Construir l'objecte de mÃ¨triques pel Grid
  const metrics = {
    fcp: extract('first-contentful-paint'),
    lcp: extract('largest-contentful-paint'),
    cls: extract('cumulative-layout-shift'),
    tbt: extract('total-blocking-time'),
    si: extract('speed-index')
  };

  // 4. Processar Issues (Errors)
  let displayIssues: AuditIssue[] = rawData?.issues || [];

  if (displayIssues.length === 0 && Object.keys(googleAudits).length > 0) {
    displayIssues = Object.values(googleAudits)
      .filter((a: LighthouseAudit) => {
        const score = a.score ?? 1;
        // Filtrem score < 0.9 i que no sigui nomÃ©s informatiu (score null)
        return score < 0.9 && a.score !== null;
      })
      .map((a: LighthouseAudit) => ({
        title: a.title || 'Problema detectat',
        description: a.description || '',
        score: a.score ?? 0,
        displayValue: a.displayValue,
        // Assignem valors per defecte si falten a la interfÃ­cie
        impact: (a.score === 0 ? 'high' : 'medium') as 'high' | 'medium' | 'low',
        type: (a.score === 0 ? 'error' : 'warning') as 'error' | 'warning'
      }))
      .sort((a, b) => (a.score || 0) - (b.score || 0))
      .slice(0, 8); // Top 8 errors
  }

  // 5. Captura
  type ScreenshotDetails = { data?: string };
  const screenshotData = 
      rawData?.screenshot || 
      (googleAudits['final-screenshot']?.details as ScreenshotDetails)?.data || 
      '';

  const seoScore = audit.seoScore ?? 0;
  const perfScore = audit.performanceScore ?? 0;

  return (
    <div className="space-y-10 pb-20 max-w-7xl mx-auto">
      
      <AuditHeader 
        url={audit.url} 
        date={new Date(audit.createdAt)}
        pdfData={{
          url: audit.url,
          date: new Date(audit.createdAt).toLocaleDateString(),
          scores: { seo: seoScore, perf: perfScore, a11y: 85, best: 92 },
          screenshot: screenshotData,
          issues: displayIssues
        }}
      />

      <ScoreGrid seo={seoScore} perf={perfScore} />

      <div className="grid lg:grid-cols-3 gap-8 lg:gap-12">
         <div className="lg:col-span-2 space-y-10">
            {/* Passem l'objecte metrics net */}
            <CoreVitalsGrid metrics={metrics} />
            <IssuesList issues={displayIssues} />
         </div>

         <div className="lg:col-span-1">
            <div className="sticky top-8">
                <MobilePreview screenshot={screenshotData} />
            </div>
         </div>
      </div>

    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/layout.tsx ===================

import { Sidebar } from '@/components/dashboard/Sidebar';
import { MobileBottomBar } from './MobilBottomBar';
import { DashboardHeader } from '@/components/dashboard/DashboardHeader';
import { createClient } from '@/lib/supabase/server';
import { redirect } from '@/routing';

type Props = {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
};

export default async function DashboardLayout({ children, params }: Props) {
  const supabase = await createClient();
  const { data: { user }, error } = await supabase.auth.getUser();
  const { locale } = await params;

  if (error || !user) {
    redirect({ href: '/auth/login', locale });
  }

  return (
    // CANVI: bg-muted/10 o bg-background (colors semÃ ntics)
    // text-foreground assegura que el text sigui negre en light i blanc en dark
    <div className="min-h-screen bg-muted/10 flex font-sans text-foreground">
      
      {/* SIDEBAR */}
      <div className="hidden md:block w-64 shrink-0 z-40">
         <Sidebar />
      </div>

      {/* AREA PRINCIPAL */}
      <div className="flex-1 flex flex-col min-h-screen relative overflow-hidden">
         {/* Gradient subtil de fons (visible en light i dark) */}
         <div className="absolute top-0 left-0 w-full h-[500px] bg-primary/5 blur-[150px] pointer-events-none"></div>

         <DashboardHeader userEmail={user?.email ?? ''} />
         
         <main className="flex-1 p-4 md:p-8 overflow-y-auto relative z-10 pb-24 md:pb-8">
            {children}
         </main>

         <div className="md:hidden">
            <MobileBottomBar />
         </div>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/MobilBottomBar.tsx ===================

'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { LayoutDashboard, FileText, FolderKanban, Settings } from 'lucide-react';
import { cn } from '@/lib/utils';

const MENU_ITEMS = [
  { icon: LayoutDashboard, label: 'Resum', href: '/dashboard' },
  { icon: FileText, label: 'Audits', href: '/dashboard/audits' },
  { icon: FolderKanban, label: 'Proves', href: '#proves' }, 
  { icon: Settings, label: 'Ajustos', href: '#ajustos' },
];

export function MobileBottomBar() {
  const pathname = usePathname();
  
  // Netegem l'idioma (ex: /es/dashboard/audits/123 -> /dashboard/audits/123)
  const cleanPath = pathname.replace(/^\/[a-z]{2}/, '') || '/';

  const handleClick = (e: React.MouseEvent, href: string, label: string) => {
    if (href.startsWith('#')) {
      e.preventDefault();
      alert(`${label} estarÃ  disponible properament! ğŸš€`);
    }
  };

  return (
    <div className="fixed bottom-0 left-0 w-full z-50 bg-background/95 backdrop-blur-xl border-t border-border pb-safe transition-colors duration-300">
        <div className="flex justify-around items-center h-16 px-2">
            {MENU_ITEMS.map((item) => {
                const Icon = item.icon;

                // LÃ’GICA D'ACTIU (Igual que sidebar)
                let isActive = false;
                if (!item.href.startsWith('#')) {
                   if (item.href === '/dashboard') {
                      isActive = cleanPath === '/dashboard';
                   } else {
                      isActive = cleanPath.startsWith(item.href);
                   }
                }

                return (
                    <Link 
                        key={item.label} 
                        href={item.href}
                        onClick={(e) => handleClick(e, item.href, item.label)}
                        className={cn(
                            "flex flex-col items-center justify-center w-full h-full gap-1 active:scale-95 transition-transform",
                            isActive ? "text-primary" : "text-muted-foreground hover:text-foreground"
                        )}
                    >
                        <Icon 
                            className={cn("w-6 h-6 transition-all", isActive && "fill-current/20 scale-110")} 
                            strokeWidth={isActive ? 2.5 : 2} 
                        />
                        <span className={cn("text-[10px] font-medium", isActive ? "font-bold" : "")}>
                            {item.label}
                        </span>
                    </Link>
                );
            })}
        </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/new-audit/page.tsx ===================

import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation'; // ğŸ‘ˆ SOLUCIÃ“ 1: Importar el natiu
import { getLocale } from 'next-intl/server'; // ğŸ‘ˆ SOLUCIÃ“ 2: Per saber l'idioma
import { CreateAuditForm } from '@/features/audit/ui/components/CreateAuditForm';
import { ArrowLeft } from 'lucide-react';
import Link from 'next/link';

export default async function NewAuditPage() {
  const supabase = await createClient();
  const locale = await getLocale(); // Obtenim 'ca', 'es', etc.
  
  const { data: { user } } = await supabase.auth.getUser();

  // TypeScript ara entÃ©n que 'redirect' atura l'execuciÃ³ aquÃ­.
  // Per tant, a baix 'user' mai serÃ  null.
  if (!user) {
    redirect(`/${locale}/auth/login`);
  }

  return (
    <div className="max-w-2xl mx-auto py-8 px-4">
      
      <Link 
        href="/dashboard/audits" 
        className="flex items-center text-sm text-muted-foreground hover:text-foreground mb-8 transition-colors w-fit"
      >
         <ArrowLeft className="w-4 h-4 mr-2" /> Tornar al llistat
      </Link>

      {/* CONTENIDOR: Adaptat a Light (bg-white) i Dark (bg-fosc) */}
      <div className="bg-card border border-border rounded-2xl p-8 md:p-12 shadow-2xl relative overflow-hidden">
         
         {/* Fons decoratiu (Glow) */}
         <div className="absolute top-0 right-0 w-64 h-64 bg-primary/10 blur-[80px] rounded-full pointer-events-none"></div>

         <div className="relative z-10">
            <h1 className="text-3xl font-bold text-foreground mb-4">Nova Auditoria Web</h1>
            <p className="text-muted-foreground mb-8 leading-relaxed">
               Introdueix la URL del lloc web que vols analitzar. La nostra IA escanejarÃ  el SEO, el rendiment i l'accessibilitat en temps real.
            </p>

            {/* El formulari client-side */}
            {/* Ara TypeScript no es queixa perquÃ¨ sap que user existeix segur */}
            <CreateAuditForm  />
         </div>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/page.tsx ===================

import { getTranslations } from 'next-intl/server';
import { redirect } from 'next/navigation';
import { Link } from '@/routing';
import { createClient } from '@/lib/supabase/server';
import { auditRepository } from '@/services/container';
import { Activity, BarChart3, Clock, Plus } from 'lucide-react';
import { Button } from '@/components/ui/button';
// Assegura't d'importar el AuditCard reutilitzable
import { AuditCard } from '@/components/dashboard/AuditCard'; 

export default async function DashboardPage() {
    const supabase = await createClient();
    const t = await getTranslations('Dashboard');

    const { data: { user } } = await supabase.auth.getUser();

    if (!user || !user.email) {
        redirect('/');
    }

    const audits = await auditRepository.getAuditsByUserEmail(user.email);

    const totalAudits = audits.length;
    const validSeoScores = audits
        .filter(a => a.seoScore !== null && a.seoScore !== undefined)
        .map(a => a.seoScore as number);
    const avgSeo = validSeoScores.length > 0
        ? Math.round(validSeoScores.reduce((a, b) => a + b, 0) / validSeoScores.length)
        : 0;

    return (
        <div className="space-y-8 pb-24 md:pb-8"> 

            {/* HEADER */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 pb-6 border-b border-border">
                <div>
                    <h1 className="text-2xl md:text-3xl font-bold text-foreground">Hola, {user.email.split('@')[0]} ğŸ‘‹</h1>
                    <p className="text-muted-foreground mt-1 text-sm md:text-base">AquÃ­ tens el resum del teu ecosistema digital.</p>
                </div>
                <Link href="/" className="w-full md:w-auto">
                    <Button className="w-full md:w-auto gradient-bg text-white border-0 shadow-lg shadow-primary/20 hover:opacity-90">
                        <Plus className="w-4 h-4 mr-2" /> Nova Auditoria
                    </Button>
                </Link>
            </div>

            {/* KPI CARDS - Colors adaptats Light/Dark */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <KpiCard
                    label="Auditories Realitzades"
                    value={totalAudits.toString()}
                    icon={Activity}
                    // Blau fosc en light, Blau clar en dark
                    color="text-blue-600 dark:text-blue-400"
                    // Fons blau suau en light, Fons transparent en dark
                    bg="bg-blue-100 dark:bg-blue-500/10"
                />
                <KpiCard
                    label="SEO MitjÃ "
                    value={avgSeo > 0 ? `${avgSeo}/100` : '-'}
                    icon={BarChart3}
                    color="text-green-600 dark:text-green-400"
                    bg="bg-green-100 dark:bg-green-500/10"
                />
                <KpiCard
                    label="Estat del Sistema"
                    value="Operatiu"
                    icon={Clock}
                    color="text-purple-600 dark:text-purple-400"
                    bg="bg-purple-100 dark:bg-purple-500/10"
                />
            </div>

            {/* LLISTAT AUDITORIA */}
            {audits.length > 0 ? (
                <div>
                    <div className="flex items-center justify-between mb-6">
                        <h2 className="text-xl font-bold text-foreground">Projectes Recents</h2>
                        <Link href="/dashboard/audits" className="text-sm text-primary hover:underline font-medium">
                            Veure tot
                        </Link>
                    </div>

                    <div className="grid gap-4 md:gap-6 md:grid-cols-2 lg:grid-cols-3">
                        {audits.slice(0, 6).map((audit) => (
                            <AuditCard key={audit.id} audit={audit} />
                        ))}
                    </div>
                </div>
            ) : (
                /* EMPTY STATE */
                <div className="py-12 flex flex-col items-center justify-center text-center border-2 border-dashed border-border rounded-2xl bg-card/50">
                    <div className="w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4">
                        <Activity className="w-8 h-8 text-muted-foreground" />
                    </div>
                    <h3 className="text-lg font-bold text-foreground mb-2">Encara no tens projectes</h3>
                    <p className="text-muted-foreground mb-6 max-w-sm text-sm">
                        Analitza la teva primera web per descobrir errors de SEO i rendiment.
                    </p>
                    <Link href="/">
                        <Button variant="outline">ComenÃ§ar Auditoria</Button>
                    </Link>
                </div>
            )}
        </div>
    );
}

// --- COMPONENTS AUXILIARS ---

type KpiCardProps = {
    label: string;
    value: string;
    icon: React.ComponentType<{ className?: string }>;
    color: string;
    bg: string;
};

function KpiCard({ label, value, icon: Icon, color, bg }: KpiCardProps) {
    return (
        // âœ… SOLUCIÃ“: Use 'bg-card' i 'text-foreground' en lloc de colors fixos
        <div className="bg-card dark:bg-[#0f111a]/50 border border-border dark:border-white/5 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm flex flex-row md:flex-col items-center md:items-start gap-4 md:gap-0 justify-between md:justify-start transition-colors">
            
            {/* Icona i Label */}
            <div className="flex md:block items-center gap-3 md:gap-0 md:w-full md:mb-4">
                <div className={`p-2.5 md:p-3 rounded-lg md:rounded-xl ${bg} shrink-0`}>
                    <Icon className={`w-5 h-5 md:w-6 md:h-6 ${color}`} />
                </div>
                {/* MÃ²bil: label al costat */}
                <span className="text-sm text-muted-foreground md:hidden font-medium">{label}</span>
            </div>

            {/* Valor */}
            <div className="text-right md:text-left">
                <div className="text-2xl md:text-3xl font-bold text-foreground">{value}</div>
                {/* Desktop: label a sota */}
                <div className="text-sm text-muted-foreground hidden md:block font-medium">{label}</div>
            </div>
        </div>
    );
}

// =================== FILE: src/app/[locale]/layout.tsx ===================

import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';
import { notFound } from 'next/navigation';
import { routing, type Locale } from '@/routing'; 
import { Inter } from 'next/font/google';
import { ThemeProvider } from "@/components/theme-provider";
import "@/app/globals.css"; 
import type { Metadata, Viewport } from 'next';

// ğŸ‘‡ 1. IMPORTACIONS NOVES
import { Suspense } from 'react'; 
import { AnalyticsTracker } from '@/features/analytics/ui/AnalyticsTracker';

const inter = Inter({ 
  subsets: ['latin'], 
  variable: '--font-inter',
  display: 'swap',
});

// 1. CONFIGURACIÃ“ DEL VIEWPORT
export const viewport: Viewport = {
  themeColor: [
    { media: '(prefers-color-scheme: light)', color: 'white' },
    { media: '(prefers-color-scheme: dark)', color: '#020817' },
  ],
  width: 'device-width',
  initialScale: 1,
  maximumScale: 1,
};

// 2. METADADES GLOBALS
export const metadata: Metadata = {
  title: {
    default: 'DigitAI Studios | Desenvolupament Web & IA',
    template: '%s | DigitAI Studios'
  },
  description: 'Transformem negocis amb AppWebs, Apps Natives i AutomatitzaciÃ³ IA. Solucions digitals 360Â°.',
  keywords: ['Desenvolupament Web', 'App', 'React Native', 'Next.js', 'IA', 'AutomatitzaciÃ³', 'Girona'],
  authors: [{ name: 'DigitAI Studios' }],
  creator: 'DigitAI Studios',
  manifest: '/manifest.webmanifest',
  icons: {
    icon: '/icons/icon-192.png',
    shortcut: '/icons/icon-192.png',
    apple: '/icons/apple-icon.png',
    other: {
      rel: 'apple-touch-icon-precomposed',
      url: '/icons/apple-icon.png',
    },
  },
  openGraph: {
    type: 'website',
    locale: 'ca_ES',
    url: 'https://digitaistudios.com',
    title: 'DigitAI Studios | InnovaciÃ³ Digital',
    description: 'Apps, Webs i AutomatitzaciÃ³ IA per a empreses modernes.',
    siteName: 'DigitAI Studios',
    images: [
      {
        url: '/images/og-image.jpg', // Nota: Millor ruta pÃºblica directa que '@/assets'
        width: 1200,
        height: 630,
        alt: 'DigitAI Studios Cover',
      },
    ],
  },
};

export default async function LocaleLayout({
  children,
  params
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  const { locale } = await params;

  if (!routing.locales.includes(locale as Locale)) {
    notFound();
  }

  const messages = await getMessages();

  return (
    <html lang={locale} className={inter.variable} suppressHydrationWarning>
      <body className="antialiased bg-background text-foreground overflow-x-hidden transition-colors duration-300">
        <NextIntlClientProvider messages={messages}>
          <ThemeProvider
            attribute="class"
            defaultTheme="system"
            enableSystem
            disableTransitionOnChange
          >
            {/* ğŸ‘‡ 2. AQUÃ ESTÃ€ LA MÃ€GIA: SUSPENSE + TRACKER */}
            {/* Suspense evita que el layout es bloquegi esperant parÃ metres de URL */}
            <Suspense fallback={null}>
              <AnalyticsTracker />
            </Suspense>

            {children}
          </ThemeProvider>
        </NextIntlClientProvider>
      </body>
    </html>
  );
}

// =================== FILE: src/components/admin/AminMobileMenu.tsx ===================

'use client';

import { Link, usePathname } from '@/routing';
import { LayoutDashboard, BarChart3, Users, Home } from 'lucide-react';
import { cn } from '@/lib/utils';

export function AdminBottomNav() {
  const pathname = usePathname();

  const navLinks = [
    { 
      href: '/admin', 
      label: 'Inici', 
      icon: LayoutDashboard 
    },
    { 
      href: '/admin/analytics', 
      label: 'MÃ¨triques', 
      icon: BarChart3 
    },
    { 
      href: '/admin/users', 
      label: 'Usuaris', 
      icon: Users 
    },
  ];

  return (
    <div className="md:hidden fixed bottom-0 left-0 right-0 z-50 bg-slate-950 border-t border-slate-800 pb-safe">
      <nav className="flex items-center justify-around h-16">
        {navLinks.map((link) => {
          const Icon = link.icon;
          // Comprovem si la ruta coincideix exactament o si Ã©s una subruta
          const isActive = pathname === link.href;

          return (
            <Link
              key={link.href}
              href={link.href}
              className={cn(
                "flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors duration-200",
                isActive 
                  ? "text-blue-400" 
                  : "text-slate-500 hover:text-slate-300"
              )}
            >
              <Icon className={cn("w-6 h-6", isActive && "fill-current/20")} />
              <span className="text-[10px] font-medium">{link.label}</span>
            </Link>
          );
        })}

        {/* BotÃ³ separat per tornar a la web pÃºblica */}
        <Link
          href="/"
          className="flex flex-col items-center justify-center w-full h-full space-y-1 text-slate-600 hover:text-slate-400"
        >
          <Home className="w-6 h-6" />
          <span className="text-[10px] font-medium">Web</span>
        </Link>
      </nav>
    </div>
  );
}

// =================== FILE: src/components/charts/ScoreRing.tsx ===================

'use client';
import { RadialBarChart, RadialBar, PolarAngleAxis, ResponsiveContainer } from 'recharts';

export function ScoreRing({ score, label }: { score: number; label: string }) {
  // Color dinÃ mic
  const color = score >= 90 ? '#10b981' : score >= 50 ? '#f59e0b' : '#ef4444';
  
  const data = [{ name: 'Score', value: score, fill: color }];

  return (
    <div className="flex flex-col items-center justify-center w-full h-full">
        <div className="relative w-[120px] h-[120px]">
            <ResponsiveContainer width="100%" height="100%">
                <RadialBarChart 
                    innerRadius="80%" 
                    outerRadius="100%" 
                    barSize={10} 
                    data={data} 
                    startAngle={90} 
                    endAngle={-270}
                >
                    <PolarAngleAxis type="number" domain={[0, 100]} angleAxisId={0} tick={false} />
                    <RadialBar background dataKey="value" cornerRadius={10} />
                </RadialBarChart>
            </ResponsiveContainer>
            {/* Text al centre */}
            <div className="absolute inset-0 flex items-center justify-center">
                <span className="text-3xl font-bold" style={{ color }}>{score}</span>
            </div>
        </div>
        <p className="mt-2 text-sm font-medium text-slate-500 uppercase tracking-wider">{label}</p>
    </div>
  );
}

// =================== FILE: src/components/dashboard/AuditCard.tsx ===================

'use client';

import { Link } from '@/routing';
import { Card, CardContent } from '@/components/ui/card';
import { ArrowRight, Globe } from 'lucide-react';

type AuditProps = {
  id: string;
  url: string;
  status: 'processing' | 'completed' | 'failed';
  seoScore: number | null;
  createdAt: string | Date;
};

export function AuditCard({ audit }: { audit: AuditProps }) {
  return (
    <Link href={`/dashboard/audits/${audit.id}`} className="block group h-full">
      {/* Estil Fosc + Light Adaptable (bg-card en light, fons fosc en dark) */}
      <Card className="bg-card dark:bg-[#0f111a]/50 border border-border dark:border-white/5 hover:border-primary/50 transition-all h-full shadow-sm hover:shadow-md group-hover:-translate-y-1 backdrop-blur-sm">
        <CardContent className="p-6 flex flex-col h-full">
          
          {/* Header Card */}
          <div className="flex justify-between items-start mb-4">
            <div className="p-2.5 bg-muted dark:bg-white/5 rounded-lg text-muted-foreground group-hover:text-primary group-hover:bg-primary/10 transition-colors">
              <Globe className="w-5 h-5" />
            </div>
            <StatusBadge status={audit.status} />
          </div>

          {/* Body Card */}
          <div className="flex-grow">
            <h3 className="text-lg font-bold text-foreground dark:text-white truncate mb-1" title={audit.url}>
              {audit.url.replace(/^https?:\/\//, '').replace(/\/$/, '')}
            </h3>
            <p className="text-xs text-muted-foreground dark:text-slate-500 mb-6">
              {new Date(audit.createdAt).toLocaleDateString()}
            </p>
          </div>

          {/* Footer Card */}
          <div className="mt-auto flex items-center justify-between pt-4 border-t border-border dark:border-white/5">
            <div className="flex flex-col">
              <span className="text-[10px] uppercase tracking-wider text-muted-foreground font-bold">SEO SCORE</span>
              <span className={`text-xl font-bold ${getScoreColor(audit.seoScore ?? 0)}`}>
                {audit.seoScore ?? '-'}
              </span>
            </div>
            <div className="w-8 h-8 rounded-full bg-muted dark:bg-white/5 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-all text-muted-foreground">
              <ArrowRight className="w-4 h-4" />
            </div>
          </div>
        </CardContent>
      </Card>
    </Link>
  );
}

// Helpers locals
function StatusBadge({ status }: { status: string }) {
  const styles = {
    completed: 'text-green-600 bg-green-100 border-green-200 dark:text-green-400 dark:bg-green-500/10 dark:border-green-500/20',
    processing: 'text-blue-600 bg-blue-100 border-blue-200 dark:text-blue-400 dark:bg-blue-500/10 dark:border-blue-500/20 animate-pulse',
    failed: 'text-red-600 bg-red-100 border-red-200 dark:text-red-400 dark:bg-red-500/10 dark:border-red-500/20'
  };
  const label = status === 'completed' ? 'Completada' : status === 'processing' ? 'Analitzant' : 'Error';

  return (
    <span className={`px-2.5 py-1 rounded-full text-[10px] uppercase font-bold tracking-wider border ${styles[status as keyof typeof styles] || 'text-muted-foreground bg-muted border-border'}`}>
      {label}
    </span>
  );
}

function getScoreColor(score: number) {
  if (score >= 90) return 'text-green-600 dark:text-green-400';
  if (score >= 50) return 'text-yellow-600 dark:text-yellow-400';
  return 'text-red-600 dark:text-red-400';
}

// =================== FILE: src/components/dashboard/DashboardHeader.tsx ===================

'use client';

import { Bell, Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { ThemeToggle } from '@/components/ui/theme-toggle';

export function DashboardHeader({ userEmail }: { userEmail?: string }) {
  return (
    <header className="h-16 border-b border-border bg-background/80 backdrop-blur-xl sticky top-0 z-30 px-4 md:px-6 flex items-center justify-between transition-colors duration-300">
       
       {/* SEARCH BAR (S'adapta o s'amaga en mÃ²bil molt petit) */}
       <div className="flex items-center w-full max-w-xs md:max-w-md mr-4">
          <div className="relative w-full">
             <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
             <Input 
                placeholder="Cercar..." 
                className="pl-10 bg-muted/50 border-transparent focus:bg-background focus:border-primary transition-all h-9 rounded-full"
             />
          </div>
       </div>

       {/* ACTIONS & PROFILE */}
       <div className="flex items-center gap-2 md:gap-4 shrink-0">
          
          {/* BotÃ³ de Tema (Clar/Fosc) */}
          <ThemeToggle />

          {/* Notificacions */}
          <Button variant="ghost" size="icon" className="relative rounded-full text-muted-foreground hover:text-foreground">
             <Bell className="w-5 h-5" />
             <span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-background"></span>
          </Button>
          
          {/* Separador */}
          <div className="h-6 w-px bg-border mx-1 hidden sm:block"></div>

          {/* Perfil */}
          <div className="flex items-center gap-3">
             <div className="text-right hidden md:block">
                <p className="text-sm font-medium text-foreground leading-none">Compte</p>
                <p className="text-xs text-muted-foreground truncate max-w-[120px]">{userEmail}</p>
             </div>
             <div className="w-9 h-9 rounded-full bg-gradient-to-br from-primary to-blue-500 flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-background">
                {userEmail ? userEmail.charAt(0).toUpperCase() : 'U'}
             </div>
          </div>
       </div>
    </header>
  );
}

// =================== FILE: src/components/dashboard/Sidebar.tsx ===================

'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { LayoutDashboard, FileText, FolderKanban, Settings, LogOut, Sparkles } from 'lucide-react';
import { cn } from '@/lib/utils';
import { createClient } from '@/lib/supabase/client';
import { useRouter } from '@/routing';

const MENU_ITEMS = [
  { icon: LayoutDashboard, label: 'Resum', href: '/dashboard' },
  { icon: FileText, label: 'Auditories', href: '/dashboard/audits' },
  { icon: FolderKanban, label: 'Projectes', href: '#projectes' },
  { icon: Settings, label: 'ConfiguraciÃ³', href: '#config' },
];

export function Sidebar() {
  const pathname = usePathname();
  const router = useRouter();
  const supabase = createClient();

  const handleSignOut = async () => {
    await supabase.auth.signOut();
    router.refresh();
    router.push('/auth/login');
  };

  const handleClick = (e: React.MouseEvent, href: string, label: string) => {
    if (href.startsWith('#')) {
      e.preventDefault();
      alert(`${label} estarÃ  disponible properament! ğŸš€`);
    }
  };

  // FunciÃ³ per netejar l'idioma del path (ex: /es/dashboard -> /dashboard)
  const cleanPath = pathname.replace(/^\/[a-z]{2}/, '') || '/';

  return (
    <aside className="w-64 h-screen bg-card border-r border-border flex flex-col sticky top-0 transition-colors duration-300">
      
      {/* LOGO AREA */}
      <div className="p-6 border-b border-border">
        <Link href="/" className="flex items-center gap-2 text-xl font-bold text-foreground">
           DigitAI <span className="text-primary">Hub</span>
        </Link>
      </div>

      {/* NAVIGATION */}
      <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
        <div className="text-xs font-bold text-muted-foreground uppercase tracking-widest mb-4 px-2">
           Plataforma
        </div>
        
        {MENU_ITEMS.map((item) => {
          // LÃ’GICA MILLORADA D'ACTIU:
          // 1. Si Ã©s un placeholder (#), mai Ã©s actiu.
          // 2. Si Ã©s el Dashboard principal, ha de ser EXACTE ('/dashboard').
          // 3. Si Ã©s qualsevol altre (ex: /dashboard/audits), ha de COMENÃ‡AR per la ruta.
          
          let isActive = false;
          if (!item.href.startsWith('#')) {
             if (item.href === '/dashboard') {
                isActive = cleanPath === '/dashboard';
             } else {
                isActive = cleanPath.startsWith(item.href);
             }
          }
          
          return (
            <Link 
              key={item.label} 
              href={item.href}
              onClick={(e) => handleClick(e, item.href, item.label)}
              className={cn(
                "flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200",
                isActive 
                  ? "bg-primary/10 text-primary border border-primary/20 shadow-sm" 
                  : "text-muted-foreground hover:text-foreground hover:bg-muted"
              )}
            >
              <item.icon className={cn("w-5 h-5", isActive ? "text-primary" : "text-muted-foreground")} />
              {item.label}
            </Link>
          );
        })}

        {/* CAIXA PROMO */}
        <div className="mt-8 p-4 rounded-xl bg-gradient-to-br from-primary/10 to-blue-500/10 border border-primary/20 relative overflow-hidden">
           <div className="absolute top-0 right-0 w-20 h-20 bg-primary/20 blur-2xl rounded-full pointer-events-none"></div>
           <div className="flex items-center gap-2 text-foreground font-bold text-sm mb-2">
              <Sparkles className="w-4 h-4 text-primary" />
              Pla Pro
           </div>
           <p className="text-xs text-muted-foreground mb-3">Desbloqueja auditories ilÂ·limitades.</p>
           <button className="w-full py-1.5 text-xs font-bold bg-primary text-primary-foreground rounded-lg hover:opacity-90 transition-opacity">
              Millorar
           </button>
        </div>
      </nav>

      {/* FOOTER / LOGOUT */}
      <div className="p-4 border-t border-border">
        <button 
          onClick={handleSignOut}
          className="flex items-center gap-3 w-full px-3 py-2.5 rounded-lg text-sm font-medium text-muted-foreground hover:text-red-500 hover:bg-red-500/10 transition-colors"
        >
          <LogOut className="w-5 h-5" />
          Tancar SessiÃ³
        </button>
      </div>
    </aside>
  );
}

// =================== FILE: src/components/landing/AuditSection.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { AuditForm } from '@/features/audit/ui/AuditForm';

export function AuditSection() {
  return (
    <section id="audit" className="py-14 relative overflow-hidden bg-background transition-colors duration-300">
      
      {/* FONS DECORATIU: Adaptable Light/Dark */}
      {/* Gradient central molt suau */}
      <div className="absolute inset-0 bg-linear-to-b from-transparent via-primary/5 to-transparent pointer-events-none" />
      
      {/* Cercles decoratius de fons (Glow) */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-blue-500/10 dark:bg-primary/10 blur-[120px] rounded-full pointer-events-none opacity-50" />

      <div className="container mx-auto px-4 relative z-10">
        
        <div className="max-w-3xl mx-auto text-center mb-12">
          <motion.div 
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
          >
        

            <h2 className="text-3xl lg:text-5xl font-bold mb-6 text-foreground leading-tight">
              La teva web Ã©s un <span className="text-red-500/80 line-through decoration-2">cost</span> o una <span className="gradient-text">InversiÃ³</span>?
            </h2>
            
            <p className="text-lg text-muted-foreground leading-relaxed">
              El 40% dels usuaris abandonen una web si triga mÃ©s de 3 segons.
              <br className="hidden md:block" />
              Deixa que la nostra IA analitzi el teu site i et digui exactament quÃ¨ estÃ  fallant.
            </p>
          </motion.div>
        </div>

        {/* FORMULARI */}
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ delay: 0.2 }}
          className="max-w-xl mx-auto transform hover:scale-[1.01] transition-transform duration-500"
        >
          <AuditForm />
        </motion.div>

      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/BenefitsSection.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { 
  Clock, 
  TrendingUp, 
  Zap, 
  Target, 
  Share2, 
  BrainCircuit 
} from 'lucide-react';

const BENEFITS = [
  {
    icon: Clock,
    title: 'Estalvi de temps',
    description: 'Automatitza tasques repetitives i allibera fins a 40 hores setmanals per centrar-te en el que realment importa.'
  },
  {
    icon: TrendingUp,
    title: 'Productivitat x3',
    description: "Incrementa l'eficiÃ¨ncia del teu equip amb processos intelÂ·ligents i fluxos de treball sense errors."
  },
  {
    icon: Zap,
    title: 'Respostes 24/7',
    description: 'Chatbots intelÂ·ligents que atenen els teus clients a qualsevol hora, sense descans i amb precisiÃ³.'
  },
  {
    icon: Target,
    title: 'AdaptaciÃ³ a mida',
    description: "No et donem una plantilla. La nostra IA s'entrena amb les dades especÃ­fiques del teu negoci."
  },
  {
    icon: Share2,
    title: 'MÃ rqueting Autopilot',
    description: 'GeneraciÃ³ i publicaciÃ³ de contingut a xarxes socials de forma autÃ²noma i estratÃ¨gica.'
  },
  {
    icon: BrainCircuit,
    title: 'Decisions amb Dades',
    description: 'AnalÃ­tica predictiva per anticipar-te a les tendÃ¨ncies del mercat i prendre millors decisions.'
  }
];

export function BenefitsSection() {
  return (
    <section id="beneficis" className="py-24 relative overflow-hidden">
      {/* Element decoratiu de fons */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-primary/5 rounded-full blur-3xl -z-10" />

      <div className="container mx-auto px-4">
        {/* CapÃ§alera de secciÃ³ */}
        <motion.div 
          initial={{ opacity: 0, y: 30 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true, margin: "-100px" }}
          className="text-center mb-16 max-w-3xl mx-auto"
        >
          <h2 className="text-4xl lg:text-5xl font-bold mb-6">
            Beneficis de la <span className="gradient-text">Nova Era</span>
          </h2>
          <p className="text-xl text-muted-foreground">
            La tecnologia no ha de ser complicada. Descobreix com simplifiquem el teu dia a dia.
          </p>
        </motion.div>
        
        {/* Graella de beneficis */}
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {BENEFITS.map((benefit, index) => (
            <motion.div
              key={index}
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: index * 0.1 }}
              whileHover={{ y: -5 }}
              className="solution-card-futuristic p-8 rounded-3xl flex flex-col items-center text-center group"
            >
              <div className="benefit-icon group-hover:scale-110 transition-transform duration-300">
                <benefit.icon className="h-8 w-8 text-white" />
              </div>
              <h3 className="text-xl font-bold mb-3">{benefit.title}</h3>
              <p className="text-muted-foreground leading-relaxed">
                {benefit.description}
              </p>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/ContactSection.tsx ===================

'use client';

import { useActionState, useState } from 'react';
import { submitContactForm } from '@/actions/contact';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Checkbox } from '@/components/ui/checkbox';
import { Link } from '@/routing';
import { Loader2, Send, Bot, Code2, Rocket, Shield, Users } from 'lucide-react';
import { motion } from 'framer-motion';

export function ContactSection() {
  const [state, action, isPending] = useActionState(submitContactForm, { success: false });
  const [serviceType, setServiceType] = useState('ia'); // 'ia' o 'web'
  
  // Estat del checkbox
  const [termsAccepted, setTermsAccepted] = useState(false);

  return (
    <section id="contacte" className="py-24 bg-background relative overflow-hidden transition-colors duration-300">
      
      {/* Fons decoratiu */}
      <div className="absolute top-0 left-0 w-full h-full bg-linear-to-b from-transparent via-primary/5 to-transparent pointer-events-none" />

      <div className="container mx-auto px-4 grid lg:grid-cols-2 gap-16 items-start relative z-10">
        
        {/* COLUMNA ESQUERRA: Text i Punts */}
        <motion.div 
          initial={{ opacity: 0, x: -20 }} 
          whileInView={{ opacity: 1, x: 0 }} 
          viewport={{ once: true }}
          className="space-y-10"
        >
           <div>
             <h2 className="text-4xl lg:text-5xl font-bold mb-6 text-foreground leading-tight">
               ComenÃ§a la teva <span className="gradient-text">transformaciÃ³</span>
             </h2>
             <p className="text-muted-foreground text-lg leading-relaxed max-w-lg">
               Tota gran empresa comenÃ§a amb una decisiÃ³. Contacta amb nosaltres i descobreix com l'automatitzaciÃ³ pot revolucionar el teu negoci.
             </p>
           </div>

           <div className="space-y-8">
              {[
                { icon: Rocket, title: "ImplementaciÃ³ Ã€gil", desc: "Sense mesos d'espera. Llancem en setmanes." },
                { icon: Shield, title: "Tecnologia SÃ²lida", desc: "Next.js, React Native i Supabase. Res de Wordpress vell." },
                { icon: Users, title: "Partners, no ProveÃ¯dors", desc: "T'acompanyem en l'estratÃ¨gia, no nomÃ©s en el codi." }
              ].map((item, i) => (
                <div key={i} className="flex gap-5 items-start group">
                  <div className="mt-1 w-12 h-12 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                    <item.icon className="w-6 h-6 text-primary" />
                  </div>
                  <div>
                    <h3 className="font-bold text-foreground text-xl mb-1">{item.title}</h3>
                    <p className="text-muted-foreground leading-relaxed">{item.desc}</p>
                  </div>
                </div>
              ))}
           </div>
        </motion.div>

        {/* COLUMNA DRETA: Formulari Adaptable */}
        <motion.div 
           initial={{ opacity: 0, x: 20 }} 
           whileInView={{ opacity: 1, x: 0 }} 
           viewport={{ once: true }}
           className="bg-card border border-border rounded-3xl p-8 lg:p-10 shadow-2xl relative overflow-hidden"
        >
          {/* Glow interior */}
          <div className="absolute top-0 right-0 w-64 h-64 bg-primary/10 blur-[80px] rounded-full pointer-events-none"></div>

          <form action={action} className="space-y-6 relative z-10">
            
            {/* SELECTOR TIPUS (TOGGLE) */}
            <div className="grid grid-cols-2 gap-4 mb-8">
               <button
                  type="button"
                  onClick={() => setServiceType('ia')}
                  className={`p-4 rounded-xl border transition-all flex flex-col items-center gap-3 ${
                    serviceType === 'ia' 
                      ? 'border-primary bg-primary/10 text-primary ring-1 ring-primary shadow-inner' 
                      : 'border-border bg-muted/30 text-muted-foreground hover:bg-muted/50 hover:border-primary/30'
                  }`}
               >
                  <Bot className="w-7 h-7" />
                  <span className="font-bold text-sm">IA & AutomatitzaciÃ³</span>
               </button>
               <button
                  type="button"
                  onClick={() => setServiceType('web')}
                  className={`p-4 rounded-xl border transition-all flex flex-col items-center gap-3 ${
                    serviceType === 'web' 
                      ? 'border-primary bg-primary/10 text-primary ring-1 ring-primary shadow-inner' 
                      : 'border-border bg-muted/30 text-muted-foreground hover:bg-muted/50 hover:border-primary/30'
                  }`}
               >
                  <Code2 className="w-7 h-7" />
                  <span className="font-bold text-sm">Webs & Apps</span>
               </button>
               <input type="hidden" name="service" value={serviceType === 'ia' ? 'AutomatitzaciÃ³ i IA' : 'CreaciÃ³ Web'} />
            </div>

            {/* INPUTS */}
            <div className="space-y-5">
              <div className="space-y-2">
                <label className="text-sm font-bold text-foreground ml-1">Nom complet</label>
                <Input 
                  name="fullName" 
                  placeholder="Joan Garcia" 
                  required 
                  className="bg-background border-input focus:border-primary h-12 text-foreground placeholder:text-muted-foreground/50" 
                />
              </div>
              
              <div className="space-y-2">
                 <label className="text-sm font-bold text-foreground ml-1">Email corporatiu</label>
                 <Input 
                   name="email" 
                   type="email" 
                   placeholder="joan@empresa.com" 
                   required 
                   className="bg-background border-input focus:border-primary h-12 text-foreground placeholder:text-muted-foreground/50" 
                 />
              </div>

              <div className="space-y-2">
                 <label className="text-sm font-bold text-foreground ml-1">Explica'ns el teu projecte...</label>
                 <textarea 
                   name="message" 
                   rows={4} 
                   placeholder="Vull automatitzar les reserves o crear una app per a..."
                   className="w-full rounded-lg border border-input bg-background px-4 py-3 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none placeholder:text-muted-foreground/50"
                 />
              </div>
            </div>

            {/* CHECKBOX LEGAL CONTROLAT */}
            <div className="flex items-start space-x-3 pt-2">
              <Checkbox 
                id="privacy-contact" 
                name="privacy" 
                value="on" 
                checked={termsAccepted}
                onCheckedChange={(checked) => setTermsAccepted(checked as boolean)}
                required 
                className="mt-1 border-muted-foreground/30 data-[state=checked]:bg-primary data-[state=checked]:border-primary" 
              />
              <label htmlFor="privacy-contact" className="text-sm text-muted-foreground leading-snug cursor-pointer select-none">
                He llegit i accepto la <Link href="/legal/privacitat" target="_blank" className="underline hover:text-primary transition-colors">polÃ­tica de privacitat</Link> i el tractament de les meves dades.
              </label>
            </div>

            {/* BOTÃ“ AMB ESTAT DISABLED I TOOLTIP */}
            <div className="relative group">
                <Button 
                  type="submit" 
                  // Desactivem si estÃ  enviant (isPending) O si NO ha acceptat termes
                  disabled={isPending || !termsAccepted} 
                  className={`w-full h-14 text-lg font-bold rounded-xl transition-all shadow-lg shadow-primary/25 flex items-center justify-center ${
                     termsAccepted 
                     ? 'gradient-bg text-white hover:opacity-90' 
                     : 'bg-muted text-muted-foreground cursor-not-allowed opacity-60'
                  }`}
                >
                  {isPending ? <Loader2 className="animate-spin mr-2" /> : <Send className="mr-2 w-5 h-5" />}
                  Enviar Missatge
                </Button>
                
                {/* Tooltip flotant si intenten passar per sobre sense acceptar */}
                {!termsAccepted && (
                    <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-foreground text-background text-xs px-3 py-1.5 rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap font-medium z-20">
                        Marca la casella per continuar
                        <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-foreground rotate-45"></div>
                    </div>
                )}
            </div>

            {state?.message && (
                <motion.div 
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className={`text-center text-sm font-medium mt-4 p-3 rounded-lg border ${
                        state.success 
                        ? 'bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400' 
                        : 'bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400'
                    }`}
                >
                    {state.message}
                </motion.div>
            )}

          </form>
        </motion.div>

      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/HeroSection.tsx ===================

'use client';

import { useState, useRef, useEffect } from 'react';
import { motion } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { PlayCircle, Volume2, VolumeX, Pause, Play } from 'lucide-react';
import Image from 'next/image';
import Link from 'next/link';

export function HeroSection() {
  const [showVideo, setShowVideo] = useState(true);
  const [isMuted, setIsMuted] = useState(true);
  const [isPlaying, setIsPlaying] = useState(true);
  const videoRef = useRef<HTMLVideoElement>(null);

  // Control de reproducciÃ³ en canviar de pestanya
  useEffect(() => {
    const videoElement = videoRef.current;
    if (!videoElement) return;

    const handleVisibilityChange = () => {
      if (document.hidden && !videoElement.paused) {
        videoElement.pause();
      } else if (!document.hidden && isPlaying) {
        videoElement.play();
      }
    };
    document.addEventListener('visibilitychange', handleVisibilityChange);
    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);
  }, [isPlaying]);

  const togglePlay = () => {
    if (!videoRef.current) return;
    if (videoRef.current.paused) {
      videoRef.current.play();
      setIsPlaying(true);
    } else {
      videoRef.current.pause();
      setIsPlaying(false);
    }
  }

  return (
    <section id="inici" className="pt-32 pb-20 min-h-screen flex items-center hero-pattern overflow-hidden relative">

      {/* Element de fons (opcional) */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-primary/5 rounded-full blur-[120px] -z-10" />

      <div className="container mx-auto px-4 grid lg:grid-cols-2 gap-16 items-center">

        {/* COLUMNA ESQUERRA: Text */}
        <motion.div
          initial={{ opacity: 0, x: -50 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.8 }}
        >


          <h1 className="text-5xl lg:text-7xl font-bold mb-6 leading-tight">
            Creem la teva <span className="gradient-text">AppWeb</span>.<br />
            Automatitzem el <span className="text-foreground">dia a dia</span>.
          </h1>

          <p className="text-xl text-muted-foreground mb-8 leading-relaxed max-w-lg">
            Deixa de perdre temps en tasques manuals.
            Desenvolupem plataformes a mida i t'ensenyem a utilitzar la IA per escalar el teu negoci.
          </p>

          <div className="flex flex-col sm:flex-row gap-4">
            <Link href="#contacte">
              <Button size="lg" className="text-lg px-8 py-6 rounded-full gradient-bg hover:opacity-90 shadow-lg shadow-primary/20 transition-all w-full sm:w-auto text-white border-0">
                Parlem del teu Projecte
              </Button>
            </Link>
            <Link href="#audit">
              <Button variant="outline" size="lg" className="text-lg px-8 py-6 rounded-full border-input bg-background hover:bg-muted text-foreground w-full sm:w-auto">
                Auditoria GratuÃ¯ta
              </Button>
            </Link>
          </div>
        </motion.div>

        {/* COLUMNA DRETA: Marc del VÃ­deo */}
        <motion.div
          initial={{ opacity: 0, x: 50 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.8, delay: 0.2 }}
          className="relative"
        >
          {/* ğŸ› ï¸ FIX: Ãšs de variables semÃ ntiques (bg-card, border-border)
              AixÃ² farÃ  que agafi el color lila fosc del teu globals.css en Dark Mode
              i el color blanc en Light Mode automÃ ticament.
          */}
          <div className={`relative w-full aspect-video bg-card rounded-xl border border-border shadow-2xl overflow-hidden group transition-colors duration-300 ${!showVideo ? 'animate-floating' : ''}`}>

            {/* Barra superior estil navegador (Ara s'adapta al tema) */}
            <div className="h-8 border-b border-border bg-muted/50 flex items-center px-4 gap-2 z-20 relative transition-colors">
              <div className="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
              <div className="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
              <div className="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
              {/* URL Bar */}
              <div className="ml-4 px-3 py-0.5 rounded bg-background/50 text-[10px] text-muted-foreground font-mono border border-border hidden sm:block">
                digitai-studios.app
              </div>
            </div>

            {/* Contingut del VÃ­deo */}
            <div className="relative w-full h-[calc(100%-2rem)] bg-black"> {/* El fons del vÃ­deo sempre negre */}
              {showVideo ? (
                <div className="relative w-full h-full">
                  <video
                    ref={videoRef}
                    className="w-full h-full object-cover"
                    autoPlay
                    muted={isMuted}
                    loop
                    playsInline
                    // ğŸ‘‡ AixÃ² ens ajudarÃ  a saber si falla
                    onError={(e) => console.error("Error carregant vÃ­deo:", e)}
                  >
                    <source src="/videos/hero-video.mp4" type="video/mp4" />
                    {/* Fallback si el format falla */}
                    El teu navegador no suporta vÃ­deos.
                  </video>

                  {/* Controls Overlay */}
                  <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4 backdrop-blur-[2px]">
                    <button onClick={togglePlay} className="text-white hover:scale-110 transition-transform p-4 bg-white/10 rounded-full border border-white/20">
                      {isPlaying ? <Pause size={32} fill="currentColor" /> : <Play size={32} fill="currentColor" />}
                    </button>
                    <button onClick={() => setIsMuted(!isMuted)} className="absolute bottom-4 right-4 text-white p-2 bg-black/50 rounded-full hover:bg-black/70 transition-colors">
                      {isMuted ? <VolumeX size={20} /> : <Volume2 size={20} />}
                    </button>
                  </div>
                </div>
              ) : (
                <div className="relative w-full h-full cursor-pointer group-hover:opacity-90 transition-opacity" onClick={() => setShowVideo(true)}>
                  <Image
                    src="/images/hero.webp"
                    alt="Equip divers colÂ·laborant"
                    fill
                    className="object-cover"
                    priority
                  />
                  <div className="absolute inset-0 flex items-center justify-center bg-black/30">
                    <PlayCircle className="w-20 h-20 text-white/80 drop-shadow-lg" />
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Floating Cards (Decoratives) - Adaptades al tema */}
          <div className="absolute -bottom-6 -left-6 bg-card/90 backdrop-blur-md border border-border p-4 rounded-xl flex items-center gap-3 animate-pulse-glow shadow-xl z-30 transition-colors">
            <div className="relative">
              <div className="w-3 h-3 bg-green-500 rounded-full animate-ping absolute opacity-75"></div>
              <div className="w-3 h-3 bg-green-500 rounded-full relative"></div>
            </div>
            <div>
              <div className="text-[10px] text-muted-foreground uppercase font-bold tracking-wider">ESTAT</div>
              <span className="font-medium text-sm text-foreground">Sistemes Operatius</span>
            </div>
          </div>

        </motion.div>

      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/ProblemSolutionsSection.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { Calendar, BarChart3, Smartphone, X, Store, ArrowRight, CheckCircle2 } from 'lucide-react';

export function ProblemSolutionSection() {
  return (
    <section className="py-24 container mx-auto px-4 relative overflow-hidden transition-colors duration-300">
      
      <div className="grid lg:grid-cols-2 gap-16 items-center">
        
        {/* 1. TEXT NARRATIU */}
        <motion.div 
          initial={{ opacity: 0, x: -20 }}
          whileInView={{ opacity: 1, x: 0 }}
          viewport={{ once: true }}
        >
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/20 bg-primary/5 text-primary text-xs font-bold mb-6 uppercase tracking-wider">
             MÃ©s que una pÃ gina web
          </div>

          <h2 className="text-4xl lg:text-5xl font-bold mb-6 text-foreground leading-tight">
            La teva web ha de <span className="gradient-text">Facturar</span>, <br />
            no nomÃ©s "ser-hi".
          </h2>
          
          <p className="text-muted-foreground text-lg mb-8 leading-relaxed">
            La majoria de negocis tenen una "Targeta de Visita" digital: bonica, perÃ² inÃºtil.
            No permet reservar, no ven i no fidelitza.
            <br /><br />
            Nosaltres transformem la teva web en una **AppWeb (PWA)**: una eina potent on els teus clients poden comprar, reservar hora i interactuar amb tu des del seu mÃ²bil, sense descarregar res.
          </p>

          <ul className="space-y-4 mb-8">
            {[
              "Cites prÃ¨vies i reserves automÃ tiques.",
              "Botiga online i pagaments integrats.",
              "InstalÂ·lable al mÃ²bil (PWA) com una App nativa."
            ].map((item, i) => (
              <li key={i} className="flex items-center gap-3 text-slate-600 dark:text-slate-300 font-medium">
                <CheckCircle2 className="w-5 h-5 text-primary" /> {item}
              </li>
            ))}
          </ul>
        </motion.div>
        
        {/* 2. COMPARATIVA VISUAL (Adaptada Light/Dark) */}
        <div className="relative h-[500px] flex items-center justify-center perspective-1000">
          
          {/* --- CARD 1: EL PROBLEMA ("Web Aparador") --- */}
          <motion.div 
            initial={{ opacity: 0, rotate: -6, x: -35 }}
            whileInView={{ opacity: 1, rotate: -6, x: -35 }}
            viewport={{ once: true }}
            // LIGHT: bg-slate-100 (Gris clar) | DARK: bg-[#0f111a] (Negre)
            className="absolute left-0 w-[280px] p-6 rounded-2xl border border-slate-200 dark:border-white/5 bg-slate-100/80 dark:bg-[#0f111a]/80 backdrop-blur-sm z-0 grayscale opacity-70"
          >
             <div className="flex items-center gap-2 mb-4 text-slate-500">
                <Store className="w-5 h-5" />
                <span className="font-bold text-sm">Web "Aparador"</span>
             </div>
             <div className="space-y-3">
                {/* ITEM: Fons blanc en Light, fons transparent en Dark */}
                <div className="flex items-center justify-between p-3 rounded bg-white dark:bg-white/5 border border-slate-200 dark:border-white/5 shadow-sm dark:shadow-none">
                   <span className="text-xs text-slate-500">Reserves Online</span>
                   <X className="w-4 h-4 text-red-500" />
                </div>
                <div className="flex items-center justify-between p-3 rounded bg-white dark:bg-white/5 border border-slate-200 dark:border-white/5 shadow-sm dark:shadow-none">
                   <span className="text-xs text-slate-500">Panell de Vendes</span>
                   <X className="w-4 h-4 text-red-500" />
                </div>
                <div className="flex items-center justify-between p-3 rounded bg-white dark:bg-white/5 border border-slate-200 dark:border-white/5 shadow-sm dark:shadow-none">
                   <span className="text-xs text-slate-500">App MÃ²bil</span>
                   <X className="w-4 h-4 text-red-500" />
                </div>
             </div>
          </motion.div>

                {/* --- CARD 2: LA SOLUCIÃ“ (Ecosistema DigitAI) --- */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9, x: 20 }}
            whileInView={{ opacity: 1, scale: 1, x: 20 }}
            viewport={{ once: true }}
            transition={{ delay: 0.2 }}
            className="relative z-20 w-[340px] bg-[#1a1d2d] border border-white/10 rounded-2xl shadow-2xl overflow-hidden"
          >
            {/* CapÃ§alera Gradient */}
            <div className="h-2 w-full bg-linear-to-r from-[#06b6d4] via-[#3b82f6] to-[#a855f7]"></div>

            <div className="p-6">
              <h3 className="text-lg font-bold text-white mb-1">Ecosistema DigitAI</h3>
              <p className="text-xs text-slate-400 mb-6">Tot connectat, tot automÃ tic.</p>

              <div className="space-y-4">

                {/* Widget 1: Reserves / Calendari */}
                <div className="flex items-center gap-4 p-3 rounded-xl bg-primary/10 border border-primary/20">
                  <div className="p-2 bg-primary/20 rounded-lg text-primary">
                    <Calendar className="w-5 h-5" />
                  </div>
                  <div>
                    <div className="text-sm font-bold text-white">Agenda Plena</div>
                    <div className="text-xs text-slate-400">Reserves 24/7 automÃ tiques</div>
                  </div>
                </div>

                {/* Widget 2: MÃ¨triques */}
                <div className="flex items-center gap-4 p-3 rounded-xl bg-blue-500/10 border border-blue-500/20">
                  <div className="p-2 bg-blue-500/20 rounded-lg text-blue-400">
                    <BarChart3 className="w-5 h-5" />
                  </div>
                  <div>
                    <div className="text-sm font-bold text-white">+150% ConversiÃ³</div>
                    <div className="text-xs text-slate-400">AnalÃ­tica en temps real</div>
                  </div>
                </div>

                {/* Widget 3: PWA / MÃ²bil */}
                <div className="flex items-center gap-4 p-3 rounded-xl bg-cyan-500/10 border border-cyan-500/20">
                  <div className="p-2 bg-cyan-500/20 rounded-lg text-cyan-400">
                    <Smartphone className="w-5 h-5" />
                  </div>
                  <div>
                    <div className="text-sm font-bold text-white">App InstalÂ·lable</div>
                    <div className="text-xs text-slate-400">AccÃ©s directe al mÃ²bil (PWA)</div>
                  </div>
                </div>

              </div>
            </div>

            {/* Glow de fons */}
            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-linear-to-b from-primary/5 to-transparent pointer-events-none" />
          </motion.div>
        </div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/ProductTeaser.tsx ===================

'use client';

import { ArrowRight, ExternalLink } from 'lucide-react';
import Link from 'next/link';
import Image from 'next/image';
import { motion } from 'framer-motion';

// âœ… IMPORTACIÃ“ ESTÃ€TICA (Build-time check)
// Assegura't que les rutes coincideixen exactament amb el nom del fitxer
import ribotFlowImg from '@/assets/images/ribotflow.png'; 
import salutFlowImg from '@/assets/images/salutflow.png';

export function ProductTeaser() {
  return (
    <section className="py-24 container mx-auto px-4">
      
      <div className="rounded-3xl bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-primary/10 dark:via-background dark:to-background border border-slate-200 dark:border-primary/20 p-8 md:p-12 overflow-hidden relative transition-colors duration-300 shadow-2xl shadow-slate-200/50 dark:shadow-none">
        
        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-400/20 dark:bg-primary/20 blur-[100px] rounded-full opacity-40 pointer-events-none"></div>

        <div className="grid lg:grid-cols-2 gap-16 items-center relative z-10">
           
           {/* TEXT CONTENT */}
           <div>
              <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-100 dark:bg-primary/10 border border-blue-200 dark:border-primary/20 text-blue-700 dark:text-primary text-xs font-bold mb-6">
                 ğŸš€ INNOVATION LAB
              </div>
              
              <h2 className="text-3xl md:text-5xl font-bold text-foreground mb-6 leading-tight">
                 No nomÃ©s venem software. <br/>
                 <span className="gradient-text">Creem Productes.</span>
              </h2>
              
              <p className="text-slate-600 dark:text-slate-400 text-lg mb-8 leading-relaxed">
                 Descobreix <strong>SalutFlow</strong> i <strong>RibotFlow</strong>, les nostres plataformes SaaS prÃ²pies.
                 <br/><br/>
                 Utilitzem la mateixa tecnologia punta per als teus projectes.
              </p>
              
              <Link href="/projectes" className="inline-flex items-center font-bold text-foreground hover:text-primary transition-colors group">
                 Explorar Productes 
                 <ArrowRight className="ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform" />
              </Link>
           </div>
           
           {/* MOCKUP VISUAL */}
           <div className="relative h-[400px] w-full flex items-center justify-center perspective-1000">
              
              {/* CARD 1: RIBOTFLOW */}
              <motion.div 
                initial={{ opacity: 0, x: -20, rotate: -5 }}
                whileInView={{ opacity: 1, x: 0, rotate: -6 }}
                viewport={{ once: true }}
                className="absolute left-4 top-10 w-3/4 h-64 bg-white dark:bg-[#0f111a] rounded-xl border border-slate-200 dark:border-white/10 shadow-xl z-10 overflow-hidden"
              >
                 <div className="h-12 border-b border-slate-100 dark:border-white/5 flex items-center justify-between px-4 bg-slate-50/50 dark:bg-white/5">
                    <div className="relative h-6 w-24"> 
                        {/* âœ… ÃšS DE LA IMPORTACIÃ“ ESTÃ€TICA */}
                        <Image 
                           src={ribotFlowImg} 
                           alt="RibotFlow Logo" 
                           fill 
                           className="object-contain object-left" 
                           placeholder="blur" // Extra: Afegeix efecte de cÃ rrega borrÃ³s automÃ tic
                        /> 
                    </div>
                    <div className="flex gap-1.5">
                       <div className="w-2 h-2 rounded-full bg-slate-300 dark:bg-white/20"></div>
                       <div className="w-2 h-2 rounded-full bg-slate-300 dark:bg-white/20"></div>
                    </div>
                 </div>
                 {/* Body Skeleton */}
                 <div className="p-4 space-y-3 opacity-50 grayscale hover:grayscale-0 transition-all duration-500">
                    <div className="flex gap-4">
                       <div className="w-1/3 h-20 rounded-lg bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10"></div>
                       <div className="w-2/3 h-20 rounded-lg bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10"></div>
                    </div>
                    <div className="h-16 w-full rounded-lg bg-slate-50 dark:bg-white/5"></div>
                 </div>
              </motion.div>

              {/* CARD 2: SALUTFLOW */}
              <motion.div 
                initial={{ opacity: 0, x: 20, rotate: 5, y: 20 }}
                whileInView={{ opacity: 1, x: 20, rotate: 3, y: 40 }}
                viewport={{ once: true }}
                transition={{ delay: 0.2 }}
                className="absolute right-4 top-24 w-3/4 h-64 bg-white dark:bg-[#0f111a] rounded-xl border border-slate-200 dark:border-white/10 shadow-2xl z-20 overflow-hidden backdrop-blur-sm"
              >
                 <div className="h-12 border-b border-slate-100 dark:border-white/5 flex items-center justify-between px-4 bg-slate-50/50 dark:bg-white/5">
                    <div className="relative h-8 w-28"> 
                        {/* âœ… ÃšS DE LA IMPORTACIÃ“ ESTÃ€TICA */}
                        <Image 
                           src={salutFlowImg} 
                           alt="SalutFlow Logo" 
                           fill 
                           className="object-contain object-left"
                           placeholder="blur"
                        /> 
                    </div>
                    <ExternalLink className="w-4 h-4 text-slate-400" />
                 </div>
                 {/* Body Skeleton */}
                 <div className="p-4 space-y-3">
                    <div className="flex justify-between items-center mb-2">
                       <div className="h-4 w-1/3 bg-blue-100 dark:bg-primary/20 rounded"></div>
                       <div className="h-8 w-8 rounded-full bg-slate-100 dark:bg-white/10"></div>
                    </div>
                    <div className="space-y-2">
                       <div className="h-10 w-full rounded border-l-4 border-blue-500 bg-slate-50 dark:bg-white/5 flex items-center px-3">
                          <div className="h-2 w-1/2 bg-slate-200 dark:bg-white/20 rounded"></div>
                       </div>
                       <div className="h-10 w-full rounded border-l-4 border-green-500 bg-slate-50 dark:bg-white/5 flex items-center px-3">
                          <div className="h-2 w-2/3 bg-slate-200 dark:bg-white/20 rounded"></div>
                       </div>
                       <div className="h-10 w-full rounded border-l-4 border-purple-500 bg-slate-50 dark:bg-white/5 flex items-center px-3">
                          <div className="h-2 w-1/3 bg-slate-200 dark:bg-white/20 rounded"></div>
                       </div>
                    </div>
                 </div>
              </motion.div>

           </div>
        </div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/ServicesGrid.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { Smartphone, Globe, BrainCircuit, Users, ArrowUpRight, Code, BarChart } from 'lucide-react';

export function ServicesGrid() {
  return (
    <section id="serveis" className="py-20 bg-background relative overflow-hidden transition-colors duration-300">
      
      <div className="container mx-auto px-4">
        
        {/* CAPÃ‡ALERA (MÃ©s compacta) */}
        <div className="text-center mb-12 max-w-3xl mx-auto">
           <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/20 bg-primary/5 text-primary text-xs font-bold mb-4">
              SOLUCIONS 360Â°
           </div>
           <h2 className="text-3xl lg:text-5xl font-bold mb-4 text-foreground leading-tight">
             Tot per <span className="gradient-text">Dominar el Digital</span>
           </h2>
           <p className="text-lg text-muted-foreground">
             Desenvolupament, Producte i AutomatitzaciÃ³.
           </p>
        </div>

        {/* BENTO GRID (MÃ©s compacte: minmax 240px) */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 auto-rows-[minmax(240px,auto)]">
           
           {/* CARD 1: APPWEBS (DASHBOARD REALISTA) */}
           <motion.div 
              initial={{ opacity: 0, y: 10 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              className="md:col-span-2 group relative overflow-hidden rounded-2xl border border-border bg-card hover:border-primary/30 transition-all duration-500 flex flex-col md:flex-row"
           >
              <div className="p-6 flex-1 z-10">
                 <div className="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-500/10 flex items-center justify-center mb-4 border border-blue-200 dark:border-blue-500/20">
                    <Globe className="w-5 h-5 text-blue-600 dark:text-blue-400" />
                 </div>
                 <h3 className="text-xl font-bold text-foreground mb-2">AppWebs & SAAS</h3>
                 <p className="text-sx text-slate-600 dark:text-slate-400 leading-relaxed">
                    Portals de clients i CRMs a mida. El nucli operatiu del teu negoci.
                 </p>
              </div>

              {/* UI REALISTA WEB (Sidebar + GrÃ fica) */}
              <div className="relative w-full md:w-1/2 h-48 md:h-auto mt-4 md:mt-0 md:mr-6 self-end overflow-hidden">
                 <div className="w-full h-full bg-slate-50 dark:bg-[#0f111a] rounded-t-lg md:rounded-t-xl border-t border-l border-r border-slate-200 dark:border-white/10 shadow-xl translate-y-2 group-hover:translate-y-0 transition-transform duration-500 flex text-[30px]">
                    {/* Sidebar Fals */}
                    <div className="w-16 border-r border-slate-200 dark:border-white/5 p-3 flex flex-col gap-3 items-center bg-white dark:bg-black/20">
                       <div className="w-6 h-6 rounded bg-primary/20 mb-2"></div>
                       <div className="w-4 h-4 rounded-sm bg-slate-200 dark:bg-white/10"></div>
                       <div className="w-4 h-4 rounded-sm bg-slate-200 dark:bg-white/10"></div>
                       <div className="w-4 h-4 rounded-sm bg-slate-200 dark:bg-white/10"></div>
                    </div>
                    {/* Contingut Principal */}
                    <div className="flex-1 p-3">
                       <div className="flex justify-between items-center mb-3">
                          <span className="font-bold text-foreground">Dashboard</span>
                          <div className="w-16 h-4 rounded bg-slate-200 dark:bg-white/10"></div>
                       </div>
                       {/* GrÃ fica SVG */}
                       <div className="h-16 w-full bg-white dark:bg-white/5 rounded border border-slate-100 dark:border-white/5 mb-2 relative overflow-hidden">
                          <svg viewBox="0 0 100 40" className="w-full h-full absolute bottom-0" preserveAspectRatio="none">
                             <path d="M0 30 Q 20 10, 40 25 T 100 10" fill="none" stroke="#a855f7" strokeWidth="2" />
                             <path d="M0 30 Q 20 10, 40 25 T 100 10 V 40 H 0 Z" fill="url(#gradientGraph)" opacity="0.3" />
                             <defs>
                                <linearGradient id="gradientGraph" x1="0" y1="0" x2="0" y2="1">
                                   <stop offset="0%" stopColor="#a855f7" />
                                   <stop offset="100%" stopColor="transparent" />
                                </linearGradient>
                             </defs>
                          </svg>
                       </div>
                       <div className="space-y-1">
                          <div className="h-2 w-full bg-slate-200 dark:bg-white/10 rounded"></div>
                          <div className="h-2 w-3/4 bg-slate-200 dark:bg-white/10 rounded"></div>
                       </div>
                    </div>
                 </div>
              </div>
           </motion.div>

           {/* CARD 2: APPS (UI REALISTA MÃ’BIL) */}
           <motion.div 
              initial={{ opacity: 0, y: 10 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.1 }}
              className="md:col-span-1 group relative overflow-hidden rounded-2xl border border-border bg-card hover:border-cyan-500/30 transition-all duration-500"
           >
              <div className="p-6 h-full flex flex-col">
                 <div className="w-10 h-10 rounded-lg bg-cyan-100 dark:bg-cyan-500/10 flex items-center justify-center mb-4 border border-cyan-200 dark:border-cyan-500/20">
                    <Smartphone className="w-5 h-5 text-cyan-600 dark:text-cyan-400" />
                 </div>
                 <h3 className="text-lg font-bold text-foreground mb-1">Apps Natives</h3>
                 <p className="text-sx text-slate-600 dark:text-slate-400 mb-6">
                    iOS i Android amb React Native.
                 </p>
                 
                 {/* UI MÃ²bil Realista (Chat/Llista) */}
                 <div className="grow relative flex justify-center">
                    <div className="w-32 bg-white dark:bg-black border-x-4 border-t-4 border-slate-300 dark:border-slate-800 rounded-t-2xl relative top-2 group-hover:top-0 transition-all duration-500 overflow-hidden shadow-lg">
                       {/* CapÃ§alera App */}
                       <div className="h-8 bg-cyan-500/10 border-b border-slate-100 dark:border-white/5 flex items-center justify-between px-2">
                          <div className="w-3 h-3 rounded-full bg-slate-200 dark:bg-white/20"></div>
                          <div className="w-8 h-1 rounded-full bg-slate-200 dark:bg-white/20"></div>
                       </div>
                       {/* Llista de Xat */}
                       <div className="p-2 space-y-2">
                          <div className="flex gap-2 items-center">
                             <div className="w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-500/20 shrink-0"></div>
                             <div className="h-2 w-16 bg-slate-100 dark:bg-white/10 rounded"></div>
                          </div>
                          <div className="flex gap-2 items-center flex-row-reverse">
                             <div className="w-6 h-6 rounded-full bg-green-100 dark:bg-green-500/20 shrink-0"></div>
                             <div className="h-6 w-14 bg-green-50 dark:bg-green-500/10 rounded-lg border border-green-100 dark:border-green-500/20"></div>
                          </div>
                          <div className="flex gap-2 items-center">
                             <div className="w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-500/20 shrink-0"></div>
                             <div className="h-8 w-full bg-slate-50 dark:bg-white/5 rounded border border-slate-100 dark:border-white/5"></div>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
           </motion.div>

           {/* CARD 3: AUTOMATITZACIÃ“ (Nodes) */}
           <motion.div 
              initial={{ opacity: 0, y: 10 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.2 }}
              className="md:col-span-1 group relative overflow-hidden rounded-2xl border border-border bg-card hover:border-purple-500/30 transition-all duration-500"
           >
              <div className="p-6 h-full flex flex-col">
                 <div className="w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-500/10 flex items-center justify-center mb-4 border border-purple-200 dark:border-purple-500/20">
                    <BrainCircuit className="w-5 h-5 text-purple-600 dark:text-purple-400" />
                 </div>
                 <h3 className="text-lg font-bold text-foreground mb-1">AutomatitzaciÃ³</h3>
                 <p className="text-sx text-slate-600 dark:text-slate-400 mb-6">
                    Connectem CRM, Email i IA.
                 </p>

                 {/* UI Nodes (Visualment net) */}
                 <div className="grow relative bg-slate-50 dark:bg-white/5 rounded-lg border border-slate-200 dark:border-white/5 p-2 group-hover:bg-slate-100 dark:group-hover:bg-white/[0.07] transition-colors">
                    <div className="relative w-full h-full flex items-center justify-center">
                       <div className="absolute top-2 left-2 w-8 h-8 rounded bg-white dark:bg-black border border-purple-200 dark:border-purple-500/30 shadow-sm flex items-center justify-center z-10">
                          <Users className="w-4 h-4 text-purple-500" />
                       </div>
                       <div className="absolute bottom-2 right-2 w-8 h-8 rounded bg-white dark:bg-black border border-green-200 dark:border-green-500/30 shadow-sm flex items-center justify-center z-10">
                          <Code className="w-4 h-4 text-green-500" />
                       </div>
                       {/* Connector SVG */}
                       <svg className="absolute inset-0 w-full h-full">
                          <path d="M30 25 C 60 25, 60 75, 90 75" stroke="currentColor" className="text-slate-300 dark:text-white/20" strokeWidth="2" fill="none" strokeDasharray="4 4" />
                       </svg>
                    </div>
                 </div>
              </div>
           </motion.div>

           {/* CARD 4: FORMACIÃ“ (Gran) */}
           <motion.div 
              initial={{ opacity: 0, y: 10 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: 0.3 }}
              className="md:col-span-2 group relative overflow-hidden rounded-2xl border border-border bg-card hover:border-green-500/30 transition-all duration-500 flex flex-col md:flex-row"
           >
              <div className="p-6 flex-1 z-10">
                 <div className="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-500/10 flex items-center justify-center mb-4 border border-green-200 dark:border-green-500/20">
                    <Users className="w-5 h-5 text-green-600 dark:text-green-400" />
                 </div>
                 <h3 className="text-xl font-bold text-foreground mb-2">FormaciÃ³ & Consultoria</h3>
                 <p className="text-sx text-slate-600 dark:text-slate-400 mb-4 leading-relaxed">
                    FormaciÃ³ in-company per al teu equip sobre IA, n8n i eines No-Code.
                 </p>
                 <button className="text-xs font-bold text-green-600 dark:text-green-400 flex items-center gap-1 hover:gap-2 transition-all">
                    Veure temari <ArrowUpRight className="w-3 h-3" />
                 </button>
              </div>

              {/* UI Terminal */}
              <div className="relative w-full md:w-1/2 h-40 md:h-auto p-6 self-center">
                 <div className="w-full h-full bg-slate-100 dark:bg-[#1e1e1e] rounded-lg border border-slate-200 dark:border-slate-800 p-4 font-mono text-[15px] shadow-xl text-slate-600 dark:text-slate-300 leading-relaxed opacity-90 group-hover:opacity-100 transition-opacity">
                    <div className="flex gap-1.5 mb-3 opacity-50">
                       <div className="w-2 h-2 rounded-full bg-red-500"></div>
                       <div className="w-2 h-2 rounded-full bg-yellow-500"></div>
                       <div className="w-2 h-2 rounded-full bg-green-500"></div>
                    </div>
                    <div>
                       <p><span className="text-purple-600 dark:text-purple-400">import</span> {'{ AI }'} <span className="text-purple-600 dark:text-purple-400">from</span> <span className="text-green-600 dark:text-green-400">'digitai'</span>;</p>
                       <p className="mt-2"><span className="text-blue-600 dark:text-blue-400">const</span> equip = <span className="text-yellow-600 dark:text-yellow-400">await</span> AI.train();</p>
                       <p className="mt-2"><span className="text-slate-400 dark:text-slate-500">Resultat: +Productivitat</span></p>
                       <motion.div 
                          animate={{ opacity: [0, 1, 0] }}
                          transition={{ duration: 0.8, repeat: Infinity }}
                          className="h-3 w-1.5 bg-green-500 mt-1 inline-block"
                       />
                    </div>
                 </div>
              </div>
           </motion.div>

        </div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/SocialSection.tsx ===================

'use client';

import { Facebook, Linkedin, Instagram } from 'lucide-react';
import { motion } from 'framer-motion';

const SOCIALS = [
  {
    name: 'LinkedIn',
    icon: Linkedin,
    href: 'https://www.linkedin.com/in/digitai-studios-105a0136a/',
    color: 'hover:text-[#0077b5]', // Color oficial LinkedIn
  },
  {
    name: 'Instagram',
    icon: Instagram,
    href: 'https://www.instagram.com/digitaistudios/',
    color: 'hover:text-[#E1306C]', // Color oficial Instagram
  },
  {
    name: 'Facebook',
    icon: Facebook,
    href: 'https://www.facebook.com/profile.php?id=61576974390567',
    color: 'hover:text-[#1877F2]', // Color oficial Facebook
  },
];

export function SocialSection() {
  return (
    <section className="py-12 bg-muted/30 border-y border-border/40">
      <div className="container mx-auto px-4 text-center">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
        >
          <p className="text-sm font-semibold uppercase tracking-widest text-muted-foreground mb-6">
            Segueix la revoluciÃ³
          </p>
          
          <div className="flex justify-center items-center gap-8 md:gap-12">
            {SOCIALS.map((social) => (
              <a
                key={social.name}
                href={social.href}
                target="_blank"
                rel="noopener noreferrer"
                aria-label={`Segueix-nos a ${social.name}`}
                className={`transform transition-all duration-300 hover:scale-110 text-muted-foreground ${social.color}`}
              >
                <social.icon className="w-8 h-8 md:w-10 md:h-10" />
              </a>
            ))}
          </div>
        </motion.div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/TechStackSection.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { useRef, useState, useEffect } from 'react';

const TECHNOLOGIES = [
  {
    name: "Next.js",
    // Adaptable: Negre en Light, Blanc en Dark
    icon: (
      <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="180" height="180">
          <circle cx="90" cy="90" r="90" className="fill-black dark:fill-white" />
        </mask>
        <g mask="url(#mask0)">
          <circle cx="90" cy="90" r="87" className="stroke-black dark:stroke-white" strokeWidth="6" />
          <path d="M149.508 157.52L69.142 54H54V125.97H66.1136V69.3836L139.999 164.845C143.333 162.614 146.509 160.165 149.508 157.52Z" className="fill-black dark:fill-white" />
          <rect x="115" y="54" width="12" height="72" className="fill-black dark:fill-white" />
        </g>
      </svg>
    )
  },
  {
    name: "Supabase",
    // Verd oficial #3ECF8E
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M11.5286 0.179546C11.8331 -0.0812412 12.2919 -0.0533377 12.5643 0.24243L23.6622 12.2932C23.9326 12.5868 23.8877 13.048 23.5614 13.2813L13.3359 20.5925L15.9762 23.1152C16.2584 23.3849 16.0599 23.8673 15.6692 23.8673H11.5286C11.2241 24.1281 10.7653 24.1002 10.4929 23.8044L-0.605008 11.7537C-0.875401 11.46 -0.830532 10.9989 -0.504224 10.7655L9.72131 3.45435L7.08095 0.931661C6.79877 0.661952 6.99727 0.179546 7.38795 0.179546H11.5286Z" fill="#3ECF8E" />
      </svg>
    )
  },
  {
    name: "n8n",
    // Rosa oficial #EA4B71
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M12.9 8.25h2.2v2.2h-2.2v-2.2zm-2.2 0h-2.2v2.2h2.2v-2.2zm-4.4 0H4.1v2.2h2.2v-2.2zm0 4.4H4.1v2.2h2.2v-2.2zm4.4 0h-2.2v2.2h2.2v-2.2zm2.2 0h2.2v2.2h-2.2v-2.2z" fill="#EA4B71" />
        <path fillRule="evenodd" clipRule="evenodd" d="M14 0H2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zM2 2h12v12H2V2z" fill="#EA4B71" transform="translate(4 4)" />
      </svg>
    )
  },
  {
    name: "Airtable",
    // Colors oficials: Groc, Blau, Vermell
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M3 10v8l7 -3v-2.6z" fill="#F8D800" />
        <path d="M3 6l9 3l9 -3l-9 -3z" fill="#2D7FF9" />
        <path d="M14 12.3v8.7l7 -3v-8z" fill="#F82B60" />
      </svg>
    )
  },
  {
    name: "React Native",
    // Blau oficial #61DAFB
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M12 22.5C17.799 22.5 22.5 17.799 22.5 12C22.5 6.20101 17.799 1.5 12 1.5C6.20101 1.5 1.5 6.20101 1.5 12C1.5 17.799 6.20101 22.5 12 22.5Z" fill="none" />
        <circle cx="12" cy="12" r="2" fill="#61DAFB" />
        <g stroke="#61DAFB" strokeWidth="1.5" fill="none">
           <ellipse cx="12" cy="12" rx="10" ry="4" />
           <ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(60 12 12)" />
           <ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(120 12 12)" />
        </g>
      </svg>
    )
  },
  {
    name: "OpenAI",
    // Adaptable
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1 .6765 8.1643l-.142-.0805-4.7784-2.7581a.7616.7616 0 0 0-.3927-.6765v-6.7369l.0048-.0048z" className="fill-black dark:fill-white" />
      </svg>
    )
  },
  {
    name: "Gemini",
    // Gradient Blau/Lila
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <defs>
          <linearGradient id="gemini-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#4E75F6" />
            <stop offset="100%" stopColor="#E96C7C" />
          </linearGradient>
        </defs>
        <path d="M12 22C12 16.4772 16.4772 12 22 12C16.4772 12 12 7.52285 12 2C12 7.52285 7.52285 12 2 12C7.52285 12 12 16.4772 12 22Z" fill="url(#gemini-gradient)" />
      </svg>
    )
  },
  {
    name: "TypeScript",
    // Blau oficial #3178C6
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M2 0h20c1.1 0 2 0.9 2 2v20c0 1.1-0.9 2-2 2H2c-1.1 0-2-0.9-2-2V2c0-1.1 0.9-2 2-2zm13.5 17.9c1.3 0 2.2-0.7 2.6-1.7h-1.7c-0.2 0.4-0.5 0.6-0.9 0.6-0.7 0-1-0.6-1-1.7v-3.3h2.9v-1.4h-2.9v-2.1h-1.7v2.1h-1.4v1.4h1.4v3.6c0 1.6 0.9 2.5 2.7 2.5zm-6.7 0c1.5 0 2.6-0.8 2.8-2h-1.7c-0.2 0.5-0.6 0.8-1.1 0.8-0.8 0-1.2-0.6-1.2-1.6v-3.2h2.8v-1.4h-2.8v-2.1h-1.7v2.1h-1.6v1.4h1.6v3.5c0 1.7 1.1 2.5 2.9 2.5z" fill="#3178C6"/>
      </svg>
    )
  },
  {
    name: "GitHub",
    // Adaptable
    icon: (
      <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.65.72.26.98.19 1.12.08.14-.55.28-.94.55-1.15-2.2-.23-4.51-1.1-4.51-4.9 0-1.08.38-1.97 1.01-2.66-.1-.25-.44-1.26.1-2.62 0 0 .84-.27 2.75 1.02.8-.22 1.65-.33 2.5-.33.85 0 1.7.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.36.2 2.37.1 2.62.63.69 1.01 1.58 1.01 2.66 0 3.8-2.32 4.67-4.53 4.89.29.25.55.74.55 1.49 0 1.08-.01 1.95-.01 2.21 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" className="fill-black dark:fill-white"/>
      </svg>
    )
  },
  {
    name: "Vercel",
    // Adaptable
    icon: (
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
        <path d="M12 1L24 22H0L12 1Z" className="fill-black dark:fill-white"/>
      </svg>
    )
  },
];

export function TechStackSection() {
  const carouselRef = useRef<HTMLDivElement>(null);
  const [width, setWidth] = useState(0);

  useEffect(() => {
    if(carouselRef.current) {
      setWidth(carouselRef.current.scrollWidth - carouselRef.current.offsetWidth);
    }
  }, []);

  return (
    <section className="py-12 border-y border-slate-200 dark:border-white/5 bg-slate-50 dark:bg-white/1 overflow-hidden">
      <div className="container mx-auto px-4">
        <p className="text-center text-xs font-semibold text-slate-600 dark:text-slate-500 uppercase tracking-widest mb-10">
          Potenciat per l'stack tecnolÃ²gic del futur
        </p>
        
        <div className="flex justify-center">
          <motion.div 
            ref={carouselRef} 
            className="cursor-grab active:cursor-grabbing overflow-hidden max-w-full"
          >
            <motion.div 
              drag="x" 
              dragConstraints={{ right: 0, left: -width }}
              className="flex items-center gap-12 md:gap-20 w-max px-8 py-2"
            >
              {TECHNOLOGIES.map((tech, i) => (
                <motion.div
                  key={tech.name}
                  initial={{ opacity: 0, y: 10 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  transition={{ delay: i * 0.1 }}
                  className="group flex flex-col items-center gap-4 min-w-20"
                >
                  {/* Canviat opacity-60 a opacity-80 per millor visibilitat en mode light */}
                  <div className="w-20 h-20 transition-all duration-500 transform group-hover:scale-110 opacity-80 grayscale group-hover:opacity-100 group-hover:grayscale-0 drop-shadow-sm group-hover:drop-shadow-2xl">
                    {tech.icon}
                  </div>
                  
                  {/* Canviat text color per adaptar-se a light/dark */}
                  <span className="text-xs font-medium text-slate-600 dark:text-slate-500 group-hover:text-black dark:group-hover:text-white transition-colors opacity-0 group-hover:opacity-100">
                    {tech.name}
                  </span>
                </motion.div>
              ))}
            </motion.div>
          </motion.div>
        </div>
      </div>
    </section>
  );
}

// =================== FILE: src/components/landing/TestimonialsSection.tsx ===================

'use client';

import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Star, Quote, ChevronLeft, ChevronRight, Globe, Smartphone, Zap, Users, Code, ExternalLink } from 'lucide-react';
import Image, { StaticImageData } from 'next/image'; // ğŸ‘ˆ Importem el tipus
import Link from 'next/link';
import type { Testimonial } from '@/lib/data';

type Props = {
  testimonials: Testimonial[];
};

export function TestimonialsSection({ testimonials }: Props) {
  const [currentIndex, setCurrentIndex] = useState(0);
  const itemsToShow = 3; 

  const nextSlide = () => {
    setCurrentIndex((prev) => (prev + 1) % testimonials.length);
  };

  const prevSlide = () => {
    setCurrentIndex((prev) => (prev - 1 + testimonials.length) % testimonials.length);
  };

  const getVisibleItems = () => {
    const items = [];
    for (let i = 0; i < itemsToShow; i++) {
      items.push(testimonials[(currentIndex + i) % testimonials.length]);
    }
    return items;
  };

  return (
    <section id="testimonis" className="py-16 bg-muted/30 relative overflow-hidden">
      <div className="container mx-auto px-4 relative z-10">
        
        {/* CAPÃ‡ALERA */}
        <div className="flex flex-col md:flex-row justify-between items-end mb-16 gap-6">
           <div className="max-w-2xl">
              <h2 className="text-3xl lg:text-5xl font-bold text-foreground leading-tight">
                No ens creguis a nosaltres. <br/>
                Mira el que hem <span className="gradient-text">ConstruÃ¯t</span>.
              </h2>
           </div>

           {/* CONTROLS */}
           <div className="flex gap-3">
              <button onClick={prevSlide} className="p-3 rounded-full border border-border bg-card hover:bg-primary hover:text-white transition-all shadow-sm">
                 <ChevronLeft className="w-6 h-6" />
              </button>
              <button onClick={nextSlide} className="p-3 rounded-full border border-border bg-card hover:bg-primary hover:text-white transition-all shadow-sm">
                 <ChevronRight className="w-6 h-6" />
              </button>
           </div>
        </div>

        {/* GRID */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 py-6">
          <AnimatePresence mode='popLayout'>
            {getVisibleItems().map((item, i) => (
              <motion.div
                key={`${item.id}-${i}`} 
                initial={{ opacity: 0, x: 50 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: -50 }}
                transition={{ duration: 0.5, delay: i * 0.1 }}
                className="h-[450px] perspective-1000"
              >
                 <TestimonialCard item={item} />
              </motion.div>
            ))}
          </AnimatePresence>
        </div>

      </div>
    </section>
  );
}

// --- TARGETA INDIVIDUAL (EFECTE CARPETA/FITXER) ---

function TestimonialCard({ item }: { item: Testimonial }) {
   return (
      <div className="relative w-full h-full group">
         
         {/* CAPA 1: EL PROJECTE (FITXER) */}
         <div className="absolute inset-x-4 top-4 bottom-20  transition-all duration-500 cubic-bezier(0.25, 0.8, 0.25, 1) group-hover:-translate-y-20 ">
            <div className="w-full h-full rounded-t-xl overflow-hidden border border-primary/20 bg-slate-900 dark:bg-black shadow-2xl group-hover:shadow-primary/20">
               {item.projectType === 'web' && <MockupWeb url={item.projectUrl} image={item.image} title={item.company} />}
               {item.projectType === 'app' && <MockupApp image={item.image} title={item.company} />}
               {item.projectType === 'automation' && <MockupAutomation />}
            </div>
         </div>

         {/* CAPA 2: EL TESTIMONI (CARPETA) */}
         <div className="absolute bottom-0 left-0 right-0 h-[280px] bg-card border border-border rounded-2xl p-8 shadow-xl z-10 transition-transform duration-500 group-hover:translate-y-6 flex flex-col">
            
            <Quote className="absolute top-6 right-6 text-primary/10 w-12 h-12 rotate-180" />

            <div className="flex items-center gap-3 mb-4">
               <div className="w-12 h-12 rounded-full bg-gradient-to-br from-primary/20 to-blue-500/20 border border-primary/30 flex items-center justify-center text-lg font-bold text-primary">
                  {item.name.charAt(0)}
               </div>
               <div>
                  <div className="font-bold text-foreground">{item.name}</div>
                  <div className="text-xs text-muted-foreground">{item.company}</div>
               </div>
            </div>

            <div className="flex gap-1 mb-4">
               {[...Array(5)].map((_, i) => (
                  <Star key={i} className={`w-4 h-4 ${i < item.rating ? 'fill-yellow-400 text-yellow-400' : 'text-slate-300 dark:text-slate-700'}`} />
               ))}
            </div>

            <p className="text-base text-muted-foreground leading-relaxed overflow-hidden text-ellipsis">
               "{item.text}"
            </p>
            
            <div className="mt-auto pt-4 border-t border-border flex justify-between items-center opacity-50">
               <span className="text-[10px] uppercase tracking-widest font-bold">Projecte Realitzat</span>
               <div className="w-16 h-1 bg-foreground/10 rounded-full"></div>
            </div>
         </div>
      </div>
   )
}

// --- MOCKUPS VISUALS ---

// âœ… CORRECCIÃ“: Acceptem 'string | StaticImageData'
function MockupWeb({ url, image, title }: { url?: string, image?: string | StaticImageData, title: string }) {
   const Wrapper = url ? Link : 'div';
   return (
      
      <Wrapper href={url || '#'} target={url ? "_blank" : undefined} className="block w-full h-full cursor-pointer group/mockup">
         <div className="w-full h-full bg-slate-50 dark:bg-[#0f111a] flex flex-col relative">
            
            {url && (
               <div className="absolute inset-0 z-30 bg-black/60 backdrop-blur-[2px] flex items-center justify-center opacity-0 group-hover/mockup:opacity-100 transition-opacity duration-300">
                  <span className="bg-white text-black px-4 py-2 rounded-full font-bold text-xs flex items-center gap-2 shadow-lg transform scale-90 group-hover/mockup:scale-100 transition-transform">
                     Visitar Web <ExternalLink className="w-3 h-3" />
                  </span>
               </div>
            )}

            {/* Barra navegador */}
            <div className="h-6 bg-slate-200 dark:bg-white/10 flex items-center px-3 gap-1.5 z-10">
               <div className="w-2 h-2 rounded-full bg-red-400/80"></div>
               <div className="w-2 h-2 rounded-full bg-yellow-400/80"></div>
               <div className="w-2 h-2 rounded-full bg-green-400/80"></div>
            </div>
            
            <div className="flex-1 relative w-full">
                {image ? (
                   <Image src={image} alt={title} fill className="object-cover object-top" />
                ) : (
                   <div className="flex flex-col items-center justify-center h-full gap-2 bg-white dark:bg-black/50">
                      <Globe className="w-8 h-8 text-blue-500/20" />
                      <span className="text-xs text-muted-foreground font-bold">{title} Web</span>
                   </div>
                )}
            </div>
         </div>
      </Wrapper>
   )
}

// âœ… CORRECCIÃ“: Acceptem 'string | StaticImageData'
function MockupApp({ image, title }: { image?: string | StaticImageData, title: string }) {
   return (
      <div className="w-full h-full bg-slate-800 dark:bg-black flex items-end justify-center p-4 pb-0 group/mockup relative">
         
         <div className="absolute inset-0 z-30 bg-black/60 backdrop-blur-[2px] flex items-center justify-center opacity-0 group-hover/mockup:opacity-100 transition-opacity duration-300 rounded-t-xl">
             <span className="bg-white text-black px-4 py-2 rounded-full font-bold text-xs flex items-center gap-2 shadow-lg">
                Veure App <ExternalLink className="w-3 h-3" />
             </span>
         </div>

         <div className="w-32 h-full bg-black border-2 border-slate-700 rounded-t-xl overflow-hidden relative">
            {image ? (
                <Image src={image} alt={title} fill className="object-cover" />
            ) : (
                <div className="w-full h-full bg-slate-900 flex flex-col items-center justify-center">
                   <Smartphone className="w-6 h-6 text-primary" />
                   <span className="text-[10px] text-slate-400 mt-2">{title} App</span>
                </div>
            )}
         </div>
      </div>
   )
}

// L'ANIMACIÃ“ D'AUTOMATITZACIÃ“ (Sense imatges, no cal tocar tipus)
function MockupAutomation() {
   return (
      <div className="w-full h-full bg-[#1a1d2d] relative overflow-hidden group/mockup">
         <div className="absolute inset-0 z-30 bg-black/60 backdrop-blur-[2px] flex items-center justify-center opacity-0 group-hover/mockup:opacity-100 transition-opacity duration-300">
             <span className="bg-white text-black px-4 py-2 rounded-full font-bold text-xs flex items-center gap-2 shadow-lg">
                Veure Flux <Zap className="w-3 h-3" />
             </span>
         </div>

         <div className="absolute inset-0 bg-[radial-gradient(#ffffff10_1px,transparent_1px)] [background-size:12px_12px]"></div>
         
         <svg className="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 100 100" preserveAspectRatio="none">
            <defs>
               <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stopColor="#a855f7" stopOpacity="0.5" />
                  <stop offset="100%" stopColor="#22c55e" stopOpacity="0.5" />
               </linearGradient>
            </defs>
            <path 
               d="M 20 30 C 50 30, 50 70, 80 70" 
               stroke="url(#lineGradient)" 
               strokeWidth="1.5" 
               fill="none" 
               vectorEffect="non-scaling-stroke" 
            />
            <motion.circle 
               r="3" 
               fill="#a855f7"
               animate={{ offsetDistance: ["0%", "100%"] }}
               transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
               style={{ offsetPath: "path('M 20 30 C 50 30, 50 70, 80 70')" }}
            />
         </svg>

         <div className="absolute left-[20%] top-[30%] -translate-x-1/2 -translate-y-1/2 w-10 h-10 rounded-lg bg-purple-500/20 border border-purple-500 flex items-center justify-center z-10 shadow-[0_0_15px_rgba(168,85,247,0.4)] backdrop-blur-sm">
            <Users className="w-5 h-5 text-purple-400" />
         </div>
         
         <div className="absolute left-[80%] top-[50%] -translate-x-1/2 -translate-y-1/2 w-10 h-10 rounded-lg bg-green-500/20 border border-green-500 flex items-center justify-center z-10 shadow-[0_0_15px_rgba(34,197,94,0.4)] backdrop-blur-sm">
            <Code className="w-5 h-5 text-green-400" />
         </div>
      </div>
   )
}

// =================== FILE: src/components/layout/Footer.tsx ===================

'use client';

import Link from 'next/link';
import { Facebook, Instagram, Linkedin, Mail, MapPin} from 'lucide-react';

const SOCIALS = [
  { icon: Linkedin, href: "https://www.linkedin.com/in/digitai-studios-105a0136a/" , label: 'LinkedIn' },
  { icon: Instagram, href: "https://www.instagram.com/digitaistudios/", label: 'Instagram' },
  { icon: Facebook, href: "https://www.facebook.com/profile.php?id=61576974390567" , label: 'Facebook' },
  // Pots afegir Twitter/X si vols
];

const FOOTER_LINKS = [
  {
    title: 'Serveis',
    links: [
      { label: 'AppWebs & SaaS', href: '#serveis' },
      { label: 'Apps MÃ²bils', href: '#serveis' },
      { label: 'AutomatitzaciÃ³ IA', href: '#serveis' },
      { label: 'FormaciÃ³ In-Company', href: '#serveis' },
    ],
  },
  {
    title: 'Empresa',
    links: [
      { label: 'Sobre Nosaltres', href: '#hero' },
      { label: 'Projectes', href: '/projectes' },
      { label: 'Blog', href: '/blog' },
      { label: 'Contacte', href: '#contacte' },
    ],
  },
  {
    title: 'Legal',
    links: [
      { label: 'AvÃ­s Legal', href: '/legal/avis-legal' },
      { label: 'PolÃ­tica de Privacitat', href: '/legal/privacitat' },
      { label: 'PolÃ­tica de Cookies', href: '/legal/cookies' },
    ],
  },
];

export function Footer() {
  const currentYear = new Date().getFullYear();

  return (
    <footer className="bg-background border-t border-border pt-16 pb-8 transition-colors duration-300">
      <div className="container mx-auto px-4">
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-12 mb-16">
          
          {/* COLUMNA 1: MARCA & INFO (Ocupa 2 columnes en grans pantalles) */}
          <div className="lg:col-span-2 space-y-6">
            <Link href="/" className="inline-block">
              <span className="text-2xl font-bold tracking-tight text-foreground">
                DigitAI <span className="gradient-text">Studios</span>
              </span>
            </Link>
            <p className="text-muted-foreground leading-relaxed max-w-sm">
              Transformem negocis tradicionals en lÃ­ders digitals mitjanÃ§ant desenvolupament a mida i intelÂ·ligÃ¨ncia artificial.
            </p>
            
            <div className="flex gap-4">
              {SOCIALS.map((social, i) => (
                <a 
                  key={i}
                  href={social.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label={social.label}
                  className="w-10 h-10 rounded-full bg-muted/50 flex items-center justify-center text-muted-foreground hover:bg-primary/10 hover:text-primary transition-all border border-transparent hover:border-primary/20"
                >
                  <social.icon className="w-5 h-5" />
                </a>
              ))}
            </div>

            <div className="space-y-2 pt-4">
                <div className="flex items-center gap-3 text-sm text-muted-foreground">
                    <Mail className="w-4 h-4 text-primary" />
                    <a href="mailto:info@digitaistudios.com" className="hover:text-foreground transition-colors">
                        info@digitaistudios.com
                    </a>
                </div>
                <div className="flex items-center gap-3 text-sm text-muted-foreground">
                    <MapPin className="w-4 h-4 text-primary" />
                    <span>Girona, Catalunya</span>
                </div>
            </div>
          </div>

          {/* COLUMNS DINÃ€MIQUES DE LINKS */}
          {FOOTER_LINKS.map((section) => (
            <div key={section.title} className="space-y-6">
              <h4 className="font-bold text-foreground">{section.title}</h4>
              <ul className="space-y-3">
                {section.links.map((link) => (
                  <li key={link.label}>
                    <Link 
                      href={link.href} 
                      className="text-sm text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 group"
                    >
                      <span className="w-1.5 h-1.5 rounded-full bg-primary/0 group-hover:bg-primary transition-all duration-300"></span>
                      {link.label}
                    </Link>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>

        {/* COPYRIGHT */}
        <div className="border-t border-border pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-muted-foreground">
          <p>Â© {currentYear} DigitAI Studios. Tots els drets reservats.</p>
          <div className="flex items-center gap-6">
             <span>Fet amb â¤ï¸ a Catalunya</span>
          </div>
        </div>

      </div>
    </footer>
  );
}

// =================== FILE: src/components/layout/LegalLayout.tsx ===================

'use client';

import { Navbar } from "@/components/layout/Navbar";
import { Footer } from "@/components/layout/Footer";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { cn } from "@/lib/utils";
import { Scale, Shield, Cookie, FileText } from "lucide-react";
// Si tens un hook d'autenticaciÃ³ o context, pots obtenir l'usuari aquÃ­. 
// Si no, pots passar user={null} a la Navbar com a placeholder.
import { createClient } from '@/lib/supabase/client';
import { useEffect, useState } from "react";
import type { User } from '@supabase/supabase-js';

const LEGAL_NAV = [
  { name: 'AvÃ­s Legal', href: '/legal/avis-legal', icon: Scale },
  { name: 'PolÃ­tica de Privacitat', href: '/legal/privacitat', icon: Shield },
  { name: 'PolÃ­tica de Cookies', href: '/legal/cookies', icon: Cookie },
];

export default function LegalLayout({ children }: { children: React.ReactNode }) {
  const pathname = usePathname();
  const [user, setUser] = useState<User | null>(null);
  
  // Opcional: Recuperar usuari per pintar bÃ© la Navbar (si vols que surti l'avatar)
  useEffect(() => {
    const supabase = createClient();
    supabase.auth.getUser().then(({ data }) => setUser(data.user));
  }, []);

  // ğŸ§¹ LÃ’GICA CLAU: Netegem l'idioma de la ruta (ex: /ca/legal -> /legal)
  // AixÃ² assegura que la comparaciÃ³ funcioni en qualsevol idioma
  const cleanPath = pathname.replace(/^\/[a-z]{2}\//, '/').replace(/^\/[a-z]{2}$/, '');

  return (
    <div className="min-h-screen flex flex-col bg-background text-foreground">
      {/* Passem l'usuari a la Navbar perquÃ¨ es vegi consistent */}
      <Navbar user={user} />
      
      <main className="flex-1 container mx-auto px-4 py-32">
        <div className="grid lg:grid-cols-4 gap-10">
          
          {/* SIDEBAR NAVEGACIÃ“ (Sticky) */}
          <aside className="lg:col-span-1 hidden lg:block">
             <div className="sticky top-32 space-y-4">
                <div className="px-4">
                    <h3 className="font-bold text-lg flex items-center gap-2 text-foreground">
                        <FileText className="w-5 h-5 text-primary" /> 
                        Centre Legal
                    </h3>
                    <p className="text-xs text-muted-foreground mt-1">
                        DocumentaciÃ³ oficial i normatives.
                    </p>
                </div>

                <nav className="flex flex-col space-y-1">
                   {LEGAL_NAV.map((item) => {
                      // Comprovem si la ruta neta coincideix o si comenÃ§a per ella
                      const isActive = cleanPath === item.href || pathname.endsWith(item.href);

                      return (
                        <Link 
                           key={item.href} 
                           href={item.href}
                           className={cn(
                             "flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200",
                             isActive 
                               ? "bg-primary/10 text-primary border border-primary/20 shadow-sm font-bold" 
                               : "text-muted-foreground hover:bg-muted hover:text-foreground border border-transparent"
                           )}
                        >
                           <item.icon className={cn("w-4 h-4", isActive && "text-primary")} />
                           {item.name}
                        </Link>
                      )
                   })}
                </nav>
             </div>
          </aside>

          {/* MENU MÃ’BIL (Horitzontal, nomÃ©s visible en pantalles petites) */}
          <div className="lg:hidden col-span-1 mb-6 overflow-x-auto pb-2 scrollbar-hide">
             <div className="flex gap-2 w-max">
                {LEGAL_NAV.map((item) => {
                    const isActive = cleanPath === item.href || pathname.endsWith(item.href);
                    return (
                        <Link 
                           key={item.href} 
                           href={item.href}
                           className={cn(
                             "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border transition-colors whitespace-nowrap",
                             isActive 
                               ? "bg-primary text-primary-foreground border-primary" 
                               : "bg-background border-border text-muted-foreground"
                           )}
                        >
                           <item.icon className="w-4 h-4" />
                           {item.name}
                        </Link>
                    )
                })}
             </div>
          </div>

          {/* CONTINGUT PRINCIPAL */}
          <div className="lg:col-span-3">
             <div className="bg-card border border-border rounded-3xl p-8 md:p-12 shadow-sm animate-in fade-in slide-in-from-bottom-4 duration-500">
                <article className="prose prose-slate dark:prose-invert max-w-none prose-headings:font-bold prose-a:text-primary hover:prose-a:underline prose-img:rounded-xl">
                   {children}
                </article>
             </div>
          </div>

        </div>
      </main>
      <Footer />
    </div>
  );
}

// =================== FILE: src/components/layout/Navbar.tsx ===================

'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { 
  LogOut, 
  LayoutDashboard, 
  Home, 
  Zap, 
  Award, 
  FolderGit2, 
  BookOpen,
  User
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { createClient } from '@/lib/supabase/client';
import { useRouter } from 'next/navigation';
import { ThemeToggle } from "@/components/ui/theme-toggle";
import type { User as SupabaseUser } from '@supabase/supabase-js';

// Definim els enllaÃ§os amb icones per al mÃ²bil
const NAV_LINKS = [
  { name: 'Inici', href: '/', icon: Home },
  { name: 'Solucions', href: '/#serveis', icon: Zap },
  { name: 'Projectes', href: '/projectes', icon: FolderGit2 },
  { name: 'Blog', href: '/blog', icon: BookOpen },
];

type Props = {
  user: SupabaseUser | null;
};

export function Navbar({ user }: Props) {
  const [isScrolled, setIsScrolled] = useState(false);
  const router = useRouter();
  const pathname = usePathname();
  const supabase = createClient();

  useEffect(() => {
    const handleScroll = () => setIsScrolled(window.scrollY > 20);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const handleSignOut = async () => {
    await supabase.auth.signOut();
    router.refresh();
  };

  return (
    <>
      {/* ==================================================================
          1. TOP NAVBAR (Desktop: Completa | MÃ²bil: NomÃ©s Logo)
      ================================================================== */}
      <header
        className={cn(
          "fixed top-0 w-full z-50 transition-all duration-300 border-b border-transparent",
          isScrolled 
            ? "bg-background/80 backdrop-blur-md shadow-sm border-border py-3" 
            : "bg-transparent py-4 md:py-6"
        )}
      >
        <div className="container mx-auto px-4 flex items-center justify-between">
          
          {/* LOGO (Visible sempre) */}
          <Link href="/" className="text-xl md:text-2xl font-bold tracking-tight z-50 flex items-center gap-2">
            <span className="bg-primary/10 p-1.5 rounded-lg md:hidden">
                <Zap className="w-5 h-5 text-primary" />
            </span>
            <span>DigitAI <span className="gradient-text">Studios</span></span>
          </Link>

          {/* DESKTOP NAV (Ocult en mÃ²bil) */}
          <nav className="hidden md:flex items-center gap-8">
            {NAV_LINKS.map((link) => (
              <Link
                key={link.name}
                href={link.href}
                className={cn(
                    "text-sm font-medium transition-colors hover:text-primary",
                    pathname === link.href ? "text-primary" : "text-muted-foreground"
                )}
              >
                {link.name}
              </Link>
            ))}

            <div className="h-6 w-px bg-border mx-2"></div>
            <ThemeToggle />

            {/* AUTH BUTTONS DESKTOP */}
            {user ? (
              <div className="flex items-center gap-4">
                <Link href="/dashboard">
                  <Button className="gradient-bg text-white border-0 shadow-lg shadow-primary/20">
                    <LayoutDashboard className="w-4 h-4 mr-2" /> Dashboard
                  </Button>
                </Link>
                <Button variant="ghost" size="icon" onClick={handleSignOut} title="Tancar SessiÃ³">
                  <LogOut className="w-5 h-5 text-muted-foreground hover:text-red-500 transition-colors" />
                </Button>
              </div>
            ) : (
              <div className="flex items-center gap-4">
                <Link href="/auth/login" className="text-sm font-medium hover:text-primary transition-colors">
                  Inicia SessiÃ³
                </Link>
                <Link href="/auth/register">
                  <Button className="gradient-bg text-white border-0 shadow-lg shadow-primary/20">
                    Registra't
                  </Button>
                </Link>
              </div>
            )}
          </nav>

          {/* MOBILE TOGGLES (NomÃ©s Theme) */}
          <div className="flex items-center gap-2 md:hidden">
             <ThemeToggle />
             {/* Si l'usuari estÃ  loguejat, posem un accÃ©s rÃ pid al dashboard dalt tambÃ© */}
             {user && (
                <Link href="/dashboard">
                    <Button size="icon" variant="ghost" className="rounded-full">
                        <img 
                            src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${user.email}`} 
                            alt="Avatar" 
                            className="w-8 h-8 rounded-full border border-border"
                        />
                    </Button>
                </Link>
             )}
          </div>
        </div>
      </header>

      {/* ==================================================================
          2. BOTTOM TAB BAR (NomÃ©s MÃ²bil) ğŸ“±
      ================================================================== */}
      <div className="md:hidden fixed bottom-0 left-0 w-full z-50 bg-background/90 backdrop-blur-xl border-t border-border pb-safe">
        <div className="flex justify-around items-center h-16 px-2">
            
            {/* 2.1 EnllaÃ§os Principals */}
            {NAV_LINKS.slice(0, 4).map((link) => {
                const Icon = link.icon;
                const isActive = pathname === link.href;
                
                return (
                    <Link 
                        key={link.name} 
                        href={link.href}
                        className={cn(
                            "flex flex-col items-center justify-center w-full h-full gap-1 active:scale-95 transition-transform",
                            isActive ? "text-primary" : "text-muted-foreground hover:text-foreground"
                        )}
                    >
                        <Icon className={cn("w-6 h-6", isActive && "fill-current/20")} strokeWidth={isActive ? 2.5 : 2} />
                        <span className="text-[10px] font-medium">{link.name}</span>
                    </Link>
                )
            })}

            {/* 2.2 BotÃ³ 'Perfil' o 'Login' (El 5Ã¨ element) */}
            {user ? (
                 <Link 
                    href="/dashboard"
                    className={cn(
                        "flex flex-col items-center justify-center w-full h-full gap-1 active:scale-95 transition-transform",
                        pathname.startsWith('/dashboard') ? "text-primary" : "text-muted-foreground"
                    )}
                 >
                    <LayoutDashboard className="w-6 h-6" strokeWidth={2} />
                    <span className="text-[10px] font-medium">Dash</span>
                 </Link>
            ) : (
                <Link 
                    href="/auth/login"
                    className="flex flex-col items-center justify-center w-full h-full gap-1 active:scale-95 transition-transform text-muted-foreground hover:text-foreground"
                 >
                    <User className="w-6 h-6" strokeWidth={2} />
                    <span className="text-[10px] font-medium">Login</span>
                 </Link>
            )}

        </div>
      </div>
    </>
  );
}

// =================== FILE: src/components/theme-provider.tsx ===================

"use client"

import * as React from "react"
import { ThemeProvider as NextThemesProvider } from "next-themes"

export function ThemeProvider({
  children,
  ...props
}: React.ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}

// =================== FILE: src/components/ui/button.tsx ===================

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

// DefiniciÃ³ de les variants de disseny
const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, ...props }, ref) => {
    return (
      <button
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

// =================== FILE: src/components/ui/card.tsx ===================

import * as React from "react"
import { cn } from "@/lib/utils"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)} {...props} />
  )
)
Card.displayName = "Card"

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  )
)
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3 ref={ref} className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props} />
  )
)
CardTitle.displayName = "CardTitle"

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
  )
)
CardContent.displayName = "CardContent"

export { Card, CardHeader, CardTitle, CardContent }

// =================== FILE: src/components/ui/checkbox.tsx ===================

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="grid place-content-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }


// =================== FILE: src/components/ui/input.tsx ===================

import * as React from "react"
import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.InputHTMLAttributes<HTMLInputElement>>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

// =================== FILE: src/components/ui/theme-toggle.tsx ===================

"use client"

import * as React from "react"
import { Moon, Sun } from "lucide-react"
import { useTheme } from "next-themes"
import { Button } from "@/components/ui/button"

export function ThemeToggle() {
  const { setTheme, theme } = useTheme()

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={() => setTheme(theme === "light" ? "dark" : "light")}
      className="relative rounded-full hover:bg-muted transition-colors"
      aria-label="Canviar tema"
    >
      <Sun className="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 text-orange-500" />
      <Moon className="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 text-blue-400" />
    </Button>
  )
}

// =================== FILE: src/features/analytics/actions.ts ===================

'use server';

import { createClient } from '@/lib/supabase/server';

type AnalyticsPayload = {
  event_name: string;
  path: string;
  session_id: string;
  referrer?: string;
  duration?: number;
  meta?: Record<string, unknown>;
};

export async function trackEventAction(data: AnalyticsPayload) {
  // LOG SERVER 1: Confirmem que la peticiÃ³ arriba al backend
  console.log("SERVER ACTION: Rebuda peticiÃ³ per:", data.path);

  try {
    const supabase = await createClient();

    // Comprovem si tenim usuari (opcional, nomÃ©s per info)
    const { data: { user } } = await supabase.auth.getUser();

    // LOG SERVER 2: Intentant inserir
    console.log("SERVER ACTION: Intentant inserir a Supabase...");

    const { error, data: insertedData } = await supabase.from('analytics_events').insert({
      event_name: data.event_name,
      path: data.path,
      session_id: data.session_id,
      user_id: user?.id || null,
      meta: {
        ...data.meta,
        referrer: data.referrer,
        duration: data.duration
      }
    })
    .select(); // Afegim select per veure si retorna alguna cosa

    // LOG SERVER 3: Resultat
    if (error) {
      console.error("âŒâŒ SUPABASE ERROR (CRÃTIC):", error);
      console.error("Detalls:", error.message, error.details, error.hint);
      return { success: false, error: error.message };
    }

    console.log("âœ…âœ… SUPABASE ÃˆXIT. ID inserit:", insertedData?.[0]?.id || 'Desconegut');
    return { success: true };

  } catch (err) {
    console.error("ğŸ’¥ğŸ’¥ ERROR INTERN NO CONTROLAT:", err);
    return { success: false, error: 'Internal Server Error' };
  }
}

// =================== FILE: src/features/analytics/ui/AnalyticsTracker.tsx ===================

'use client';

import { useEffect } from 'react';
import { usePathname, useSearchParams } from 'next/navigation';
import { createClient } from '@/lib/supabase/client'; // Assegura't que tens aquest fitxer client

export function AnalyticsTracker() {
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const supabase = createClient();

  useEffect(() => {
    // Aquest log T'HA DE SORTIR a la consola del navegador
    console.log("ğŸ‘€ AnalyticsTracker iniciat a:", pathname);

    const trackView = async () => {
      // 1. Netejem la URL (treiem l'idioma)
      const rawPath = pathname || '/';
      // ExpressiÃ³ regular per treure /ca, /es, /en del principi
      const cleanPath = rawPath.replace(/^\/(ca|es|en)(\/|$)/, '$2') || '/';
      
      // Si ha quedat buit (era nomÃ©s /ca), posem /
      const finalPath = cleanPath === '' ? '/' : cleanPath;
      // Si no comenÃ§a per /, li posem (per coherÃ¨ncia estÃ¨tica)
      const pathStored = finalPath.startsWith('/') ? finalPath : `/${finalPath}`;

      console.log(`ğŸ“¡ Enviant dades... Path Original: ${rawPath} -> Guardat: ${pathStored}`);

      const { error } = await supabase.from('analytics_events').insert({
        event_name: 'page_view',
        path: pathStored,
        // Generem ID sessiÃ³ rÃ pid si no en tenim (per test)
        session_id: localStorage.getItem('digitai_session') || 'session-' + Math.random().toString(36).slice(2),
        meta: {
          raw_url: window.location.href,
          referrer: document.referrer
        }
      });

      if (error) console.error("âŒ Error Supabase:", error.message);
      else console.log("âœ… DADA GUARDADA!");
    };

    // Petit retard per no bloquejar la navegaciÃ³ visual
    const timeout = setTimeout(trackView, 500);
    return () => clearTimeout(timeout);

  }, [pathname, searchParams, supabase]);

  return null;
}

// =================== FILE: src/features/analytics/ui/BarListChart.tsx ===================

'use client';

import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

type Props = {
  title: string;
  data: { name: string; value: number; color?: string }[];
};

export function BarListChart({ title, data }: Props) {
  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 h-full flex flex-col min-h-0">      
    <CardHeader className="pb-2 pt-4 px-4 shrink-0">
      <CardTitle className="text-sm font-medium text-slate-400">{title}</CardTitle>
    </CardHeader>
      <CardContent className="flex-1 min-h-0 pb-2 px-2">
        <ResponsiveContainer width="100%" height="100%">
          {/* layout="vertical" fa les barres horitzontals */}
          <BarChart layout="vertical" data={data} margin={{ left: 0, right: 30, bottom: 0, top: 0 }} barCategoryGap={4}>
            <XAxis type="number" hide />
            <YAxis
              dataKey="name"
              type="category"
              width={100}
              tick={{ fill: '#94a3b8', fontSize: 14 }}
              interval={0}
              tickLine={false}
              axisLine={false}
              // Trunquem textos llargs
              tickFormatter={(val) => val.length > 12 ? `${val.substring(0, 12)}...` : val}
            />
            <Tooltip cursor={{ fill: '#334155', opacity: 0.2 }} contentStyle={{ backgroundColor: '#0f172a', borderColor: '#334155', fontSize: '12px', color: '#fff' }} />
            <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={16}>
              {data.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.color || '#6366f1'} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/analytics/ui/DeviceChart.tsx ===================

'use client';

import { PieChart, Pie, Cell, Tooltip, ResponsiveContainer, Legend } from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

type Props = {
  data: { name: string; value: number; fill: string }[];
};

export function DeviceChart({ data }: Props) {
  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 h-full flex flex-col min-h-0">
      <CardHeader>
        <CardTitle>Dispositiusss</CardTitle>
      </CardHeader>
      <CardContent className="flex-1 min-h-0">
        <div className="h-full flex flex-col min-h-0">
          <ResponsiveContainer width="100%" height="100%">
            <PieChart>
              <Pie
                data={data}
                cx="50%"
                cy="50%"
                innerRadius={60}
                outerRadius={80}
                paddingAngle={5}
                dataKey="value"
              >
                {data.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.fill} stroke="rgba(0,0,0,0.2)" />
                ))}
              </Pie>
              <Tooltip 
                 contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', borderRadius: '8px' }}
                 itemStyle={{ color: '#fff' }}
              />
              <Legend verticalAlign="bottom" height={36}/>
            </PieChart>
          </ResponsiveContainer>
        </div>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/analytics/ui/TopPagesCard.tsx ===================

'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

type Props = {
  data: { path: string; views: number }[];
};

export function TopPagesCard({ data }: Props) {
  // 1. Ordenem per vistes (de mÃ©s a menys) per seguretat
  const sortedData = [...data].sort((a, b) => b.views - a.views);
  
  // 2. Calculem el mÃ xim per fer les barres relatives (regla de 3)
  const maxViews = sortedData[0]?.views || 0;

  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 h-full flex flex-col min-h-0">
      <CardHeader className="pb-2 pt-4 px-4 shrink-0">
        <div className="flex justify-between items-center">
             <CardTitle className="text-sm font-medium text-slate-400">Top PÃ gines</CardTitle>
             <span className="text-xs text-slate-500 font-mono">Vistes</span>
        </div>
      </CardHeader>
      
      <CardContent className="flex-1 min-h-0 pb-2 px-2">
        {/* CONTENIDOR SCROLLABLE:
            - h-full: Ocupa tot l'espai disponible
            - overflow-y-auto: Activa l'scroll vertical si no hi cap
            - pr-2: Un petit marge a la dreta perquÃ¨ l'scroll no tapi text
        */}
        <div className="h-full w-full overflow-y-auto pr-2 custom-scrollbar">
          
          {sortedData.length === 0 ? (
            <div className="flex items-center justify-center h-full text-slate-500 text-xs">
              Sense dades suficients
            </div>
          ) : (
            <div className="flex flex-col gap-3">
              {sortedData.map((page, index) => {
                // Calculem el % d'amplada de la barra
                const percentage = maxViews > 0 ? (page.views / maxViews) * 100 : 0;

                return (
                  <div key={index} className="group">
                    {/* Fila superior: URL i NÃºmero */}
                    <div className="flex justify-between text-xs mb-1">
                      <span className="truncate pr-4 text-slate-300 font-medium" title={page.path}>
                        {page.path}
                      </span>
                      <span className="text-slate-400 font-mono tabular-nums">
                        {page.views}
                      </span>
                    </div>
                    
                    {/* Barra de progrÃ©s visual */}
                    <div className="h-1.5 w-full bg-slate-800 rounded-full overflow-hidden">
                      <div 
                        className="h-full bg-indigo-500 rounded-full transition-all duration-500 ease-out group-hover:bg-indigo-400"
                        style={{ width: `${percentage}%` }}
                      />
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/analytics/ui/TrafficChart.tsx ===================

'use client';

import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

type Props = {
  data: { date: string; visitors: number; views: number }[];
};

export function TrafficChart({ data }: Props) {
  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 col-span-2 h-full flex flex-col min-h-0">      <CardHeader>
      <CardTitle>TrÃ nsit (Ãšltims 7 dies)</CardTitle>
    </CardHeader>
      <CardContent className="flex-1 min-h-0 pb-2 px-2">
        <div className="h-full flex flex-col min-h-0">
          <ResponsiveContainer width="100%" height="100%">
            <AreaChart data={data}>
              <defs>
                <linearGradient id="colorViews" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#8884d8" stopOpacity={0.3} />
                  <stop offset="95%" stopColor="#8884d8" stopOpacity={0} />
                </linearGradient>
                <linearGradient id="colorVisitors" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#82ca9d" stopOpacity={0.3} />
                  <stop offset="95%" stopColor="#82ca9d" stopOpacity={0} />
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
              <XAxis dataKey="date" stroke="#94a3b8" />
              <YAxis stroke="#94a3b8" />
              <Tooltip
                contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#f1f5f9' }}
              />
              <Area type="monotone" dataKey="views" stroke="#8884d8" fillOpacity={1} fill="url(#colorViews)" name="Vistes de PÃ gina" />
              <Area type="monotone" dataKey="visitors" stroke="#82ca9d" fillOpacity={1} fill="url(#colorVisitors)" name="Usuaris Ãšnics" />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/analytics/ui/UnifiedStatBar.tsx ===================

import { Card } from '@/components/ui/card';
import { Users, Eye, MousePointerClick, Clock, TrendingUp } from 'lucide-react';

interface UnifiedStatBarProps {
  views: number;
  visitors: number;
  events: number;
  avgTime: string;
}

interface StatItemProps {
  label: string;
  value: number | string;
  icon: React.ReactNode;
}

export function UnifiedStatBar({ views, visitors, events, avgTime }: UnifiedStatBarProps) {
  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 p-4 shadow-lg">
        <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
        
            {/* TÃ­tol: Al mÃ²bil a dalt, a l'escriptori a l'esquerra amb vora */}
            <div className="flex items-center gap-3 lg:pr-8 lg:border-r lg:border-slate-800 pb-4 lg:pb-0 border-b border-slate-800 lg:border-b-0">
                <div className="p-2 bg-primary/10 rounded-lg">
                    <TrendingUp className="text-primary h-6 w-6" />
                </div>
                <div>
                    <h1 className="text-lg font-bold text-white leading-tight">Dashboard</h1>
                    <p className="text-xs text-slate-500">Temps real</p>
                </div>
            </div>

            {/* MÃ¨triques: Grid 2x2 al mÃ²bil, Flex row a l'escriptori */}
            <div className="flex-1 grid grid-cols-2 gap-y-6 lg:flex lg:justify-around lg:items-center">
                <StatItem label="Vistes (7d)" value={views} icon={<Eye className="h-4 w-4 text-blue-400" />} />
                
                {/* Separador nomÃ©s en escriptori */}
                <div className="hidden lg:block h-8 w-px bg-slate-800" />
                
                <StatItem label="Usuaris" value={visitors} icon={<Users className="h-4 w-4 text-green-400" />} />
                
                <div className="hidden lg:block h-8 w-px bg-slate-800" />
                
                <StatItem label="Events" value={events} icon={<MousePointerClick className="h-4 w-4 text-purple-400" />} />
                
                <div className="hidden lg:block h-8 w-px bg-slate-800" />
                
                <StatItem label="Temps MitjÃ " value={avgTime} icon={<Clock className="h-4 w-4 text-orange-400" />} />
            </div>
        </div>
    </Card>
  );
}

// StatItem es queda igual
function StatItem({ label, value, icon }: StatItemProps) {
    return (
        <div className="flex flex-col items-center gap-1 min-w-[100px]">
            <span className="text-[10px] uppercase tracking-wider text-slate-500 font-bold flex items-center gap-2">
                {icon} {label}
            </span>
            <span className="text-2xl font-bold text-white leading-none">
                {value}
            </span>
        </div>
    )
}

// =================== FILE: src/features/analytics/ui/VerticalBarChart.tsx ===================

'use client';

import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

type Props = {
  title: string;
  data: { name: string; value: number; color?: string }[];
};

export function VerticalBarChart({ title, data }: Props) {
  return (
    <Card className="bg-slate-900 border-slate-800 text-slate-200 h-full flex flex-col">
      <CardHeader className="pb-2">
        <CardTitle className="text-base font-medium text-slate-300">{title}</CardTitle>
      </CardHeader>
      <CardContent className="flex-1 min-h-[200px]">
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
            <XAxis 
              dataKey="name" 
              stroke="#64748b" 
              fontSize={14} 
              tickLine={false}
              axisLine={false}
              interval={0} // Mostra totes les etiquetes
              // Si els noms sÃ³n llargs, els trunquem
              tickFormatter={(value) => value.length > 6 ? `${value.substring(0, 6)}..` : value}
            />
            <YAxis stroke="#64748b" fontSize={10} tickLine={false} axisLine={false} />
            <Tooltip 
              cursor={{ fill: '#334155', opacity: 0.2 }}
              contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#f1f5f9', borderRadius: '8px', fontSize: '12px' }}
            />
            <Bar dataKey="value" radius={[4, 4, 0, 0]}>
              {data.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.color || '#10b981'} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/audit/actions.ts ===================

'use server';

import { auditService } from '@/services/container';
import { z } from 'zod';
import { redirect } from 'next/navigation';
import { getLocale } from 'next-intl/server';
import { createClient } from '@/lib/supabase/server';

// --- 1. SCHEMAS DE VALIDACIÃ“ ---

const PublicAuditSchema = z.object({
  url: z.string().url({ message: "La URL ha de ser vÃ lida (https://...)" }),
  email: z.string().email({ message: "L'email no Ã©s correcte" }),
});

const PrivateAuditSchema = z.string().url();

// --- 2. TIPUS PER A ELS FORMULARIS ---

export type FormState = {
  success?: boolean;
  message?: string;
  errors?: {
    url?: string[];
    email?: string[];
  };
};

// --- 3. ACTION PÃšBLICA (Landing Page) ---
// Aquesta Ã©s la que crida l'AuditForm de la home
export async function processWebAudit(prevState: FormState, formData: FormData): Promise<FormState> {
  const locale = await getLocale();

  const rawData = {
    url: formData.get('url'),
    email: formData.get('email'),
  };

  // 1. Validem URL i Email
  const validation = PublicAuditSchema.safeParse(rawData);

  if (!validation.success) {
    return {
      success: false,
      errors: validation.error.flatten().fieldErrors,
      message: "Revisa les dades del formulari.",
    };
  }

  try {
    // 2. Cridem al servei per fer l'auditoria PÃšBLICA
    // (Aquest mÃ¨tode s'encarregarÃ  de crear l'usuari o lligar-ho per email)
    await auditService.performPublicAudit(validation.data.url, validation.data.email, locale);
    
  } catch (err) {
    console.error(err);
    return { success: false, message: "Error durant l'anÃ lisi. Prova mÃ©s tard." };
  }

  // 3. RedirecciÃ³ a Registre (perquÃ¨ vegi el resultat allÃ )
  redirect(`/${locale}/auth/register?email=${encodeURIComponent(validation.data.email)}`);
}


// --- 4. ACTION PRIVADA (Dashboard) ---
// Aquesta Ã©s la que crida el CreateAuditForm del panell
export async function createAuditAction(url: string) {
  const locale = await getLocale();
  let auditId = null;

  // 1. Validem nomÃ©s URL
  const validation = PrivateAuditSchema.safeParse(url);
  if (!validation.success) {
    return { success: false, message: 'URL invÃ lida.' };
  }

  // 2. Comprovem sessiÃ³
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user || !user.email) {
    return { success: false, message: 'No estÃ s autenticat.' };
  }

  try {
    // 3. Cridem al servei per fer l'auditoria PRIVADA (ja tenim user.id)
    auditId = await auditService.performUserAudit(url, user.id, user.email, locale);

  } catch (e) {
    console.error(e);
    return { success: false, message: 'Error al processar l\'auditoria.' };
  }

  // 4. RedirecciÃ³ al detall de l'informe
  if (auditId) {
    redirect(`/${locale}/dashboard/audits/${auditId}`);
  }
  
  return { success: false, message: 'Error desconegut al crear.' };
}

// =================== FILE: src/features/audit/ui/AuditForm.tsx ===================

'use client';

import { useActionState } from 'react';
import { processWebAudit } from '../actions';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Search, Loader2, AlertCircle } from 'lucide-react';

export function AuditForm() {
  const [state, action, isPending] = useActionState(processWebAudit, { message: '', errors: {} });

  return (
    <div className="w-full">
      {/* CONTENIDOR: Vidre fosc en Dark, Blanc amb ombra en Light */}
      <div className="border border-border rounded-2xl p-8 bg-white/50 dark:bg-white/2 backdrop-blur-xl shadow-xl dark:shadow-2xl transition-all duration-300">
        
        <h3 className="text-xl font-bold text-center text-foreground mb-6 flex items-center justify-center gap-2">
          <Search className="w-5 h-5 text-primary" />
          Analitza la teva web en segons
        </h3>
        
        <form action={action} className="space-y-4">
          <div className="space-y-1">
            <Input 
              name="url" 
              placeholder="https://la-teva-web.com" 
              // INPUTS: Adaptats a Light (bg-white) i Dark (bg-white/5)
              className="bg-white dark:bg-white/5 border-slate-200 dark:border-white/10 text-foreground h-12 focus:border-primary/50 placeholder:text-muted-foreground transition-all"
            />
            {state.errors?.url && (
              <p className="text-red-500 text-xs flex items-center gap-1 mt-1 ml-1">
                <AlertCircle className="w-3 h-3" /> {state.errors.url[0]}
              </p>
            )}
          </div>

          <div className="space-y-1">
            <Input 
              name="email" 
              placeholder="el-teu@email.com" 
              className="bg-white dark:bg-white/5 border-slate-200 dark:border-white/10 text-foreground h-12 focus:border-primary/50 placeholder:text-muted-foreground transition-all"
            />
            {state.errors?.email && (
              <p className="text-red-500 text-xs flex items-center gap-1 mt-1 ml-1">
                <AlertCircle className="w-3 h-3" /> {state.errors.email[0]}
              </p>
            )}
          </div>

          <Button 
            type="submit" 
            disabled={isPending} 
            className="w-full h-12 mt-2 text-base font-semibold rounded-lg gradient-bg text-white border-0 hover:opacity-90 shadow-lg shadow-primary/20 transition-all"
          >
            {isPending ? (
              <><Loader2 className="w-4 h-4 mr-2 animate-spin" /> Analitzant...</>
            ) : (
              'Obtenir Informe GratuÃ¯t'
            )}
          </Button>
          
          {state.message && (
            <p className="text-center text-muted-foreground text-sm mt-4 bg-muted/50 p-2 rounded-lg border border-border/50">
              {state.message}
            </p>
          )}
        </form>
      </div>
      
      {/* Text de privacitat petit */}
      <p className="text-center text-xs text-muted-foreground mt-4 opacity-60">
        No compartim les teves dades. Informe 100% gratuÃ¯t.
      </p>
    </div>
  );
}

// =================== FILE: src/features/audit/ui/components/AuditHeader.tsx ===================

import { Link } from '@/routing';
import { Button } from '@/components/ui/button';
import { ArrowLeft, Share2 } from 'lucide-react';
// ğŸ‘‡ Importem el botÃ³ real
import { DownloadAuditButton } from './DownloadAuditButton';
// ğŸ‘‡ 1. Importem el tipus correcte per als issues
import { AuditIssue } from '@/adapters/IWebScanner';

type Props = { 
  url: string; 
  date: Date;
  pdfData: {
    url: string;
    date: string;
    scores: { seo: number; perf: number; a11y: number; best: number };
    screenshot?: string;
    // ğŸ‘‡ 2. Corregim 'any[]' per 'AuditIssue[]'
    issues: AuditIssue[];
    
  }
};

export function AuditHeader({ url, date, pdfData }: Props) {
  return (
    <div className="flex flex-col md:flex-row md:items-center justify-between gap-6 border-b border-white/5 pb-6">
      <div>
        <Link href="/dashboard" className="text-xs font-medium text-slate-400 hover:text-primary flex items-center gap-1 mb-3 transition-colors uppercase tracking-wider">
          <ArrowLeft className="w-3 h-3" /> Tornar al Dashboard
        </Link>
        <h1 className="text-3xl md:text-4xl font-bold text-white tracking-tight truncate max-w-2xl">
          Informe: <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-primary">{url}</span>
        </h1>
        <p className="text-sm text-slate-500 mt-2 font-mono">
          ID: {date.getTime().toString(36).toUpperCase()} â€¢ Generat el {date.toLocaleDateString()}
        </p>
      </div>
      
      <div className="flex gap-3">
        <Button variant="outline" className="border-slate-700 text-slate-300 hover:bg-slate-800 hover:text-white">
            <Share2 className="w-4 h-4 mr-2" /> Compartir
        </Button>
        
        {/* BotÃ³ de descarrega */}
        <DownloadAuditButton data={pdfData} />
      </div>
    </div>
  );
}

// =================== FILE: src/features/audit/ui/components/CoreVitalsGrid.tsx ===================

import { Zap, LayoutTemplate, MoveHorizontal, Clock, Gauge } from 'lucide-react';

// 1. DefiniciÃ³ local del tipus de Google (Relaxada)
type LighthouseAudit = {
  id: string;
  title: string;
  description: string;
  score?: number | null; // ğŸ‘ˆ AFEGIT EL '?' (Ara accepta undefined)
  displayValue?: string;
  numericValue?: number;
};

// 2. Tipus unificat exportat
export type AuditMetric = {
  score?: number | null; // ğŸ‘ˆ TambÃ© aquÃ­
  value?: string;
  description?: string;
};

type CoreVitalsGridProps = {
  metrics?: {
    fcp?: AuditMetric;
    lcp?: AuditMetric;
    cls?: AuditMetric;
    tbt?: AuditMetric;
    si?: AuditMetric;
  };
  // Ara accepta el tipus relaxat
  googleAudits?: Record<string, LighthouseAudit>;
};

export function CoreVitalsGrid({ metrics, googleAudits }: CoreVitalsGridProps) {
  
  const getMetric = (key: string, googleKey: string): AuditMetric => {
    // 1. Prioritat: Dades normalitzades
    if (metrics && metrics[key as keyof typeof metrics]) {
      return metrics[key as keyof typeof metrics]!;
    }
    
    // 2. Fallback: Dades crues de Google
    if (googleAudits && googleAudits[googleKey]) {
      const audit = googleAudits[googleKey];
      return {
        score: audit.score,
        value: audit.displayValue,
        description: audit.title
      };
    }

    return { score: null, value: 'N/A', description: 'No disponible' };
  };

  const fcp = getMetric('fcp', 'first-contentful-paint');
  const lcp = getMetric('lcp', 'largest-contentful-paint');
  const cls = getMetric('cls', 'cumulative-layout-shift');
  const tbt = getMetric('tbt', 'total-blocking-time');
  const si = getMetric('si', 'speed-index');

  if (fcp.value === 'N/A' && lcp.value === 'N/A') return null;

  return (
    <div className="mb-8">
      <h2 className="text-xl font-bold text-foreground mb-4 flex items-center gap-2">
        <span className="w-1.5 h-6 bg-primary rounded-full"></span>
        MÃ¨triques de Rendiment (Core Web Vitals)
      </h2>
      
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <MetricCard title="FCP" subtitle="First Contentful Paint" value={fcp.value || "N/A"} score={fcp.score} icon={Zap} tooltip="Temps fins primer contingut." />
        <MetricCard title="LCP" subtitle="Largest Contentful Paint" value={lcp.value || "N/A"} score={lcp.score} icon={LayoutTemplate} tooltip="Temps element mÃ©s gran." />
        <MetricCard title="CLS" subtitle="Cumulative Layout Shift" value={cls.value || "N/A"} score={cls.score} icon={MoveHorizontal} tooltip="Estabilitat visual." />
        <MetricCard title="TBT" subtitle="Total Blocking Time" value={tbt.value || "N/A"} score={tbt.score} icon={Clock} tooltip="Temps de bloqueig." />
        <MetricCard title="SI" subtitle="Speed Index" value={si.value || "N/A"} score={si.score} icon={Gauge} tooltip="Ãndex de velocitat." />
      </div>
    </div>
  );
}

type MetricCardProps = {
    title: string;
    subtitle: string;
    value: string;
    score?: number | null;
    icon: React.ElementType;
    tooltip?: string;
};
  
function MetricCard({ title, subtitle, value, score, icon: Icon, tooltip }: MetricCardProps) {
    let colorClass = 'text-slate-500 dark:text-slate-400';
    let bgClass = 'bg-slate-100 border-slate-200 dark:bg-slate-800/50 dark:border-slate-700';
    let iconColor = 'text-slate-400';

    // Comprovem que score sigui un nÃºmero vÃ lid abans de comparar
    if (typeof score === 'number') {
        if (score >= 0.9) {
            colorClass = 'text-green-600 dark:text-green-400';
            bgClass = 'bg-green-50 border-green-200 dark:bg-green-500/10 dark:border-green-500/20';
            iconColor = 'text-green-500';
        } else if (score >= 0.5) {
            colorClass = 'text-yellow-600 dark:text-yellow-400';
            bgClass = 'bg-yellow-50 border-yellow-200 dark:bg-yellow-500/10 dark:border-yellow-500/20';
            iconColor = 'text-yellow-500';
        } else {
            colorClass = 'text-red-600 dark:text-red-400';
            bgClass = 'bg-red-50 border-red-200 dark:bg-red-500/10 dark:border-red-500/20';
            iconColor = 'text-red-500';
        }
    }

    return (
        <div className={`p-4 rounded-xl border ${bgClass} flex flex-col items-center text-center transition-all hover:scale-[1.02] h-full justify-between`} title={tooltip}>
            <div className="flex flex-col items-center">
                <div className={`mb-3 p-2.5 rounded-full bg-background/50 ${iconColor}`}>
                    <Icon className="w-5 h-5" />
                </div>
                <span className="text-sm font-bold text-foreground mb-1">{title}</span>
                <span className="text-[10px] text-muted-foreground uppercase tracking-wide mb-2 px-2 line-clamp-1">{subtitle}</span>
            </div>
            <span className={`text-2xl font-extrabold ${colorClass}`}>{value}</span>
        </div>
    )
}

// =================== FILE: src/features/audit/ui/components/CreateAuditForm.tsx ===================

'use client';

import { useState } from 'react';
// Ja no necessitem useRouter ni router.push!
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Loader2, Search, Globe } from 'lucide-react';
import { createAuditAction } from '../../actions';

export function CreateAuditForm() {
  const [url, setUrl] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');

    // Cridem a l'acciÃ³.
    // Si tÃ© Ã¨xit, l'acciÃ³ farÃ  redirect i aquesta funciÃ³ s'aturarÃ  aquÃ­.
    // Si falla, ens retornarÃ  l'objecte amb l'error.
    const result = await createAuditAction(url);
    
    // Si arribem a aquesta lÃ­nia, vol dir que NO ha redirigit (per tant, hi ha hagut error)
    if (result && !result.success) {
        setError(result.message || 'Error desconegut');
        setIsLoading(false); // NomÃ©s parem loading si hi ha error
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="space-y-2">
         <label className="text-sm font-medium text-slate-300 ml-1">URL del Lloc Web</label>
         <div className="relative">
            <Globe className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500" />
            <Input 
               type="url" 
               placeholder="https://exemple.com" 
               value={url}
               onChange={(e) => setUrl(e.target.value)}
               required
               disabled={isLoading} // Desactivem mentre carrega
               className="pl-10 bg-white/5 border-white/10 text-white h-12 focus:border-primary focus:ring-primary placeholder:text-slate-600"
            />
         </div>
      </div>

      {error && (
         <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm">
            {error}
         </div>
      )}

      <Button 
         type="submit" 
         disabled={isLoading || !url} 
         className="w-full h-12 gradient-bg text-white font-bold rounded-xl hover:opacity-90 transition-all shadow-lg shadow-primary/20"
      >
         {isLoading ? (
            <><Loader2 className="w-4 h-4 mr-2 animate-spin" /> Analitzant Web...</>
         ) : (
            <><Search className="w-4 h-4 mr-2" /> ComenÃ§ar AnÃ lisi</>
         )}
      </Button>
      
      <p className="text-xs text-center text-slate-500">
         L'anÃ lisi pot trigar entre 10 i 30 segons. Si us plau, no tanquis la pÃ gina.
      </p>
    </form>
  );
}

// =================== FILE: src/features/audit/ui/components/DownloadAuditButton.tsx ===================

'use client';

import React from 'react';
import dynamic from 'next/dynamic';
import { Button } from '@/components/ui/button';
import { Download, Loader2 } from 'lucide-react';
// Assegura't que el nom del fitxer coincideix exactament (MajÃºscules/minÃºscules)
import { AuditPDFDocument } from '@/features/audit/ui/pdf/AuditPdfDocument'; 
import { AuditIssue } from '@/adapters/IWebScanner';

const PDFDownloadLink = dynamic(
  () => import('@react-pdf/renderer').then((mod) => mod.PDFDownloadLink),
  { 
    ssr: false,
    loading: () => (
      <Button variant="outline" disabled className="bg-background text-muted-foreground border-border">
         <Loader2 className="w-4 h-4 mr-2 animate-spin" /> Preparant PDF...
      </Button>
    )
  }
);

type Props = {
  data: {
    url: string;
    date: string;
    scores: { seo: number; perf: number; a11y: number; best: number };
    screenshot?: string;
    issues: AuditIssue[]; 
  }
};

export function DownloadAuditButton({ data }: Props) {
  return (
    <PDFDownloadLink
      document={
        <AuditPDFDocument 
            url={data.url}
            date={data.date}
            scores={data.scores}
            screenshot={data.screenshot}
            issues={data.issues}
        />
      }
      fileName={`audit-${data.url.replace(/[^a-z0-9]/gi, '_')}.pdf`}
    >
      {({ loading }) => (
        <Button 
            // Canviem l'estil perquÃ¨ sigui consistent amb el tema
            className="bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm"
            disabled={loading}
        >
          {loading ? (
            <>
               <Loader2 className="w-4 h-4 mr-2 animate-spin" /> Generant...
            </>
          ) : (
            <>
               <Download className="w-4 h-4 mr-2" /> Descarregar PDF
            </>
          )}
        </Button>
      )}
    </PDFDownloadLink>
  );
}

// =================== FILE: src/features/audit/ui/components/IssuesList.tsx ===================

import { Card, CardContent } from '@/components/ui/card';
import { AlertTriangle, CheckCircle } from 'lucide-react';
import { AuditIssue } from '@/adapters/IWebScanner';

type Props = { issues: AuditIssue[] };

export function IssuesList({ issues }: Props) {
  return (
    <div className="mt-12">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-xl font-bold text-foreground flex items-center gap-2">
           <AlertTriangle className="text-yellow-500" />
           Accions Recomanades
        </h2>
        <span className="bg-red-500/10 text-red-600 dark:text-red-400 text-xs font-bold px-3 py-1 rounded-full border border-red-500/20">
           {issues?.length || 0} Errors CrÃ­tics
        </span>
      </div>
      
      <div className="grid gap-4">
        {issues?.map((issue, index) => (
           // Canviem bg-[#0f111a] per classes adaptables
           <Card key={index} className="bg-card border border-border hover:border-primary/50 transition-colors group shadow-sm">
              <CardContent className="p-5 flex gap-4">
                 <div className="shrink-0 mt-1">
                    <div className="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></div>
                 </div>
                 <div className="flex-1">
                    <h3 className="font-bold text-foreground group-hover:text-primary transition-colors text-lg mb-1">
                        {issue.title}
                    </h3>
                    <p className="text-sm text-muted-foreground leading-relaxed mb-3">
                        {issue.description}
                    </p>
                    {issue.displayValue && (
                        <div className="inline-flex items-center gap-2 px-3 py-1 rounded bg-red-500/5 border border-red-500/10 text-xs font-mono text-red-600 dark:text-red-400">
                            <span>Impacte:</span>
                            <span className="font-bold">{issue.displayValue}</span>
                        </div>
                    )}
                 </div>
              </CardContent>
           </Card>
        ))}
        
        {(!issues || issues.length === 0) && (
            <div className="text-center py-12 bg-muted/30 rounded-xl border border-dashed border-border">
                <CheckCircle className="w-12 h-12 text-green-500 mx-auto mb-4 opacity-50" />
                <p className="text-muted-foreground">IncreÃ¯ble! No hem trobat errors crÃ­tics.</p>
            </div>
        )}
      </div>
    </div>
  );
}

// =================== FILE: src/features/audit/ui/components/MobilePreviw.tsx ===================

import Image from 'next/image';

export function MobilePreview({ screenshot }: { screenshot: string }) {
  if (!screenshot) return null;
  
  return (
    <div className="mt-8 flex flex-col items-center">
      <h2 className="text-xl font-bold text-white mb-6">Vista PrÃ¨via MÃ²bil</h2>
      {/* Mockup Minimalista Fosc */}
      <div className="relative border-slate-800 bg-slate-900 border-[10px] rounded-[2.5rem] h-[600px] w-[300px] shadow-2xl shadow-black">
         <div className="h-[32px] w-[3px] bg-slate-800 absolute -start-[13px] top-[72px] rounded-s-lg"></div>
         <div className="h-[46px] w-[3px] bg-slate-800 absolute -start-[13px] top-[124px] rounded-s-lg"></div>
         <div className="h-[46px] w-[3px] bg-slate-800 absolute -start-[13px] top-[178px] rounded-s-lg"></div>
         <div className="h-[64px] w-[3px] bg-slate-800 absolute -end-[13px] top-[142px] rounded-e-lg"></div>
         <div className="rounded-[2rem] overflow-hidden w-[280px] h-[580px] bg-black">
            <Image
                src={screenshot}
                alt="Mobile Screenshot"
                width={280}
                height={580}
                className="w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity"
                unoptimized
            />
         </div>
      </div>
    </div>
  );
}

// =================== FILE: src/features/audit/ui/components/ScoreGrid.tsx ===================

import { Card, CardContent } from '@/components/ui/card';
import { ScoreRing } from '@/components/charts/ScoreRing';

type Props = { seo: number; perf: number };

export function ScoreGrid({ seo, perf }: Props) {
  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
      <ScoreCard score={seo} label="SEO" />
      <ScoreCard score={perf} label="Rendiment" />
      <ScoreCard score={85} label="Accessibilitat" />
      <ScoreCard score={92} label="Best Practices" />
    </div>
  );
}

function ScoreCard({ score, label }: { score: number; label: string }) {
  return (
    // Canviem bg-[#0f111a]/50 per bg-background/40 o bg-card
    <Card className="bg-background/40 border border-border hover:border-primary/20 transition-colors backdrop-blur-md shadow-sm">
      <CardContent className="pt-6 pb-6 flex justify-center">
        <ScoreRing score={score} label={label} />
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/audit/ui/pdf/AuditPdfDocument.tsx ===================

import React from 'react';
import { Page, Text, View, Document, StyleSheet, Image } from '@react-pdf/renderer';

// Definim els tipus de dades que necessitem
type Issue = {
  title: string;
  description: string;
};

type Props = {
  url: string;
  date: string;
  scores: { seo: number; perf: number; a11y: number; best: number };
  screenshot?: string;
  issues: Issue[];
};

// ESTILS DEL PDF (Semblant a CSS perÃ² en objecte JS)
const styles = StyleSheet.create({
  page: {
    flexDirection: 'column',
    backgroundColor: '#0f111a', // Fons fosc
    color: '#ffffff',
    padding: 30,
    fontFamily: 'Helvetica',
  },
  header: {
    marginBottom: 20,
    borderBottomWidth: 1,
    borderBottomColor: '#334155',
    paddingBottom: 10,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  title: { fontSize: 24, fontWeight: 'bold', color: '#ffffff' },
  subtitle: { fontSize: 10, color: '#94a3b8', marginTop: 4 },
  brand: { fontSize: 10, color: '#7c3aed', textTransform: 'uppercase' }, // Lila de marca
  
  // Grid de Puntuacions
  scoresContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 30,
    backgroundColor: '#1e293b',
    padding: 15,
    borderRadius: 8,
  },
  scoreItem: { alignItems: 'center', width: '25%' },
  scoreValue: { fontSize: 28, fontWeight: 'bold' },
  scoreLabel: { fontSize: 10, color: '#94a3b8', marginTop: 4, textTransform: 'uppercase' },

  // SecciÃ³ MÃ²bil
  sectionTitle: { fontSize: 16, marginBottom: 10, color: '#ffffff', marginTop: 10 },
  imageContainer: {
    alignItems: 'center',
    marginBottom: 20,
    padding: 10,
    backgroundColor: '#1e293b',
    borderRadius: 8,
  },
  screenshot: { width: 200, height: 400, borderRadius: 4, objectFit: 'contain' },

  // Llista d'Errors
  issueCard: {
    marginBottom: 8,
    padding: 10,
    backgroundColor: '#ffffff', // Targetes blanques per contrast de lectura
    borderRadius: 4,
    borderLeftWidth: 4,
    borderLeftColor: '#ef4444', // Vermell error
  },
  issueTitle: { fontSize: 12, color: '#0f111a', fontWeight: 'bold' },
  issueDesc: { fontSize: 10, color: '#475569', marginTop: 2 },
  
  footer: {
    position: 'absolute',
    bottom: 30,
    left: 30,
    right: 30,
    textAlign: 'center',
    fontSize: 8,
    color: '#64748b',
    borderTopWidth: 1,
    borderTopColor: '#334155',
    paddingTop: 10,
  }
});

// Helper per colors
const getScoreColor = (score: number) => {
  if (score >= 90) return '#4ade80'; // Verd
  if (score >= 50) return '#facc15'; // Groc
  return '#f87171'; // Vermell
};

export const AuditPDFDocument = ({ url, date, scores, screenshot, issues }: Props) => (
  <Document>
    <Page size="A4" style={styles.page}>
      
      {/* 1. HEADER */}
      <View style={styles.header}>
        <View>
            <Text style={styles.brand}>DigitAI Studios Audit</Text>
            <Text style={styles.title}>Informe d'Auditoria</Text>
            <Text style={styles.subtitle}>{url}</Text>
        </View>
        <View>
            <Text style={styles.subtitle}>{date}</Text>
        </View>
      </View>

      {/* 2. PUNTUACIONS */}
      <View style={styles.scoresContainer}>
        <View style={styles.scoreItem}>
            <Text style={[styles.scoreValue, { color: getScoreColor(scores.seo) }]}>{scores.seo}</Text>
            <Text style={styles.scoreLabel}>SEO</Text>
        </View>
        <View style={styles.scoreItem}>
            <Text style={[styles.scoreValue, { color: getScoreColor(scores.perf) }]}>{scores.perf}</Text>
            <Text style={styles.scoreLabel}>Rendiment</Text>
        </View>
        <View style={styles.scoreItem}>
            <Text style={[styles.scoreValue, { color: getScoreColor(scores.a11y) }]}>{scores.a11y}</Text>
            <Text style={styles.scoreLabel}>Accessibilitat</Text>
        </View>
        <View style={styles.scoreItem}>
            <Text style={[styles.scoreValue, { color: getScoreColor(scores.best) }]}>{scores.best}</Text>
            <Text style={styles.scoreLabel}>Best Practices</Text>
        </View>
      </View>

      {/* 3. CAPTURA DE PANTALLA (Si n'hi ha) */}
      {screenshot && (
        <View style={styles.imageContainer}>
            <Text style={[styles.subtitle, { marginBottom: 10 }]}>Vista PrÃ¨via Dispositiu MÃ²bil</Text>
            <Image src={screenshot} style={styles.screenshot} />
        </View>
      )}

      {/* 4. LLISTA D'ERRORS */}
      <Text style={styles.sectionTitle}>Accions Recomanades ({issues.length})</Text>
      {issues.slice(0, 8).map((issue, index) => ( // Limitem a 8 per no fer 50 pÃ gines de cop
        <View key={index} style={styles.issueCard}>
            <Text style={styles.issueTitle}>{issue.title}</Text>
            <Text style={styles.issueDesc}>{issue.description}</Text>
        </View>
      ))}

      {/* 5. FOOTER */}
      <Text style={styles.footer}>
        Generat automÃ ticament per DigitAI Studios. Aquest informe Ã©s privat i confidencial.
        Visita'ns a https://digitaistudios.com per a mÃ©s serveis.
      </Text>

    </Page>
  </Document>
);

// =================== FILE: src/features/auth/actions/reset-password.ts ===================

// =================== FILE: src/features/auth/actions/reset-password.ts ===================

'use server'

import { z } from 'zod';
import { createClient } from '@/lib/supabase/server';
import { getLocale } from 'next-intl/server';
import { redirect } from '@/routing'; // Usem el teu routing tipat

// Esquema per solÂ·licitar el reset
const ForgotPasswordSchema = z.object({
  email: z.string().email({ message: "L'email no Ã©s vÃ lid." }),
});

// Esquema per actualitzar la contrasenya
const ResetPasswordSchema = z.object({
  password: z.string().min(6, { message: "La contrasenya ha de tenir mÃ­nim 6 carÃ cters." }),
  confirmPassword: z.string()
}).refine((data) => data.password === data.confirmPassword, {
  message: "Les contrasenyes no coincideixen",
  path: ["confirmPassword"],
});

export type AuthState = {
  message?: string;
  success?: boolean;
  errors?: Record<string, string[]>;
};

/**
 * 1. L'usuari demana restablir la contrasenya via email
 */
export async function requestPasswordReset(prevState: AuthState, formData: FormData): Promise<AuthState> {
  const email = formData.get('email') as string;
  const locale = await getLocale();

  const validated = ForgotPasswordSchema.safeParse({ email });

  if (!validated.success) {
    return { errors: validated.error.flatten().fieldErrors };
  }

  const supabase = await createClient();
  
  // Aquest URL Ã©s on anirÃ  l'usuari desprÃ©s de fer clic al correu.
  // IMPORTANT: Redirigim al callback, que intercanviarÃ  el codi per sessiÃ³,
  // i desprÃ©s el callback redirigirÃ  a /auth/reset-password
  const redirectUrl = `${process.env.NEXT_PUBLIC_BASE_URL}/${locale}/auth/callback?next=/auth/reset-password`;

  const { error } = await supabase.auth.resetPasswordForEmail(email, {
    redirectTo: redirectUrl,
  });

  if (error) {
    // Per seguretat, a vegades Ã©s millor no dir si l'email existeix o no, 
    // perÃ² per UX aquÃ­ mostrem l'error si Ã©s genÃ¨ric.
    return { message: error.message, success: false };
  }

  return { 
    success: true, 
    message: "Si l'email existeix, rebrÃ s un enllaÃ§ per restablir la contrasenya." 
  };
}

/**
 * 2. L'usuari (ja autenticat via link mÃ gic) posa la nova contrasenya
 */
export async function updatePassword(prevState: AuthState, formData: FormData): Promise<AuthState> {
  const password = formData.get('password') as string;
  const confirmPassword = formData.get('confirmPassword') as string;

  const validated = ResetPasswordSchema.safeParse({ password, confirmPassword });

  if (!validated.success) {
    return { errors: validated.error.flatten().fieldErrors };
  }

  const supabase = await createClient();

  const { error } = await supabase.auth.updateUser({
    password: validated.data.password
  });

  if (error) {
    return { message: "Error actualitzant la contrasenya.", success: false };
  }

  // Si tot va bÃ©, redirigim al dashboard
  const locale = await getLocale();
  redirect({ href: '/dashboard', locale });
  return { success: true }; // Codi mort per la redirecciÃ³, perÃ² necessari per TS
}

// =================== FILE: src/features/auth/ui/ForgotPasswordForm.tsx ===================

// =================== FILE: src/features/auth/ui/ForgotPasswordForm.tsx ===================

'use client'

import { useActionState } from 'react';
import { useTranslations } from 'next-intl';
import { requestPasswordReset } from '../actions/reset-password';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent } from '@/components/ui/card';
import { Loader2, CheckCircle2 } from 'lucide-react';

export function ForgotPasswordForm() {
  const t = useTranslations('Auth'); // Assegura't de tenir les traduccions
  
  const [state, action, isPending] = useActionState(requestPasswordReset, {
    message: '',
    errors: {}
  });

  if (state.success) {
    return (
      <Card className="border-green-200 bg-green-50">
        <CardContent className="pt-6 text-center space-y-4">
          <CheckCircle2 className="w-12 h-12 text-green-600 mx-auto" />
          <p className="text-green-800 font-medium">{state.message}</p>
          <p className="text-sm text-green-700">Revisa la teva safata d'entrada.</p>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardContent className="pt-6">
        <form action={action} className="space-y-4">
          <div className="space-y-2">
            <label htmlFor="email" className="text-sm font-medium">Email</label>
            <Input 
              id="email" 
              name="email" 
              type="email" 
              placeholder="tu@exemple.com"
              className={state.errors?.email ? "border-red-500" : ""}
            />
            {state.errors?.email && (
              <p className="text-sm text-red-500">{state.errors.email[0]}</p>
            )}
          </div>

          {state.message && !state.success && (
            <p className="text-sm text-red-500 text-center bg-red-50 p-2 rounded">{state.message}</p>
          )}

          <Button type="submit" className="w-full" disabled={isPending}>
            {isPending ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : "Enviar enllaÃ§ de recuperaciÃ³"}
          </Button>
        </form>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/auth/ui/LoginForm.tsx ===================

'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { createClient } from '@/lib/supabase/client';
import { Loader2, LogIn, Github } from 'lucide-react';
import { useRouter } from '@/routing'; // Import del teu routing i18n
import Link from 'next/link';

export function LoginForm() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();
  const supabase = createClient();

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      setError(error.message);
      setIsLoading(false);
    } else {
      router.refresh();
      router.push('/dashboard');
    }
  };

  const handleOAuth = async (provider: 'github' | 'google') => {
    // Simplement mostrem el missatge i parem
    setError("ğŸš§ El login social estÃ  en manteniment. Utilitza el teu email i contrasenya.");
    return;
  };

  return (
    <div className="w-full max-w-md mx-auto space-y-6">
      <div className="text-center space-y-2">
        <h1 className="text-3xl font-bold text-foreground">Benvingut de nou</h1>
        <p className="text-muted-foreground">Entra al teu panell de control digital.</p>
      </div>

      {/* Social Login */}
      <div className="grid grid-cols-1 gap-4">
        <Button variant="outline" onClick={() => handleOAuth('github')} className="w-full h-12 border-border bg-card hover:bg-muted text-foreground gap-2">
          <Github className="w-5 h-5" /> Continuar amb GitHub
        </Button>
        {/* Pots afegir Google aquÃ­ */}
      </div>

      <div className="relative">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t border-border" />
        </div>
        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-background px-2 text-muted-foreground">O amb email</span>
        </div>
      </div>

      <form onSubmit={handleLogin} className="space-y-4">
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground ml-1">Email</label>
          <Input
            type="email"
            placeholder="nom@empresa.com"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="bg-card border-border text-foreground h-12 focus:border-primary"
            required
          />
        </div>
        <div className="space-y-2">
          <div className="flex justify-between">
            <label className="text-sm font-medium text-foreground ml-1">Contrasenya</label>
            <Link href="/auth/forgot-password" className="text-sm text-primary hover:underline">
              Has oblidat la contrasenya?
            </Link>
          </div>
          <Input
            type="password"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="bg-card border-border text-foreground h-12 focus:border-primary"
            required
          />
        </div>

        {error && (
          <div className="p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-500 text-sm text-center">
            {error}
          </div>
        )}

        <Button type="submit" disabled={isLoading} className="w-full h-12 gradient-bg text-white font-bold rounded-lg hover:opacity-90 transition-all shadow-lg shadow-primary/20">
          {isLoading ? <Loader2 className="animate-spin" /> : <><LogIn className="w-4 h-4 mr-2" /> Entrar</>}
        </Button>
      </form>

      <p className="text-center text-sm text-muted-foreground">
        Encara no tens compte?{' '}
        <Link href="/auth/register" className="text-primary hover:underline font-medium">
          Registra't gratis
        </Link>
      </p>
    </div>
  );
}

// =================== FILE: src/features/auth/ui/RegisterForm.tsx ===================

'use client';

import { useState } from 'react';
import { useTranslations } from 'next-intl';
import { useRouter, Link } from '@/routing';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Checkbox } from '@/components/ui/checkbox';
import { createClient } from '@/lib/supabase/client';
import { Loader2, UserPlus, Github, Info } from 'lucide-react';

export function RegisterForm({ prefilledEmail }: { prefilledEmail: string }) {
  const t = useTranslations('Auth');
  const router = useRouter();

  const [isLoading, setIsLoading] = useState(false);
  const [email, setEmail] = useState(prefilledEmail);
  const [password, setPassword] = useState('');
  const [fullName, setFullName] = useState('');

  // Estat del Checkbox
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // ValidaciÃ³ Checkbox
    if (!termsAccepted) {
      setError("Has d'acceptar la polÃ­tica de privacitat per crear el compte.");
      return;
    }

    setIsLoading(true);
    setError(null);

    const supabase = createClient();

    // 1. Registre a Supabase Auth
    const { error: authError } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: fullName,
        }
      }
    });

    if (authError) {
      setError(authError.message);
      setIsLoading(false);
      return;
    }

    // RedirecciÃ³ si tot va bÃ©
    router.refresh();
    router.push('/dashboard');
  };

  const handleOAuth = async (provider: 'github') => {
    // OpciÃ³ A: Si vols que sigui un error vermell
    setError("ğŸš§ El registre amb GitHub estÃ  en construcciÃ³. Si us plau, utilitza l'email.");

    // OpciÃ³ B (Millor): Si tens 'useToast', pots fer un toast informatiu
    // toast({ title: "En construcciÃ³", description: "Aviat podrÃ s entrar amb GitHub!" });

    // No fem res mÃ©s (no cridem a Supabase)
    return;
  };

  return (
    <div className="w-full max-w-md mx-auto space-y-6">
      <div className="text-center space-y-2">
        <h1 className="text-3xl font-bold text-foreground">{t('register_title', { defaultMessage: "Crea el teu compte" })}</h1>
        <p className="text-muted-foreground">{t('register_subtitle', { defaultMessage: "ComenÃ§a a automatitzar el teu negoci avui." })}</p>
      </div>

      {/* Social Register */}
      <div className="grid grid-cols-1 gap-4">
        <Button
          variant="outline"
          onClick={() => handleOAuth('github')}
          className="w-full h-12 border-border bg-card hover:bg-muted text-foreground gap-2"
        >
          <Github className="w-5 h-5" /> Registre amb GitHub
        </Button>
      </div>

      <div className="relative">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t border-border" />
        </div>
        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-background px-2 text-muted-foreground">O amb email</span>
        </div>
      </div>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground ml-1">Nom Complet</label>
          <Input
            id="fullName"
            type="text"
            placeholder="Joan Garcia"
            value={fullName}
            onChange={(e) => setFullName(e.target.value)}
            className="bg-card border-border text-foreground h-12 focus:border-primary"
            required
          />
        </div>

        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground ml-1">Email</label>
          <Input
            id="email"
            type="email"
            placeholder="nom@empresa.com"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="bg-card border-border text-foreground h-12 focus:border-primary"
            required
          />
        </div>

        <div className="space-y-2">
          <label className="text-sm font-medium text-foreground ml-1">Contrasenya</label>
          <Input
            id="password"
            type="password"
            placeholder="Crear contrasenya"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="bg-card border-border text-foreground h-12 focus:border-primary"
            required
            minLength={6}
          />
        </div>

        {/* Checkbox Legal */}
        <div className="flex items-start space-x-3 pt-2">
          <Checkbox
            id="privacy"
            checked={termsAccepted}
            onCheckedChange={(checked) => {
              setTermsAccepted(checked as boolean);
              if (checked) setError(null); // Netegem l'error visual si l'usuari marca la casella
            }}
            className="mt-1 border-muted-foreground/30 data-[state=checked]:bg-primary data-[state=checked]:border-primary"
          />
          <div className="grid gap-1.5 leading-none">
            <label
              htmlFor="privacy"
              className="text-sm text-muted-foreground leading-snug cursor-pointer select-none"
            >
              He llegit i accepto la <Link href="/legal/privacitat" target="_blank" className="underline hover:text-primary transition-colors">polÃ­tica de privacitat</Link> i les <Link href="/legal/avis-legal" target="_blank" className="underline hover:text-primary transition-colors">condicions d'Ãºs</Link>.
            </label>
          </div>
        </div>

        {error && (
          <div className="p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-500 text-sm flex items-center gap-2 animate-in fade-in slide-in-from-top-2">
            <Info className="w-4 h-4 shrink-0" />
            <span>{error}</span>
          </div>
        )}

        <Button
          type="submit"
          disabled={isLoading}
          className={`w-full h-12 font-bold rounded-lg transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2 ${termsAccepted
              ? 'gradient-bg text-white hover:opacity-90'
              : 'bg-muted text-muted-foreground cursor-not-allowed opacity-70'
            }`}
        >
          {isLoading ? <Loader2 className="animate-spin" /> : <><UserPlus className="w-4 h-4" /> Crear Compte</>}
        </Button>
      </form>

      <p className="text-center text-sm text-muted-foreground">
        {t('already_have_account', { defaultMessage: "Ja tens compte?" })}{' '}
        <Link href="/auth/login" className="text-primary hover:underline font-medium">
          {t('login_link', { defaultMessage: "Inicia sessiÃ³" })}
        </Link>
      </p>
    </div>
  );
}

// =================== FILE: src/features/auth/ui/ResetPasswordForm.tsx ===================

// =================== FILE: src/features/auth/ui/ResetPasswordForm.tsx ===================

'use client'

import { useActionState } from 'react';
import { updatePassword } from '../actions/reset-password';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent } from '@/components/ui/card';
import { Loader2 } from 'lucide-react';

export function ResetPasswordForm() {
  const [state, action, isPending] = useActionState(updatePassword, {
    message: '',
    errors: {}
  });

  return (
    <Card>
      <CardContent className="pt-6">
        <form action={action} className="space-y-4">
          <div className="space-y-2">
            <label htmlFor="password" className="text-sm font-medium">Nova Contrasenya</label>
            <Input 
              id="password" 
              name="password" 
              type="password" 
              className={state.errors?.password ? "border-red-500" : ""}
            />
            {state.errors?.password && (
              <p className="text-sm text-red-500">{state.errors.password[0]}</p>
            )}
          </div>

          <div className="space-y-2">
            <label htmlFor="confirmPassword" className="text-sm font-medium">Confirmar Contrasenya</label>
            <Input 
              id="confirmPassword" 
              name="confirmPassword" 
              type="password" 
              className={state.errors?.confirmPassword ? "border-red-500" : ""}
            />
            {state.errors?.confirmPassword && (
              <p className="text-sm text-red-500">{state.errors.confirmPassword[0]}</p>
            )}
          </div>

          {state.message && (
            <p className="text-sm text-red-500 text-center">{state.message}</p>
          )}

          <Button type="submit" className="w-full" disabled={isPending}>
            {isPending ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : "Guardar nova contrasenya"}
          </Button>
        </form>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/blog/types.ts ===================

export type BlogPost = {
  slug: string;
  title: string;
  date: string;
  description: string;
  content: string; // El cos en Markdown
  tags: string[];
};

// =================== FILE: src/features/blog/ui/MDXContent.tsx ===================

import { MDXRemote } from 'next-mdx-remote/rsc';
import { Button } from '@/components/ui/button';
import React, { ComponentPropsWithoutRef } from 'react';
import { CheckCircle2 } from 'lucide-react';
import remarkGfm from 'remark-gfm'; // ğŸ‘ˆ 1. IMPORTA EL PLUGIN
// Tipus per als components HTML estÃ ndard
type HeadingProps = ComponentPropsWithoutRef<'h1'>;
type ParagraphProps = ComponentPropsWithoutRef<'p'>;
type ListProps = ComponentPropsWithoutRef<'ul'>;
type CalloutProps = { children: React.ReactNode };
// Tipus per a taules
type TableProps = ComponentPropsWithoutRef<'table'>;
type ThProps = ComponentPropsWithoutRef<'th'>;
type TdProps = ComponentPropsWithoutRef<'td'>;

// Component de VÃ­deo (YouTube)
const Video = ({ id }: { id: string }) => (
  <div className="my-12 rounded-xl overflow-hidden shadow-2xl ring-1 ring-slate-900/10 aspect-video bg-slate-900 mx-auto w-full">
    <iframe
      className="w-full h-full"
      src={`https://www.youtube.com/embed/${id}`}
      title="YouTube video player"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowFullScreen
    />
  </div>
);

const components = {
  // ENCAPÃ‡ALAMENTS: Usem 'text-foreground' per adaptar-se perfectament (Negre/Blanc)
  h1: (props: HeadingProps) => (
    <h1 {...props} className="text-3xl md:text-5xl font-extrabold mt-12 mb-6 text-foreground tracking-tight leading-tight" />
  ),
  h2: (props: HeadingProps) => (
    <h2 {...props} className="text-2xl md:text-3xl font-bold mt-12 mb-6 text-foreground border-b border-border/50 pb-2" />
  ),
  h3: (props: HeadingProps) => (
    <h3 {...props} className="text-xl md:text-2xl font-bold mt-8 mb-4 text-foreground" />
  ),

  // PARÃ€GRAFS: CORRECCIÃ“ DE CONTRAST
  // Light: text-slate-900 (Negre intens per llegibilitat)
  // Dark: text-slate-200 (Blanc suau per no cremar els ulls)
  p: (props: ParagraphProps) => (
    <p {...props} className="text-xl leading-8 text-slate-900 dark:text-slate-500 mb-8 font-sans" />
  ),

  // ELEMENTS INLINE
  strong: (props: ComponentPropsWithoutRef<'strong'>) => <strong {...props} className="font-bold text-foreground" />,
  a: (props: ComponentPropsWithoutRef<'a'>) => <a {...props} className="text-primary underline underline-offset-4 hover:text-primary/80 font-medium transition-colors" />,

  // LLISTES
  ul: (props: ListProps) => (
    <ul {...props} className="list-disc list-outside ml-6 space-y-3 mb-8 text-xl text-slate-900 dark:text-slate-500" />
  ),
  li: (props: ComponentPropsWithoutRef<'li'>) => <li {...props} className="pl-2" />,

  // CITES (Blockquote)
  blockquote: (props: ComponentPropsWithoutRef<'blockquote'>) => (
    <blockquote {...props} className="border-l-4 border-primary pl-6 py-4 my-10 italic text-2xl text-slate-800 dark:text-slate-100 bg-muted/30 rounded-r-lg" />


  ),
  // âœ¨ ESTILS DE TAULA (NOU)
  table: (props: TableProps) => (
    <div className="my-12 w-full overflow-x-auto rounded-xl border border-border shadow-sm">
      <table {...props} className="w-full text-left text-sm" />
    </div>
  ),
  thead: (props: ComponentPropsWithoutRef<'thead'>) => (
    <thead {...props} className="bg-muted/50 text-foreground border-b border-border" />
  ),
  tbody: (props: ComponentPropsWithoutRef<'tbody'>) => (
    <tbody {...props} className="divide-y divide-border bg-card" />
  ),
  tr: (props: ComponentPropsWithoutRef<'tr'>) => (
    <tr {...props} className="transition-colors hover:bg-muted/20" />
  ),
  th: (props: ThProps) => (
    <th {...props} className="px-6 py-4 font-bold text-foreground uppercase tracking-wider text-xs align-middle" />
  ),
  td: (props: TdProps) => (
    <td {...props} className="px-6 py-4 text-slate-600 dark:text-slate-300 align-middle leading-relaxed" />
  ),

  // COMPONENTS PERSONALITZATS (Botons i Callouts)
  Button: (props: React.ComponentProps<typeof Button>) => (
    <div className="my-12 flex justify-center">
      <Button size="lg" className="px-8 py-6 text-lg shadow-lg hover:scale-105 transition-transform" {...props} />
    </div>
  ),

  Callout: ({ children }: CalloutProps) => (
    <div className="flex gap-4 bg-primary/5 border border-primary/20 text-foreground p-6 my-10 rounded-xl shadow-sm">
      <div className="shrink-0 mt-1">
        <CheckCircle2 className="h-6 w-6 text-primary" />
      </div>
      <div className="text-lg leading-relaxed text-slate-900 dark:text-slate-100">
        {children}
      </div>
    </div>
  ),

  Video,
};

export function MDXContent({ source }: { source: string }) {
  if (!source) return null;

  return (
    <article className="max-w-none w-full">
      <MDXRemote 
        source={source} 
        components={components} 
        // ğŸ‘‡ 2. AFEGEIX AQUESTA CONFIGURACIÃ“
        options={{
          mdxOptions: {
            remarkPlugins: [remarkGfm],
          },
        }}
      />
    </article>
  );
}

// =================== FILE: src/features/email/templates/AuditReadyEmail.tsx ===================

import * as React from 'react';
import {
  Body,
  Container,
  Head,
  Heading,
  Html,
  Preview,
  Section,
  Text,
  Button,
  Hr,
  Row,
  Column,
} from '@react-email/components';

interface AuditReadyEmailProps {
  url: string;
  seoScore: number;
  perfScore: number;
  auditId: string;
}

// Estils base (Els correus necessiten estils en lÃ­nia antics)
const main = {
  backgroundColor: '#f6f9fc',
  fontFamily: '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif',
};

const container = {
  backgroundColor: '#ffffff',
  margin: '0 auto',
  padding: '20px 0 48px',
  marginBottom: '64px',
  borderRadius: '8px',
  boxShadow: '0 4px 12px rgba(0,0,0,0.05)',
};

const box = {
  padding: '0 48px',
};

const hr = {
  borderColor: '#e6ebf1',
  margin: '20px 0',
};

const scoreBox = {
  textAlign: 'center' as const,
  padding: '20px',
  borderRadius: '8px',
  backgroundColor: '#f0fdf4', // Verd molt suau
  border: '1px solid #bbf7d0',
};

const scoreNumber = {
  fontSize: '32px',
  fontWeight: 'bold',
  color: '#15803d', // Verd fort
  margin: '0',
};

const scoreLabel = {
  color: '#64748b',
  fontSize: '12px',
  textTransform: 'uppercase' as const,
  letterSpacing: '1px',
  marginTop: '8px',
};

const button = {
  backgroundColor: '#7c3aed', // El teu lila de marca (primary)
  borderRadius: '5px',
  color: '#fff',
  fontSize: '16px',
  fontWeight: 'bold',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'block',
  width: '100%',
  padding: '12px',
  marginTop: '20px',
};

export const AuditReadyEmail = ({
  url,
  seoScore,
  perfScore,
  auditId,
}: AuditReadyEmailProps) => (
  <Html>
    <Head />
    <Preview>L'informe de {url} ja estÃ  llest - DigitAI Studios</Preview>
    <Body style={main}>
      <Container style={container}>
        <Section style={box}>
          <Heading as="h2" style={{ color: '#1e293b', textAlign: 'center' }}>
            DigitAI Studios
          </Heading>
          <Hr style={hr} />
          
          <Text style={{ fontSize: '16px', lineHeight: '24px', color: '#334155' }}>
            Hola! ğŸ‘‹
          </Text>
          <Text style={{ fontSize: '16px', lineHeight: '24px', color: '#334155' }}>
            La nostra IntelÂ·ligÃ¨ncia Artificial ha acabat d'analitzar la teva web <strong>{url}</strong>. AquÃ­ tens un resum rÃ pid dels resultats:
          </Text>

          {/* GRID DE PUNTUACIONS */}
          <Section style={{ marginTop: '24px', marginBottom: '24px' }}>
            <Row>
              <Column>
                <div style={scoreBox}>
                    <p style={scoreNumber}>{seoScore}/100</p>
                    <p style={scoreLabel}>SEO</p>
                </div>
              </Column>
              <Column style={{ width: '20px' }} />
              <Column>
                <div style={{ ...scoreBox, backgroundColor: '#eff6ff', borderColor: '#bfdbfe' }}>
                    <p style={{ ...scoreNumber, color: '#1d4ed8' }}>{perfScore}/100</p>
                    <p style={scoreLabel}>Rendiment</p>
                </div>
              </Column>
            </Row>
          </Section>

          <Text style={{ fontSize: '16px', lineHeight: '24px', color: '#334155' }}>
            Hem detectat algunes Ã rees de millora crÃ­tiques que podrien estar afectant les teves vendes.
          </Text>

          <Button 
            style={button} 
            href={`https://la-teva-web.com/dashboard/audits/${auditId}`}
          >
            Veure Informe Complet
          </Button>
          
          <Hr style={hr} />
          <Text style={{ fontSize: '12px', color: '#94a3b8', textAlign: 'center' }}>
            Â© 2024 DigitAI Studios. AutomatitzaciÃ³ i IA per a empreses.
          </Text>
        </Section>
      </Container>
    </Body>
  </Html>
);

export default AuditReadyEmail;

// =================== FILE: src/features/projects/data/projects-data.ts ===================

import { StaticImageData } from 'next/image';
// Importa les teves imatges reals aquÃ­
import ribotFlowImg from '@/assets/images/pantalla-ribotflow.jpg'; 
import salutFlowImg from '@/assets/images/pantalla-salutflow.jpg';

export interface Project {
  id: string;
  title: string;
  tagline: string;
  description: string;
  stats: string[];
  tags: string[];
  color: string;
  image: StaticImageData | null;
  link: string;
}

export const PROJECTS: Project[] = [
  {
    id: 'ribotflow',
    title: 'RibotFlow',
    tagline: 'El Sistema Operatiu Integral',
    description: 'Plataforma de gestiÃ³ "Tot en Un" que unifica CRM, facturaciÃ³ i xarxes socials. Elimina el caos de tenir la informaciÃ³ dispersa i utilitza IA per redactar correus i gestionar oportunitats.',
    stats: ['CRM + FacturaciÃ³', 'AutomatitzaciÃ³ IA', 'Control Financer'],
    tags: ['ERP', 'Business', 'IA', 'Supabase'],
    color: 'from-purple-500 to-pink-500',
    image: ribotFlowImg, 
    link: 'https://ribotflow.com'
  },
  {
    id: 'salutflow',
    title: 'SalutFlow',
    tagline: 'El teu Centre Esportiu, Digitalitzat',
    description: 'Crea la teva prÃ²pia App Web (PWA) en minuts sense programar. Gestiona reserves, pagaments recurrents (Stripe) i aforaments automÃ ticament. Ideal per gimnasos i estudis.',
    stats: ['App PWA', 'Pagaments Stripe', 'Llistes d\'Espera'],
    tags: ['SaaS', 'Sport', 'PWA', 'Stripe'],
    color: 'from-cyan-400 to-blue-600',
    image: salutFlowImg,
    link: 'https://getsalutflow.com'
  }
];

// =================== FILE: src/features/projects/index.ts ===================

// Exportem nomÃ©s el que volem que la resta de l'app pugui utilitzar
export * from './ui/ProjectsHero';
export * from './ui/ProjectList';
export * from './ui/ProjectsCTA';
export * from './data/projects-data'; // Opcional, si necessites els tipus a fora

// =================== FILE: src/features/projects/ui/ProjectCard.tsx ===================

'use client';

import Image from 'next/image';
import { motion } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { ExternalLink, Layers } from 'lucide-react';
import type { Project } from '../data/projects-data';

interface Props {
    project: Project;
    index: number;
}

export function ProjectCard({ project, index }: Props) {
    const isReversed = index % 2 !== 0;

    return (
        <div className={`flex flex-col lg:flex-row gap-8 md:gap-16 items-center ${isReversed ? 'lg:flex-row-reverse' : ''}`}>

            {/* --- COLUMNA VISUAL (Mockup) --- */}
            <motion.div
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.8 }}
                className="w-full lg:flex-1 relative group"
            >
                {/* Glow */}
                <div className={`absolute inset-0 bg-linear-to-r ${project.color} opacity-20 blur-[60px] group-hover:opacity-30 transition-opacity duration-500 pointer-events-none`}></div>

                {/* Marc Navegador */}
                <div className="relative rounded-xl border border-border bg-card shadow-2xl overflow-hidden transform transition-transform duration-500 group-hover:scale-[1.02] md:group-hover:-translate-y-2">
                    <div className="h-6 md:h-8 border-b border-border bg-muted/30 flex items-center px-3 gap-1.5 md:gap-2">
                        <div className="w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500/50"></div>
                        <div className="w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-yellow-500/50"></div>
                        <div className="w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-green-500/50"></div>
                        <div className="ml-2 md:ml-4 px-2 py-0.5 rounded bg-background/50 text-[8px] md:text-[10px] text-muted-foreground font-mono border border-border w-full max-w-[150px] md:max-w-[200px] opacity-50 truncate">
                            https://{project.id}.com
                        </div>
                    </div>

                    {/* Imatge */}
                    <div className="aspect-4/3 md:aspect-video relative bg-muted/20 overflow-hidden group-hover:shadow-inner transition-all">
                        {project.image ? (
                            <Image
                                src={project.image}
                                alt={project.title}
                                fill
                                // Canviem a 'object-top' per defecte (per webs), perÃ² si sÃ³n apps, potser millor 'object-center'
                                className="object-cover object-top transition-transform duration-700 group-hover:scale-105"
                                sizes="(max-width: 768px) 100vw, 50vw"
                                placeholder="blur"
                            />
                        ) : (
                            <div className="absolute inset-0 flex flex-col items-center justify-center text-muted-foreground/30">
                                <Layers className="w-12 h-12 md:w-16 md:h-16 mb-4" />
                                <span className="text-xs md:text-sm font-bold uppercase tracking-widest">Captura de {project.title}</span>
                            </div>
                        )}
                    </div>
                </div>
            </motion.div>

            {/* --- COLUMNA TEXT --- */}
            <motion.div
                initial={{ opacity: 0, y: 30 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.8, delay: 0.2 }}
                className="w-full lg:flex-1 space-y-6 md:space-y-8"
            >
                <div>
                    <div className={`inline-block px-3 py-1 rounded-lg bg-linear-to-r ${project.color} bg-opacity-10 text-[10px] md:text-xs font-bold text-white mb-4 shadow-sm`}>
                        {project.tags[0]}
                    </div>
                    <h2 className="text-3xl md:text-4xl font-bold text-foreground mb-2">{project.title}</h2>
                    <p className={`text-lg md:text-xl font-medium bg-linear-to-r ${project.color} bg-clip-text text-transparent`}>
                        {project.tagline}
                    </p>
                </div>

                <p className="text-base md:text-lg text-muted-foreground leading-relaxed">
                    {project.description}
                </p>

                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                    {project.stats.map((stat, i) => (
                        <div key={i} className="flex items-center gap-3 text-sm text-foreground font-medium">
                            <div className={`w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-linear-to-r ${project.color}`}></div>
                            {stat}
                        </div>
                    ))}
                </div>

                <div className="flex flex-wrap gap-2 pt-2">
                    {project.tags.map((tag) => (
                        <span key={tag} className="px-2.5 py-0.5 md:px-3 md:py-1 rounded-full border border-border bg-muted/20 text-[10px] md:text-xs font-medium text-muted-foreground">
                            {tag}
                        </span>
                    ))}
                </div>

                <div className="flex gap-4 pt-4">
                    <a href={project.link} target="_blank" rel="noreferrer" className="w-full sm:w-auto">
                        <Button className="w-full sm:w-auto gradient-bg text-white border-0 shadow-lg hover:opacity-90 transition-transform hover:-translate-y-1">
                            Veure Web <ExternalLink className="ml-2 w-4 h-4" />
                        </Button>
                    </a>
                </div>
            </motion.div>

        </div>
    );
}

// =================== FILE: src/features/projects/ui/ProjectList.tsx ===================

import { PROJECTS } from '../data/projects-data';
import { ProjectCard } from './ProjectCard';

export function ProjectsList() {
  return (
    <section className="py-10 pb-20 md:pb-32">
      <div className="container mx-auto px-4 space-y-20 md:space-y-32">
         {PROJECTS.map((project, index) => (
            <ProjectCard key={project.id} project={project} index={index} />
         ))}
      </div>
    </section>
  );
}

// =================== FILE: src/features/projects/ui/ProjectsCTA.tsx ===================

'use client';

import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { ArrowRight } from 'lucide-react';

export function ProjectsCTA() {
  return (
    <section className="py-16 md:py-24 border-t border-border bg-muted/10">
       <div className="container mx-auto px-4 text-center">
          <h2 className="text-2xl md:text-3xl font-bold text-foreground mb-4 md:mb-6">
             Tens una idea per al prÃ²xim <span className="gradient-text">Gran Producte</span>?
          </h2>
          <p className="text-sm md:text-base text-muted-foreground mb-8 md:mb-10 max-w-xl mx-auto px-4">
             Hem convertit les nostres idees en negocis rendibles. Ara deixa que t'ajudem a fer el mateix amb la teva.
          </p>
          <Link href="/#contacte">
             <Button size="lg" className="h-12 md:h-14 px-6 md:px-8 text-base md:text-lg rounded-full gradient-bg text-white hover:opacity-90 shadow-xl w-full sm:w-auto transition-transform hover:scale-105">
                Parlem del teu Projecte <ArrowRight className="ml-2 w-5 h-5" />
             </Button>
          </Link>
       </div>
    </section>
  );
}

// =================== FILE: src/features/projects/ui/ProjectsHero.tsx ===================

'use client';

import { motion } from 'framer-motion';
import { Sparkles } from 'lucide-react';

export function ProjectsHero() {
  return (
    <section className="pt-32 pb-16 md:pt-48 md:pb-24 relative overflow-hidden">
      {/* Fons decoratiu */}
      <div className="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] md:w-[1000px] h-[300px] md:h-[500px] bg-primary/10 blur-[80px] md:blur-[120px] rounded-full pointer-events-none opacity-50" />
      
      <div className="container mx-auto px-4 text-center relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
        >
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-primary/20 bg-primary/5 text-primary text-[10px] md:text-xs font-bold mb-6 uppercase tracking-widest">
            <Sparkles className="w-3 h-3" />
            DigitAI Innovation Lab
          </div>
          <h1 className="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 text-foreground leading-tight">
            No nomÃ©s venem codi. <br className="hidden md:block" />
            <span className="gradient-text">ConstruÃ¯m Empreses.</span>
          </h1>
          <p className="text-base md:text-xl text-muted-foreground max-w-2xl mx-auto leading-relaxed px-4">
            Aquests sÃ³n els nostres productes propis. Utilitzem la mateixa tecnologia i metodologia per als teus projectes que la que fem servir per escalar els nostres negocis.
          </p>
        </motion.div>
      </div>
    </section>
  );
}

// =================== FILE: src/i18n/request.ts ===================

import { getRequestConfig } from 'next-intl/server';
import { notFound } from 'next/navigation';
import { routing, type Locale } from '@/routing'; // ğŸ‘ˆ IMPORTEM DE LA FONT ÃšNICA

export default getRequestConfig(async ({ requestLocale }) => {
  const locale = await requestLocale;

  // Ara validem contra la configuraciÃ³ centralitzada
  // AixÃ­ no hem de mantenir dues llistes d'idiomes
  if (!locale || !routing.locales.includes(locale as Locale)) {
    notFound();
  }

  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});

// =================== FILE: src/lib/audit-dictionary.ts ===================

// src/lib/audit-dictionary.ts

export const AUDIT_TRANSLATIONS: Record<string, { title: string; description: string }> = {
  'is-on-https': {
    title: 'El lloc web no utilitza HTTPS segur',
    description: 'La teva web no Ã©s segura. AixÃ² espanta els clients i Google et penalitza greument.'
  },
  'meta-description': {
    title: 'Manca la Meta DescripciÃ³',
    description: 'Google no sap de quÃ¨ tracta la teva web. Necessites un resum atractiu per aparÃ¨ixer als resultats de cerca.'
  },
  'document-title': {
    title: 'La pÃ gina no tÃ© tÃ­tol',
    description: 'El tÃ­tol Ã©s l\'element mÃ©s important per al SEO. Sense ell, Ã©s invisible.'
  },
  'image-alt': {
    title: 'Imatges sense text alternatiu',
    description: 'Les imatges necessiten una descripciÃ³ perquÃ¨ Google les pugui "veure" i indexar.'
  },
  'viewport': {
    title: 'No estÃ  adaptada a mÃ²bils',
    description: 'La web no tÃ© l\'etiqueta viewport correcta, fent que es vegi malament en dispositius mÃ²bils.'
  },
  'server-response-time': {
    title: 'El servidor Ã©s massa lent',
    description: 'El temps de resposta inicial Ã©s alt. Considera canviar de hosting o optimitzar el backend.'
  },
  'render-blocking-resources': {
    title: 'Recursos que bloquegen la visualitzaciÃ³',
    description: 'Hi ha CSS o JS que impedeixen que la web es mostri rÃ pidament. S\'han de diferir.'
  },
  'unminified-css': {
    title: 'CSS no optimitzat',
    description: 'Els fitxers d\'estil sÃ³n massa grans. Minificar-los milloraria la velocitat.'
  },
  'unminified-javascript': {
    title: 'JavaScript no optimitzat',
    description: 'El codi script Ã©s massa pesat. Cal comprimir-lo per accelerar la cÃ rrega.'
  },
  'uses-optimized-images': {
    title: 'Imatges massa pesades',
    description: 'Les imatges no estan optimitzades. Utilitza formats moderns com WebP per estalviar dades.'
  },
  'largest-contentful-paint': {
    title: 'CÃ rrega del contingut principal (LCP) lenta',
    description: 'L\'element mÃ©s gran de la web triga massa a aparÃ¨ixer. AixÃ² frustra els usuaris.'
  },
  'cumulative-layout-shift': {
    title: 'La web es "mou" mentre carrega (CLS)',
    description: 'Els elements canvien de lloc sobtadament, causant una mala experiÃ¨ncia d\'usuari.'
  }
};

// FunciÃ³ helper per traduir
export function translateIssue(id: string, defaultTitle: string, defaultDesc: string) {
  const translation = AUDIT_TRANSLATIONS[id];
  if (translation) {
    return { ...translation };
  }
  // Si no tenim traducciÃ³, intentem netejar el text de Google (treure enllaÃ§os markdown [Learn more]...)
  return {
    title: defaultTitle,
    description: defaultDesc.split('[')[0].replace(/\.$/, '') // Neteja bÃ sica
  };
}

// =================== FILE: src/lib/auth/admin-guard.ts ===================

import { createClient } from '@/lib/supabase/server';
import { notFound, redirect } from 'next/navigation';

/**
 * Aquesta funciÃ³ actua com un tallafocs.
 * Si l'usuari no Ã©s l'Admin, atura l'execuciÃ³ i llanÃ§a un 404.
 */
export async function requireAdmin() {
  const supabase = await createClient();
  
  // 1. Obtenim l'usuari
  const { data: { user }, error } = await supabase.auth.getUser();

  // 2. Si no estÃ  loguejat -> Al login
  if (error || !user) {
    redirect('/auth/login');
  }

  // 3. VERIFICACIÃ“ MESTRA
  // Comparem l'email de l'usuari amb la variable d'entorn
  const adminEmail = process.env.ADMIN_EMAIL;

  if (!adminEmail) {
    console.error("âŒ ERROR CRÃTIC: No s'ha configurat ADMIN_EMAIL al .env");
    // Per seguretat, si no hi ha config, bloquegem tothom
    notFound(); 
  }

  if (user.email !== adminEmail) {
    console.warn(`âš ï¸ ALERTA DE SEGURETAT: L'usuari ${user.email} ha intentat accedir a l'admin.`);
    // 4. Si no Ã©s l'admin, mostrem un 404 (Not Found).
    // AixÃ­ ni tan sols saben que la pÃ gina existeix.
    notFound();
  }

  // Si arriba aquÃ­, ets tu. Benvingut, cap.
  return user;
}

// =================== FILE: src/lib/data.ts ===================

// src/lib/data.ts
import { StaticImageData } from 'next/image'; // ğŸ‘ˆ Necessari pel tipatge

import bioshopImg from '@/assets/images/testimoni-garatgeestacio.jpg';
import salutFlow from '@/assets/images/salutflow.png';

export type Testimonial = {
  id: number | string;
  name: string;
  company: string;
  text: string;
  rating: number;
  projectType: 'web' | 'app' | 'automation';
  projectUrl?: string;
  image?: string | StaticImageData;
};

export const TESTIMONIALS: Testimonial[] = [
  {
    id: 1,
    name: "Marc Vila",
    company: "Gestoria Vila",
    text: "Hem estalviat 20h setmanals grÃ cies al bot de WhatsApp.",
    rating: 5,
    projectType: 'automation'
  },
  {
    id: 2,
    name: "Anna Soler",
    company: "Garatge EstaciÃ³", // He vist el nom al fitxer jpg
    text: "La web carrega instantÃ niament. Les vendes han pujat un 40%.",
    rating: 5,
    projectType: 'web',
    projectUrl: 'https://garatgeestacio.com',
    // âœ… 3. USEM LA VARIABLE IMPORTADA
    image: bioshopImg
  },
  {
    id: 3,
    name: "Jordi P.",
    company: "Tech Solutions",
    text: "Han entÃ¨s la nostra idea d'App a la primera.",
    rating: 5,
    projectType: 'app',
    image: salutFlow
  },

  // Nous exemples per al carrousel
  {
    id: 4,
    name: "Laura M.",
    company: "ClÃ­nica Dental",
    text: "El sistema de cites prÃ¨vies ha eliminat les trucades perdudes.",
    rating: 5,
    projectType: 'web'
  },
  {
    id: 5,
    name: "Pere Roig",
    company: "LogÃ­stica RÃ pida",
    text: "L'App per als repartidors funciona fins i tot sense cobertura.",
    rating: 5,
    projectType: 'app'
  }
];

// =================== FILE: src/lib/mock-audit.ts ===================

// Dades falses per poder dissenyar la UI de l'informe
export const MOCK_REPORT = {
  scores: {
    seo: 85,
    performance: 62,
    accessibility: 90,
    best_practices: 75
  },
  issues: [
    { type: 'error', message: 'Falta l\'etiqueta H1 a la pÃ gina principal', impact: 'high' },
    { type: 'warning', message: 'Imatges sense atribut ALT detectades', impact: 'medium' },
    { type: 'success', message: 'Certificat SSL vÃ lid i actiu', impact: 'none' }
  ],
  technologies: ['Next.js', 'Tailwind CSS', 'Vercel']
};

// =================== FILE: src/lib/supabase/client.ts ===================

import { createBrowserClient } from '@supabase/ssr'
// ğŸ‘‡ Importa els tipus
import { Database } from '@/types/database.types' 

export function createClient() {
  // ğŸ‘‡ Afegeix el genÃ¨ric <Database> aquÃ­
  return createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}

// =================== FILE: src/lib/supabase/middleware.ts ===================

import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'
import { Database } from '@/types/database.types'

// ğŸ‘‡ Afegeix el genÃ¨ric <Database> aquÃ­
export async function updateSession(
  request: NextRequest, 
  response: NextResponse // âœ… Rebem la resposta del i18n
) {
  const supabase = createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            request.cookies.set(name, value)
            response.cookies.set(name, value, options)
          })
        },
      },
    }
  )

  // AixÃ² refresca el token si Ã©s necessari
  const { data: { user } } = await supabase.auth.getUser()

  // ğŸ›¡ï¸ PROTECCIÃ“ DE RUTES
  // Si intenta accedir a /dashboard sense usuari -> Login
  if (request.nextUrl.pathname.includes('/dashboard') && !user) {
    // Detectem el locale actual de la URL per redirigir al login correcte
    const locale = request.nextUrl.pathname.split('/')[1] || 'ca';
    const loginUrl = request.nextUrl.clone()
    loginUrl.pathname = `/${locale}/auth/login`
    return NextResponse.redirect(loginUrl)
  }

  return response
}

// =================== FILE: src/lib/supabase/server.ts ===================

import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
// ğŸ‘‡ Importem el client bÃ sic tambÃ©
import { createClient as createSupabaseClient } from '@supabase/supabase-js'
import { Database } from '@/types/database.types'

export async function createClient() {
  const cookieStore = await cookies()

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() { return cookieStore.getAll() },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch { }
        },
      },
    }
  )
}

// ğŸ‘‡ NOVA FUNCIÃ“: Client Admin (Bypass RLS)
// Aquest client NO fa servir cookies, fa servir la clau secreta
export function createAdminClient() {
  return createSupabaseClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!, // <--- Aquesta clau Ã©s CRÃTICA
    {
      auth: {
        autoRefreshToken: false,
        persistSession: false
      }
    }
  )
}

// =================== FILE: src/lib/utils.ts ===================

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


// =================== FILE: src/proxy.ts ===================

// =================== FILE: src/proxy.ts ===================

import createMiddleware from 'next-intl/middleware';
import { routing } from '@/routing';
import { updateSession } from '@/lib/supabase/middleware';
import { NextRequest } from 'next/server';

const intlMiddleware = createMiddleware(routing);

export async function proxy(request: NextRequest) {
  const response = intlMiddleware(request);
  return await updateSession(request, response);
}

export const config = {
  matcher: [
    // ğŸ‘‡ HE AFEGIT 'webmanifest' i 'mp4' A L'EXCEPCIÃ“ DEL REGEX
    // AixÃ² diu: "Executa el middleware a tot ARREU EXCEPTE api, next, imatges, manifest i videos"
    '/((?!api|_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp|webmanifest|mp4)$).*)',
  ],
};

// =================== FILE: src/repositories/interfaces/IAnalyticsRepository.ts ===================

import { AnalyticsEventDTO } from '@/types/models';
export type StatItem = { name: string; value: number; color?: string }; // Tipus genÃ¨ric per grÃ fics
export type DailyStats = {
  date: string;
  visitors: number;
  views: number;
};

// ğŸ‘‡ NOUS TIPUS
export type PageStat = { path: string; views: number };
export type DeviceStat = { name: string; value: number; fill: string }; // 'fill' Ã©s pel color del grÃ fic
export type CountryStat = { country: string; visitors: number };

export interface IAnalyticsRepository {
  trackEvent(event: AnalyticsEventDTO): Promise<void>;
  getLast7DaysStats(): Promise<DailyStats[]>;
  // ğŸ‘‡ NOU MÃˆTODE AGREGAT
  getAdvancedStats(): Promise<{
    topPages: PageStat[];
    devices: DeviceStat[];
    countries: StatItem[]; // Ara usem StatItem (mÃ©s flexible)
    referrers: StatItem[]; // Nou
    browsers: StatItem[];  // Nou
    os: StatItem[];        // Nou
  }>;
}

// =================== FILE: src/repositories/interfaces/IAuditRepository.ts ===================

import { AuditDTO } from '@/types/models';

export interface IAuditRepository {
  getAuditsByUserEmail(email: string): Promise<AuditDTO[]>;
  getAuditById(id: string): Promise<AuditDTO | null>;
  createAudit(url: string, email: string): Promise<AuditDTO>;
  updateStatus(id: string, status: AuditDTO['status'], data?: Record<string, unknown>): Promise<void>;
  // Canvia la signatura de updateStatus per ser mÃ©s flexible o especÃ­fica
  updateStatus(
    id: string,
    status: AuditDTO['status'],
    results?: { seoScore?: number; performanceScore?: number; reportData?: unknown }
  ): Promise<void>;
  getAuditsByUserEmail(email: string): Promise<AuditDTO[]>; // Aquest ja el tenies, assegura't d'usar-lo!
  getAuditsByUserId(userId: string): Promise<AuditDTO[]>; // ğŸ‘ˆ MÃ¨tode nou

  createAuditForUser(url: string, userId: string, email: string): Promise<AuditDTO>; // ğŸ‘ˆ MÃ¨tode nou
  createPublicAudit(url: string, email: string): Promise<AuditDTO>; // ğŸ‘ˆ MÃ¨tode nou
}

// =================== FILE: src/repositories/interfaces/IPostRepository.ts ===================

import { BlogPostDTO } from '@/types/models';

export interface IPostRepository {
  getPostBySlug(slug: string): Promise<BlogPostDTO | null>;
  getAllPublishedPosts(): Promise<BlogPostDTO[]>;
}

// =================== FILE: src/repositories/supabase/SupabaseAnalyticsRepository.ts ===================

import { createClient } from '@/lib/supabase/server';
import { AnalyticsEventDTO } from '@/types/models';
import { Database } from '@/types/database.types';
import { 
  IAnalyticsRepository, 
  DailyStats, 
  PageStat, 
  DeviceStat, 

  StatItem // ğŸ‘ˆ Assegura't d'importar aquest tipus nou que vam crear
} from '../interfaces/IAnalyticsRepository';

type AnalyticsInsert = Database['public']['Tables']['analytics_events']['Insert'];

export class SupabaseAnalyticsRepository implements IAnalyticsRepository {

  async trackEvent(event: AnalyticsEventDTO): Promise<void> {
    const supabase = await createClient();

    const { error } = await supabase.from('analytics_events').insert({
      event_name: event.event_name,
      path: event.path,
      session_id: event.session_id,
      meta: event.meta as AnalyticsInsert['meta'],
      country: event.geo?.country,
      city: event.geo?.city,
      browser: event.device?.browser,
      os: event.device?.os,
      device_type: event.device?.type,
      referrer: event.referrer,
      duration_seconds: event.duration || 0
    });

    if (error) console.error("Error tracking:", error);
  }

  async getLast7DaysStats(): Promise<DailyStats[]> {
    const supabase = await createClient();

    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

    const { data, error } = await supabase
      .from('analytics_events')
      .select('created_at, session_id')
      .gte('created_at', sevenDaysAgo.toISOString())
      .order('created_at', { ascending: true });

    if (error || !data) return [];

    const statsMap = new Map<string, { views: number; sessions: Set<string> }>();

    for (let i = 6; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      const key = d.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });
      statsMap.set(key, { views: 0, sessions: new Set() });
    }

    data.forEach((row) => {
      if (row.created_at) {
        const date = new Date(row.created_at);
        const key = date.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });

        if (statsMap.has(key)) {
          const entry = statsMap.get(key)!;
          entry.views++;
          if (row.session_id) entry.sessions.add(row.session_id);
        }
      }
    });

    return Array.from(statsMap.entries()).map(([date, val]) => ({
      date,
      views: val.views,
      visitors: val.sessions.size
    }));
  }

  // ğŸ› ï¸ MÃˆTODE CORREGIT AMB TOTS ELS TIPUS DE RETORN
  async getAdvancedStats(): Promise<{
    topPages: PageStat[];
    devices: DeviceStat[];
    countries: StatItem[];
    referrers: StatItem[];
    browsers: StatItem[];
    os: StatItem[];
  }> {
    const supabase = await createClient();

    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

    // 1. Seleccionem TOTS els camps necessaris
    // IMPORTANT: Assegura't que aquests camps existeixen a la DB i als tipus generats
    // Si 'referrer' no existeix, regenera els tipus (npx supabase gen types...)
    const { data, error } = await supabase
      .from('analytics_events')
      .select('path, device_type, country, session_id, referrer, browser, os')
      .gte('created_at', thirtyDaysAgo.toISOString());

    if (error || !data) {
        return { topPages: [], devices: [], countries: [], referrers: [], browsers: [], os: [] };
    }

    // 2. Inicialitzem els Maps
    const pagesMap = new Map<string, number>();
    const devicesMap = new Map<string, number>();
    const countryMap = new Map<string, Set<string>>(); // Set per usuaris Ãºnics
    const referrerMap = new Map<string, number>();
    const browserMap = new Map<string, number>();
    const osMap = new Map<string, number>();

    // 3. Processem les dades
    data.forEach(row => {
      // Pages
      const cleanPath = row.path || '/';
      pagesMap.set(cleanPath, (pagesMap.get(cleanPath) || 0) + 1);

      // Devices
      const dev = row.device_type === 'mobile' ? 'MÃ²bil' : row.device_type === 'tablet' ? 'Tauleta' : 'PC';
      devicesMap.set(dev, (devicesMap.get(dev) || 0) + 1);

      // Countries (Set)
      const country = row.country === 'Unknown' ? 'Desconegut' : row.country;
      if (country) {
        if (!countryMap.has(country)) countryMap.set(country, new Set());
        if (row.session_id) countryMap.get(country)!.add(row.session_id);
      }

      // Referrers
      let ref = row.referrer || 'Directe';
      try {
        if (ref.startsWith('http')) ref = new URL(ref).hostname.replace('www.', '');
      } catch { }
      referrerMap.set(ref, (referrerMap.get(ref) || 0) + 1);

      // Browsers
      const browser = row.browser || 'Altres';
      browserMap.set(browser, (browserMap.get(browser) || 0) + 1);

      // OS
      const os = row.os || 'Altres';
      osMap.set(os, (osMap.get(os) || 0) + 1);
    });

    // 4. Funcions auxiliars per formatar a StatItem[]
    const toStatArray = (map: Map<string, number>, colors: string[]): StatItem[] =>
      Array.from(map.entries())
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map(([name, value], i) => ({ name, value, color: colors[i % colors.length] }));

    // 5. Generem els arrays finals
    const referrers = toStatArray(referrerMap, ['#3b82f6', '#60a5fa', '#93c5fd', '#bfdbfe', '#dbeafe']);
    const browsers = toStatArray(browserMap, ['#f59e0b', '#fbbf24', '#fcd34d', '#fde68a', '#fef3c7']);
    const os = toStatArray(osMap, ['#ec4899', '#f472b6', '#fbcfe8', '#fce7f3', '#fdf2f8']);

    const countries: StatItem[] = Array.from(countryMap.entries())
      .map(([name, set]) => ({ 
          name: name === 'Unknown' ? 'ğŸŒ Desconegut' : name, 
          value: set.size, 
          color: '#10b981' 
      }))
      .sort((a, b) => b.value - a.value)
      .slice(0, 5);

    const topPages: PageStat[] = Array.from(pagesMap.entries())
      .map(([path, views]) => ({ path, views }))
      .sort((a, b) => b.views - a.views)
      .slice(0, 15);

    const deviceColors = ['#8884d8', '#00C49F', '#FFBB28'];
    const devices: DeviceStat[] = Array.from(devicesMap.entries())
      .map(([name, value], index) => ({
        name,
        value,
        fill: deviceColors[index % deviceColors.length]
      }));

    // âœ… CORRECCIÃ“ FINAL: Retornem TOTS els camps que la interfÃ­cie espera
    return { 
        topPages, 
        devices, 
        countries, 
        referrers, 
        browsers, 
        os 
    };
  }
}

// =================== FILE: src/repositories/supabase/SupabaseAuditRepository.ts ===================

import { createClient, createAdminClient } from '@/lib/supabase/server';
import { IAuditRepository } from '../interfaces/IAuditRepository';
import { AuditDTO } from '@/types/models';
import { Database } from '@/types/database.types';

// Tipus directe de la fila de la DB
type AuditRow = Database['public']['Tables']['web_audits']['Row'];

export class SupabaseAuditRepository implements IAuditRepository {

  private mapToDTO(row: AuditRow): AuditDTO {
    return {
      id: row.id,
      url: row.url,
      status: row.status as AuditDTO['status'],
      seoScore: row.seo_score,
      performanceScore: row.performance_score,
      createdAt: row.created_at ? new Date(row.created_at) : new Date(),
      // Fem un cast segur cap a un objecte genÃ¨ric o unknown
      reportData: row.report_data as Record<string, unknown>,
    };
  }

  async getAuditsByUserEmail(email: string): Promise<AuditDTO[]> {
    const supabase = await createClient();
    const { data, error } = await supabase
      .from('web_audits')
      .select('*')
      .eq('email', email)
      .order('created_at', { ascending: false });

    if (error) throw new Error(error.message);
    return data.map(this.mapToDTO);
  }

  async getAuditById(id: string): Promise<AuditDTO | null> {
    const supabase = await createClient();
    const { data } = await supabase.from('web_audits').select('*').eq('id', id).single();
    return data ? this.mapToDTO(data) : null;
  }

  async createAudit(url: string, email: string): Promise<AuditDTO> {
    console.log(`[Repo] Creant auditoria per: ${email} - URL: ${url}`);

    const supabaseAdmin = createAdminClient();

    const { data, error } = await supabaseAdmin
      .from('web_audits')
      .insert({
        url,
        email,
        status: 'processing'
      })
      .select()
      .single();

    if (error) {
      console.error('[Repo] Error Supabase:', error);
      throw new Error(`Error creating audit: ${error.message}`);
    }

    console.log('[Repo] Auditoria creada OK:', data.id);
    return this.mapToDTO(data);
  }

  async updateStatus(
    id: string,
    status: AuditDTO['status'],
    results?: { 
      seoScore?: number; 
      performanceScore?: number; 
      reportData?: Record<string, unknown> 
    }
  ): Promise<void> {
    const supabaseAdmin = createAdminClient();

    // Utilitzem Partial<AuditRow> per assegurar que els camps coincideixen amb la DB
    // Omitim 'id' i 'created_at' perquÃ¨ no els tocarem
    const updatePayload: Partial<AuditRow> = { status };

    if (results) {
      if (results.seoScore !== undefined) updatePayload.seo_score = results.seoScore;
      if (results.performanceScore !== undefined) updatePayload.performance_score = results.performanceScore;
      
      if (results.reportData !== undefined) {
        // âœ… CORRECCIÃ“ CLAU:
        // En lloc de 'as any', fem un cast al tipus especÃ­fic que Supabase espera per aquesta columna.
        // AixÃ² satisfÃ  l'Eslint i mantÃ© la seguretat de tipus relativa a la DB.
        updatePayload.report_data = results.reportData as AuditRow['report_data'];
      }
    }

    const { error } = await supabaseAdmin
      .from('web_audits')
      .update(updatePayload)
      .eq('id', id);

    if (error) throw new Error(error.message);
  }
  async getAuditsByUserId(userId: string): Promise<AuditDTO[]> {
      const supabase = await createClient();
      const { data, error } = await supabase
        .from('web_audits')
        .select('*')
        .eq('user_id', userId) // ğŸ‘ˆ Filtrem per ID, molt mÃ©s robust
        .order('created_at', { ascending: false });
      
      if (error) throw new Error(error.message);
      return data.map(this.mapToDTO);
  }

  // CAS 1: Des del Dashboard (Tenim ID segur)
  async createAuditForUser(url: string, userId: string, email: string): Promise<AuditDTO> {
    const supabaseAdmin = createAdminClient();
    const { data, error } = await supabaseAdmin
      .from('web_audits')
      .insert({
        url,
        user_id: userId, // âœ… Clau
        email: email,
        status: 'processing'
      })
      .select()
      .single();

    if (error) throw new Error(error.message);
    return this.mapToDTO(data);
  }

  // CAS 2: Des de la Landing (NomÃ©s tenim Email)
  async createPublicAudit(url: string, email: string): Promise<AuditDTO> {
    const supabaseAdmin = createAdminClient();
    
    // Opcional: Buscar si ja existeix un usuari amb aquest email per lligar-ho?
    // Per ara, ho guardem sense user_id (o amb un user_id temporal si la taula ho requereix)
    // NOTA: Si la taula 'web_audits' tÃ© 'user_id' com NOT NULL, necessitem una estratÃ¨gia aquÃ­.
    // L'estratÃ¨gia habitual Ã©s crear un usuari "fantasma" o deixar el camp nullable.
    // Assumint que user_id pot ser null o gestionem el registre desprÃ©s.
    
    const { data, error } = await supabaseAdmin
      .from('web_audits')
      .insert({
        url,
        email: email,
        status: 'processing'
        // user_id: null (si la DB ho permet)
      })
      .select()
      .single();

    if (error) throw new Error(error.message);
    return this.mapToDTO(data);
  }
}

// =================== FILE: src/repositories/supabase/SupabasePostRepository.ts ===================

import { createClient } from '@/lib/supabase/client';
import { IPostRepository } from '@/repositories/interfaces/IPostRepository';
import { BlogPostDTO } from '@/types/models';
import { Database } from '@/types/database.types';

// Tipus directe de la fila SQL
type PostRow = Database['public']['Tables']['posts']['Row'];

export class SupabasePostRepository implements IPostRepository {
  
  // ğŸ”„ Mapper: La peÃ§a clau per traduir DB -> App
  private mapToDTO(row: PostRow): BlogPostDTO {
    return {
      slug: row.slug,
      title: row.title,
      // Preferim published_at, si no created_at
      date: row.published_at ?? row.created_at, 
      description: row.description,
      content: row.content_mdx, // AquÃ­ fem el canvi de nom
      tags: row.tags ? (row.tags as string[]) : [], // Assegurem que Ã©s array
      coverImage: row.cover_image,
      published: row.status === 'published',
      
    };
  }

  async getPostBySlug(slug: string): Promise<BlogPostDTO | null> {
    const supabase = createClient();
    
    const { data, error } = await supabase
      .from('posts')
      .select('*')
      .eq('slug', slug)
      .eq('status', 'published')
      .eq('published', true) // ğŸ‘ˆ Seguretat extra: si endevinen l'URL d'un esborrany, no es veurÃ 
      .single();

    if (error || !data) return null;

    // Fem servir el mapper
    return this.mapToDTO(data);
  }

  async getAllPublishedPosts(): Promise<BlogPostDTO[]> {
    const supabase = createClient();
    const { data } = await supabase
      .from('posts')
      .select('*') // Seleccionem tot per simplificar el tipatge, o especifica columnes
      .eq('status', 'published')
      .eq('published', true) // ğŸ‘ˆ Seguretat extra: si endevinen l'URL d'un esborrany, no es veurÃ 
      .order('published_at', { ascending: false });

    if (!data) return [];

    // Mapegem cada fila
    return data.map(this.mapToDTO);
  }
}

// =================== FILE: src/routing.ts ===================

import { defineRouting } from 'next-intl/routing';
import { createNavigation } from 'next-intl/navigation';

export const routing = defineRouting({
  locales: ['ca', 'es', 'en'],
  defaultLocale: 'ca',
  localePrefix: 'as-needed' // Opcional: per si vols /ca o no
});

// Exportem tipus per a reutilitzar
export type Locale = (typeof routing.locales)[number];

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);

// =================== FILE: src/services/AuditService.ts ===================

import { IAuditRepository } from '@/repositories/interfaces/IAuditRepository';
import { IWebScanner } from '@/adapters/IWebScanner';
import { ResendEmailService } from '@/services/email/ResendEmailService';

export class AuditService {
  constructor(
    private auditRepo: IAuditRepository,
    private scanner: IWebScanner,
    private emailService: ResendEmailService
  ) { }

  // 1. MÃ¨tode Landing (PÃºblic) - Afegim locale
  async performPublicAudit(url: string, email: string, locale: string) {
    return this.performFullAudit(url, { email }, locale);
  }

  // 2. MÃ¨tode Dashboard (Privat) - Afegim locale
  async performUserAudit(url: string, userId: string, userEmail: string, locale: string) {
    return this.performFullAudit(url, { userId, email: userEmail }, locale);
  }

  // LÃ²gica Central - Afegim locale
  private async performFullAudit(url: string, user: { userId?: string, email: string }, locale: string) {
    console.log(`ğŸš€ [AuditService] Iniciant auditoria per: ${url}`);

    let newAudit;
    if (user.userId) {
       newAudit = await this.auditRepo.createAuditForUser(url, user.userId, user.email);
    } else {
       newAudit = await this.auditRepo.createPublicAudit(url, user.email);
    }

    try {
      const scanResult = await this.scanner.scanUrl(url);
      
      await this.auditRepo.updateStatus(newAudit.id, 'completed', {
        seoScore: scanResult.seoScore,
        performanceScore: scanResult.performanceScore,
        reportData: {
            screenshot: scanResult.screenshot,
            issues: scanResult.issues,
            metrics: scanResult.metrics,
            raw: scanResult.reportData
        }
      });

      // ENVIAR EMAIL AMB LOCALE
      try {
          await this.emailService.sendAuditResult(user.email, {
            url: url,
            seo: scanResult.seoScore,
            perf: scanResult.performanceScore,
            id: newAudit.id
          }, locale); // ğŸ‘ˆ Passem l'idioma aquÃ­
      } catch (emailErr) {
          console.error("Error enviant email:", emailErr);
      }

      return newAudit.id;

    } catch (error) {
      console.error("Error audit service:", error);
      await this.auditRepo.updateStatus(newAudit.id, 'failed');
      throw error;
    }
  }
}

// =================== FILE: src/services/container.ts ===================

// 1. Importem les Classes (els plÃ nols)
import { SupabaseAuditRepository } from '@/repositories/supabase/SupabaseAuditRepository';
import { SupabasePostRepository } from '@/repositories/supabase/SupabasePostRepository';
import { SupabaseAnalyticsRepository } from '@/repositories/supabase/SupabaseAnalyticsRepository';

import { ResendEmailService } from '@/services/email/ResendEmailService';
import { AuditService } from '@/services/AuditService';
import { PostService } from '@/services/PostService';

import { GooglePageSpeedAdapter } from '@/adapters/GooglePageSpeedAdapter'; // ğŸ‘ˆ El nou adaptador
// ---------------------------------------------------------------------------
// 2. Instanciem els Repositoris (Capa de Dades)
// ---------------------------------------------------------------------------
export const auditRepository = new SupabaseAuditRepository();
export const postRepository = new SupabasePostRepository(); // ğŸ‘ˆ AquÃ­ neix la instÃ ncia
// ğŸ‘‡ Instanciem Analytics
export const analyticsRepository = new SupabaseAnalyticsRepository();
// ---------------------------------------------------------------------------
// 3. Instanciem els Adaptadors (Capa Externa)
// ---------------------------------------------------------------------------
const googleKey = process.env.GOOGLE_PAGESPEED_API_KEY || '';
const webScanner = new GooglePageSpeedAdapter(googleKey);

// ğŸ‘‡ 2. INSTANCIEM EL SERVEI D'EMAIL
export const emailService = new ResendEmailService();
// ---------------------------------------------------------------------------
// 4. Instanciem els Serveis (Capa de Negoci)
//    AquÃ­ fem la InjecciÃ³ de DependÃ¨ncies
// ---------------------------------------------------------------------------
// ğŸ‘‡ 3. ARA LI PASSEM ELS 3 ARGUMENTS QUE DEMANA
export const auditService = new AuditService(
  auditRepository,
  webScanner,
  emailService // <--- AQUEST ERA EL QUE FALTAVA
);
// El PostService necessita el postRepository per funcionar
export const postService = new PostService(postRepository);


// =================== FILE: src/services/email/ResendEmailService.ts ===================

import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

export class ResendEmailService {
  // Afegim 'locale' als arguments
  async sendAuditResult(to: string, data: { url: string, seo: number, perf: number, id: string }, locale: string) {
    try {
      // Assegurem-nos que locale tÃ© valor (per defecte 'ca')
      const lang = locale || 'ca';
      
      await resend.emails.send({
        from: 'DigitAI Studios <info@digitaistudios.com>',
        to: [to],
        subject: `Resultats de l'Auditoria: ${data.url}`,
        html: `
          <div style="font-family: sans-serif; color: #333; max-width: 600px; margin: 0 auto;">
            <h1 style="color: #6366f1;">L'informe de ${data.url} estÃ  llest</h1>
            <p>Hem analitzat la teva web i aquests sÃ³n els resultats preliminars:</p>
            <ul style="background: #f3f4f6; padding: 20px; border-radius: 10px;">
              <li style="margin-bottom: 10px;"><strong>SEO:</strong> ${data.seo}/100</li>
              <li><strong>Rendiment:</strong> ${data.perf}/100</li>
            </ul>
            <p style="margin-top: 30px;">
              <a href="https://digitaistudios.com/${lang}/dashboard/audits/${data.id}" style="background: #6366f1; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block;">
                Veure Informe Complet
              </a>
            </p>
            <p style="font-size: 12px; color: #666; margin-top: 40px;">
              Â© DigitAI Studios. Si no has demanat aixÃ², ignora aquest correu.
            </p>
          </div>
        `
      });
    } catch (error) {
      console.error("Resend Error:", error);
    }
  }
}

// =================== FILE: src/services/PostService.ts ===================

import { IPostRepository } from '@/repositories/interfaces/IPostRepository';
import { BlogPostDTO } from '@/types/models';

// âœ… NomÃ©s exportem la classe
export class PostService {
  constructor(private postRepo: IPostRepository) {}

  async getPost(slug: string): Promise<BlogPostDTO | null> {
    return this.postRepo.getPostBySlug(slug);
  }

  async getLatestPosts(): Promise<BlogPostDTO[]> {
    return this.postRepo.getAllPublishedPosts();
  }
}

// =================== FILE: src/types/database.types.ts ===================

export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "13.0.5"
  }
  public: {
    Tables: {
      analytics_events: {
        Row: {
          browser: string | null
          city: string | null
          country: string | null
          created_at: string | null
          device_type: string | null
          duration_seconds: number | null
          event_name: string
          id: number
          meta: Json | null
          os: string | null
          path: string | null
          referrer: string | null
          session_id: string
        }
        Insert: {
          browser?: string | null
          city?: string | null
          country?: string | null
          created_at?: string | null
          device_type?: string | null
          duration_seconds?: number | null
          event_name: string
          id?: never
          meta?: Json | null
          os?: string | null
          path?: string | null
          referrer?: string | null
          session_id: string
        }
        Update: {
          browser?: string | null
          city?: string | null
          country?: string | null
          created_at?: string | null
          device_type?: string | null
          duration_seconds?: number | null
          event_name?: string
          id?: never
          meta?: Json | null
          os?: string | null
          path?: string | null
          referrer?: string | null
          session_id?: string
        }
        Relationships: []
      }
      analytics_visitors: {
        Row: {
          country: string | null
          device_type: string | null
          first_seen_at: string | null
          last_seen_at: string | null
          referrer: string | null
          visitor_id: string
        }
        Insert: {
          country?: string | null
          device_type?: string | null
          first_seen_at?: string | null
          last_seen_at?: string | null
          referrer?: string | null
          visitor_id: string
        }
        Update: {
          country?: string | null
          device_type?: string | null
          first_seen_at?: string | null
          last_seen_at?: string | null
          referrer?: string | null
          visitor_id?: string
        }
        Relationships: []
      }
      contact_leads: {
        Row: {
          created_at: string
          email: string
          full_name: string
          id: string
          message: string
          service: string
          source: string | null
        }
        Insert: {
          created_at?: string
          email: string
          full_name: string
          id?: string
          message: string
          service: string
          source?: string | null
        }
        Update: {
          created_at?: string
          email?: string
          full_name?: string
          id?: string
          message?: string
          service?: string
          source?: string | null
        }
        Relationships: []
      }
      content_queue: {
        Row: {
          created_at: string | null
          generated_mdx: string | null
          id: string
          image_prompt: string | null
          prompt_context: string | null
          status: Database["public"]["Enums"]["content_status"] | null
          target_keywords: string[] | null
          topic: string
        }
        Insert: {
          created_at?: string | null
          generated_mdx?: string | null
          id?: string
          image_prompt?: string | null
          prompt_context?: string | null
          status?: Database["public"]["Enums"]["content_status"] | null
          target_keywords?: string[] | null
          topic: string
        }
        Update: {
          created_at?: string | null
          generated_mdx?: string | null
          id?: string
          image_prompt?: string | null
          prompt_context?: string | null
          status?: Database["public"]["Enums"]["content_status"] | null
          target_keywords?: string[] | null
          topic?: string
        }
        Relationships: []
      }
      posts: {
        Row: {
          content_mdx: string | null
          cover_image: string | null
          created_at: string | null
          description: string | null
          id: string
          published_at: string | null
          slug: string
          status: Database["public"]["Enums"]["post_status"] | null
          tags: string[] | null
          title: string
          updated_at: string | null
        }
        Insert: {
          content_mdx?: string | null
          cover_image?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          published_at?: string | null
          slug: string
          status?: Database["public"]["Enums"]["post_status"] | null
          tags?: string[] | null
          title: string
          updated_at?: string | null
        }
        Update: {
          content_mdx?: string | null
          cover_image?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          published_at?: string | null
          slug?: string
          status?: Database["public"]["Enums"]["post_status"] | null
          tags?: string[] | null
          title?: string
          updated_at?: string | null
        }
        Relationships: []
      }
      profiles: {
        Row: {
          avatar_url: string | null
          created_at: string | null
          email: string
          full_name: string | null
          id: string
          role: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id: string | null
          updated_at: string | null
        }
        Insert: {
          avatar_url?: string | null
          created_at?: string | null
          email: string
          full_name?: string | null
          id: string
          role?: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id?: string | null
          updated_at?: string | null
        }
        Update: {
          avatar_url?: string | null
          created_at?: string | null
          email?: string
          full_name?: string | null
          id?: string
          role?: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      projects: {
        Row: {
          client_id: string
          created_at: string | null
          domain: string | null
          features_enabled: Json | null
          hosting_url: string | null
          id: string
          name: string
          repository_url: string | null
          status: Database["public"]["Enums"]["project_status"] | null
        }
        Insert: {
          client_id: string
          created_at?: string | null
          domain?: string | null
          features_enabled?: Json | null
          hosting_url?: string | null
          id?: string
          name: string
          repository_url?: string | null
          status?: Database["public"]["Enums"]["project_status"] | null
        }
        Update: {
          client_id?: string
          created_at?: string | null
          domain?: string | null
          features_enabled?: Json | null
          hosting_url?: string | null
          id?: string
          name?: string
          repository_url?: string | null
          status?: Database["public"]["Enums"]["project_status"] | null
        }
        Relationships: [
          {
            foreignKeyName: "projects_client_id_fkey"
            columns: ["client_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      web_audits: {
        Row: {
          created_at: string | null
          email: string | null
          id: string
          performance_score: number | null
          report_data: Json | null
          seo_score: number | null
          status: Database["public"]["Enums"]["audit_status"] | null
          url: string
          user_id: string | null
          visitor_id: string | null
        }
        Insert: {
          created_at?: string | null
          email?: string | null
          id?: string
          performance_score?: number | null
          report_data?: Json | null
          seo_score?: number | null
          status?: Database["public"]["Enums"]["audit_status"] | null
          url: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Update: {
          created_at?: string | null
          email?: string | null
          id?: string
          performance_score?: number | null
          report_data?: Json | null
          seo_score?: number | null
          status?: Database["public"]["Enums"]["audit_status"] | null
          url?: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "web_audits_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      audit_status: "processing" | "completed" | "failed"
      content_status: "queued" | "generating" | "review" | "published"
      post_status: "draft" | "published" | "archived"
      project_status: "pending" | "active" | "maintenance" | "archived"
      user_role: "admin" | "client" | "lead"
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  public: {
    Enums: {
      audit_status: ["processing", "completed", "failed"],
      content_status: ["queued", "generating", "review", "published"],
      post_status: ["draft", "published", "archived"],
      project_status: ["pending", "active", "maintenance", "archived"],
      user_role: ["admin", "client", "lead"],
    },
  },
} as const


// =================== FILE: src/types/index.ts ===================

import { Database } from './database.types';

// Exportem el tipus base per als clients de Supabase
export type { Database };

// Helpers per tenir tipus nets als components
// En lloc d'escriure la ruta llarga, farÃ s servir 'Audit' o 'Profile'
export type Audit = Database['public']['Tables']['web_audits']['Row'];
export type NewAudit = Database['public']['Tables']['web_audits']['Insert']; // Per formularis
export type Profile = Database['public']['Tables']['profiles']['Row'];
export type Project = Database['public']['Tables']['projects']['Row'];

// Tipus per als Enums (molt Ãºtil per dropdowns)
export type UserRole = Database['public']['Enums']['user_role'];
export type AuditStatus = Database['public']['Enums']['audit_status'];
export type ContactLead = Database['public']['Tables']['contact_leads']['Row'];
export type BlogPost = Database['public']['Tables']['posts']['Row'];

// =================== FILE: src/types/models.ts ===================

// 1. DTO - AixÃ­ Ã©s com la nostra UI vol veure una auditoria (Tipatge net)
export type AuditDTO = {
  id: string;
  url: string;
  status: 'processing' | 'completed' | 'failed';
  seoScore: number | null; // CamelCase per JS
  performanceScore: number | null;
  createdAt: Date; // Objecte Date real, no string
  reportData: Record<string, unknown> | null;
};


export interface IAuditRepository {
  getAuditsByUserEmail(email: string): Promise<AuditDTO[]>;
  getAuditById(id: string): Promise<AuditDTO | null>;
  createAudit(url: string, email: string): Promise<AuditDTO>;
  
  updateStatus(
    id: string, 
    status: AuditDTO['status'], 
    results?: { 
      seoScore?: number; 
      performanceScore?: number; 
      // âœ… CoherÃ¨ncia de tipus
      reportData?: Record<string, unknown> 
    }
  ): Promise<void>;
}


// 1. DTO (Data Transfer Object): Com la teva UI vol veure les dades (camelCase, net)
export type BlogPostDTO = {
  slug: string;
  title: string;
  date: string | null;     // Mapejat des de published_at
  description: string | null;
  content: string | null;  // Mapejat des de content_mdx
  tags: string[];
  coverImage: string | null; // Mapejat des de cover_image
  published: boolean;
};

export type AnalyticsEventDTO = {
  event_name: string;
  path: string;
  session_id: string;
  // Dades que venen del client
  duration?: number; 
  referrer?: string;
  // Dades tÃ¨cniques (meta)
  meta?: Record<string, unknown>;
  // Dades que omplirem al servidor (Geo, Device)
  geo?: { country: string; city: string };
  device?: { type: string; browser: string; os: string };
};
