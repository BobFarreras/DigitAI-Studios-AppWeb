ESTRUCTURA DEL PROJECTE (./src)

â”œâ”€â”€ actions
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ api
â”‚   â”‚   â”œâ”€â”€ track
â”‚   â”‚   â””â”€â”€ web-audit
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ [locale]
â”‚       â”œâ”€â”€ (marketing)
â”‚       â”‚   â”œâ”€â”€ blog
â”‚       â”‚   â”‚   â””â”€â”€ [slug]
â”‚       â”‚   â””â”€â”€ page.tsx
â”‚       â”œâ”€â”€ auth
â”‚       â”‚   â”œâ”€â”€ callback
â”‚       â”‚   â”‚   â””â”€â”€ route.ts
â”‚       â”‚   â”œâ”€â”€ login
â”‚       â”‚   â””â”€â”€ register
â”‚       â”‚       â””â”€â”€ page.tsx
â”‚       â”œâ”€â”€ dashboard
â”‚       â”‚   â”œâ”€â”€ audits
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â”‚   â””â”€â”€ [id]
â”‚       â”‚   â”‚       â””â”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â””â”€â”€ page.tsx
â”‚       â””â”€â”€ layout.tsx
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ auth
â”‚   â””â”€â”€ ui
â”‚       â”œâ”€â”€ button.tsx
â”‚       â”œâ”€â”€ card.tsx
â”‚       â””â”€â”€ input.tsx
â”œâ”€â”€ domain
â”œâ”€â”€ features
â”‚   â”œâ”€â”€ auth
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â””â”€â”€ RegisterForm.tsx
â”‚   â””â”€â”€ web-audit
â”‚       â”œâ”€â”€ actions.ts
â”‚       â””â”€â”€ ui
â”‚           â””â”€â”€ AuditForm.tsx
â”œâ”€â”€ i18n
â”‚   â””â”€â”€ request.ts
â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ mock-audit.ts
â”‚   â”œâ”€â”€ supabase
â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”œâ”€â”€ middleware.ts
â”‚   â”‚   â””â”€â”€ server.ts
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ validations
â”œâ”€â”€ proxy.ts
â”œâ”€â”€ repositories
â”‚   â”œâ”€â”€ interfaces
â”‚   â”‚   â””â”€â”€ IAuditRepository.ts
â”‚   â””â”€â”€ supabase
â”‚       â””â”€â”€ SupabaseAuditRepository.ts
â”œâ”€â”€ routing.ts
â”œâ”€â”€ services
â”‚   â””â”€â”€ container.ts
â””â”€â”€ types
    â”œâ”€â”€ database.types.ts
    â”œâ”€â”€ index.ts
    â””â”€â”€ models.ts


CONTINGUT DELS FITXERS


// =================== FILE: src/app/globals.css ===================

@import "tailwindcss";

/* Definim les variables de colors semÃ ntics.
  AixÃ­, si demÃ  vols canviar el color de marca, nomÃ©s toques aquÃ­.
*/
:root {
  --background: 0 0% 100%;
  --foreground: 240 10% 3.9%;

  --primary: 240 5.9% 10%;
  --primary-foreground: 0 0% 98%;

  --secondary: 240 4.8% 95.9%;
  --secondary-foreground: 240 5.9% 10%;

  --muted: 240 4.8% 95.9%;
  --muted-foreground: 240 3.8% 46.1%;

  --accent: 240 4.8% 95.9%;
  --accent-foreground: 240 5.9% 10%;

  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 0 0% 98%;

  --border: 240 5.9% 90%;
  --input: 240 5.9% 90%;
  --ring: 240 5.9% 10%;
  --radius: 0.5rem;
}

@theme inline {
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);
}

body {
  @apply bg-background text-foreground antialiased;
}

// =================== FILE: src/app/layout.tsx ===================

// FILE: src/app/layout.tsx
import { ReactNode } from 'react';

type Props = {
  children: ReactNode;
};

// Aquest layout ha de ser "invisible". 
// Next.js es queixarÃ  si li falta <html> en desenvolupament, 
// perÃ² com que el middleware redirigeix sempre a /[locale], mai es veurÃ .
export default function RootLayout({ children }: Props) {
  return children;
}

// =================== FILE: src/app/[locale]/(marketing)/page.tsx ===================

import { useTranslations } from 'next-intl';
import { AuditForm } from '@/features/web-audit/ui/AuditForm';

export default function MarketingPage() {
  const t = useTranslations('HomePage');

  return (
    <div className="flex min-h-screen flex-col items-center justify-center p-24 bg-gradient-to-b from-background to-secondary/20">
      <div className="text-center space-y-4 mb-8">
        <h1 className="text-5xl font-bold tracking-tight">{t('title')}</h1>
        <p className="text-muted-foreground text-xl">
          Descobreix errors de SEO i performance amb IA.
        </p>
      </div>

      {/* AquÃ­ injectem el formulari intelÂ·ligent */}
      <AuditForm />
    </div>
  );
}

// =================== FILE: src/app/[locale]/auth/callback/route.ts ===================

import { NextResponse } from 'next/server'
// El client de servidor que hem creat abans
import { createClient } from '@/lib/supabase/server'

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')
  // si tenim un parÃ metre "next", el fem servir per redirigir
  const next = searchParams.get('next') ?? '/dashboard'

  if (code) {
    const supabase = await createClient()
    const { error } = await supabase.auth.exchangeCodeForSession(code)
    
    if (!error) {
      // Si tot ha anat bÃ©, redirigim a l'usuari cap al dashboard (o on volguÃ©s anar)
      // Afegim el locale per defecte si cal, o detectem.
      // Per ara hardcodegem 'ca', perÃ² l'ideal seria guardar-ho en cookie abans.
      return NextResponse.redirect(`${origin}/ca${next}`)
    }
  }

  // Si hi ha error, tornem al login amb un missatge
  return NextResponse.redirect(`${origin}/ca/auth/login?error=auth-code-error`)
}

// =================== FILE: src/app/[locale]/auth/register/page.tsx ===================

import { getTranslations } from 'next-intl/server'; // ğŸ‘ˆ Canvi clau: importem del server
import { Link } from '@/routing';
import { RegisterForm } from '@/features/auth/ui/RegisterForm';

type Props = {
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
};

export default async function RegisterPage({ searchParams }: Props) {
  // 1. Fem servir await getTranslations en lloc del hook
  const t = await getTranslations('Auth');
  
  // 2. Resolem els parÃ metres (Next.js 16)
  const params = await searchParams;
  const emailParam = typeof params.email === 'string' ? params.email : '';

  return (
    <div className="flex min-h-screen items-center justify-center bg-muted/20 px-4 py-12">
      <div className="w-full max-w-md space-y-6">
        <div className="text-center">
          <h1 className="text-3xl font-bold tracking-tight">{t('register_title')}</h1>
          <p className="mt-2 text-sm text-muted-foreground">
            {t('register_subtitle')}
          </p>
        </div>

        <RegisterForm prefilledEmail={emailParam} />

        <p className="text-center text-sm text-muted-foreground">
          {t('already_have_account')}{' '}
          <Link href="/auth/login" className="font-medium text-primary hover:underline">
            {t('login_link')}
          </Link>
        </p>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/audits/page.tsx ===================

import { getTranslations, getLocale } from 'next-intl/server'; // Afegim getLocale
import { Link } from '@/routing';
import { redirect } from 'next/navigation'; // ğŸ‘ˆ CANVI CLAU: Usem el natiu
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Plus } from 'lucide-react';
import { createClient } from '@/lib/supabase/server'; 
import { auditRepository } from '@/services/container';

export default async function AuditsListPage() {
  const t = await getTranslations('Dashboard');
  const locale = await getLocale(); // Necessitem saber l'idioma per redirigir manualment
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();

  // âœ… SOLUCIÃ“: RedirecciÃ³ nativa amb return implÃ­cit (Next.js sap que redirect llanÃ§a error)
  if (!user || !user.email) {
    redirect(`/${locale}/auth/login`); 
  }

  // Ara TypeScript sap segur que user.email Ã©s un string perquÃ¨ si no, hauria petat a dalt
  const audits = await auditRepository.getAuditsByUserEmail(user.email);

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold">{t('my_audits')}</h1>
          <p className="text-muted-foreground mt-1">
            HistÃ²ric complet.
          </p>
        </div>
        <Link href="/">
          <Button>
            <Plus className="mr-2 h-4 w-4" /> Nova Auditoria
          </Button>
        </Link>
      </div>

      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {audits.map((audit) => (
          <Link key={audit.id} href={`/dashboard/audits/${audit.id}`} className="block transition-transform hover:scale-[1.02]">
            <Card className="h-full">
              <CardHeader>
                <CardTitle className="text-lg truncate" title={audit.url}>
                  {audit.url}
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex justify-between items-center mt-2">
                  <span className={`px-2 py-1 rounded text-xs uppercase font-bold tracking-wide ${
                    audit.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                  }`}>
                    {audit.status}
                  </span>
                  <span className="text-sm text-slate-500">
                    {audit.createdAt.toLocaleDateString()}
                  </span>
                </div>
                {audit.status === 'completed' && audit.seoScore !== null && (
                   <div className="mt-4 flex gap-2 text-sm font-medium">
                      <span className="text-slate-600">SEO: <span className="text-black">{audit.seoScore}</span></span>
                   </div>
                )}
              </CardContent>
            </Card>
          </Link>
        ))}

        {audits.length === 0 && (
          <div className="col-span-full py-12 text-center border-2 border-dashed rounded-lg">
            <p className="text-slate-500 mb-4">No tens auditories.</p>
          </div>
        )}
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/audits/[id]/page.tsx ===================

import { notFound } from 'next/navigation';
import { createClient } from '@/lib/supabase/server';
import { getTranslations } from 'next-intl/server';
import { Link } from '@/routing';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from 'lucide-react'; // O el teu component de UI
import { MOCK_REPORT } from '@/lib/mock-audit';

type Props = {
  params: Promise<{ id: string; locale: string }>;
};

export default async function AuditDetailsPage({ params }: Props) {
  const { id } = await params;
  const supabase = await createClient();
  const t = await getTranslations('Dashboard');

  // 1. Obtenim les dades de l'auditoria
  const { data: audit, error } = await supabase
    .from('web_audits')
    .select('*')
    .eq('id', id)
    .single();

  if (error || !audit) {
    notFound();
  }

  // 2. SIMULACIÃ“: Si estÃ  "processing", la completem automÃ ticament
  // (En producciÃ³, aixÃ² ho faria una Edge Function en background)
  let report = audit.report_data as typeof MOCK_REPORT | null;
  
  if (audit.status === 'processing') {
    // Actualitzem la DB per fer veure que s'ha acabat
    await supabase.from('web_audits').update({
      status: 'completed',
      seo_score: MOCK_REPORT.scores.seo,
      performance_score: MOCK_REPORT.scores.performance,
      report_data: MOCK_REPORT
    }).eq('id', id);
    
    report = MOCK_REPORT; // Usem les dades mockejades per renderitzar ara
  }

  return (
    <div className="space-y-6">
      {/* CapÃ§alera */}
      <div className="flex items-center justify-between">
        <div>
          <Link href="/dashboard" className="text-sm text-muted-foreground hover:underline">
            â† Tornar al llistat
          </Link>
          <h1 className="text-3xl font-bold mt-2">Informe: {audit.url}</h1>
        </div>
        <Button variant="outline">Descarregar PDF</Button>
      </div>

      {/* Targetes de PuntuaciÃ³ (Score Cards) */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <ScoreCard title="SEO" score={report?.scores.seo ?? 0} />
        <ScoreCard title="Performance" score={report?.scores.performance ?? 0} />
        <ScoreCard title="Accessibilitat" score={report?.scores.accessibility ?? 0} />
        <ScoreCard title="Best Practices" score={report?.scores.best_practices ?? 0} />
      </div>

      {/* Detalls dels errors */}
      <div className="grid md:grid-cols-3 gap-6">
        <Card className="md:col-span-2">
          <CardHeader>
            <CardTitle>Problemes Detectats</CardTitle>
          </CardHeader>
          <CardContent>
            <ul className="space-y-4">
              {report?.issues.map((issue, i) => (
                <li key={i} className="flex items-start gap-3 p-3 border rounded-lg">
                  <span className={`w-3 h-3 mt-1.5 rounded-full ${
                    issue.type === 'error' ? 'bg-red-500' : 
                    issue.type === 'warning' ? 'bg-yellow-500' : 'bg-green-500'
                  }`} />
                  <div>
                    <p className="font-medium">{issue.message}</p>
                    <p className="text-xs text-muted-foreground uppercase">{issue.impact} impact</p>
                  </div>
                </li>
              ))}
            </ul>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Tecnologies</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="flex flex-wrap gap-2">
              {report?.technologies.map((tech) => (
                <span key={tech} className="px-2 py-1 bg-slate-100 rounded text-sm font-medium text-slate-700">
                  {tech}
                </span>
              ))}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

// Petit component auxiliar per les puntuacions
function ScoreCard({ title, score }: { title: string; score: number }) {
  // Color segons la nota
  const colorClass = score >= 90 ? 'text-green-600' : score >= 50 ? 'text-yellow-600' : 'text-red-600';
  
  return (
    <Card>
      <CardContent className="pt-6 text-center">
        <div className={`text-4xl font-bold ${colorClass}`}>{score}</div>
        <div className="text-sm text-muted-foreground mt-1">{title}</div>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/app/[locale]/dashboard/layout.tsx ===================

import { createClient } from '@/lib/supabase/server';
import { getTranslations } from 'next-intl/server';
import { Link } from '@/routing'; // ğŸ‘ˆ IMPORTANT: Importar del nostre routing, no de next/link
import { redirect } from 'next/navigation'; // ğŸ‘ˆ Usar el redirect natiu Ã©s mÃ©s segur en Server Components

type Props = {
  children: React.ReactNode;
  params: Promise<{ locale: string }>; // ğŸ‘ˆ Necessitem saber l'idioma
};

export default async function DashboardLayout({
  children,
  params
}: Props) {
  const { locale } = await params; // Resolem la promesa
  const supabase = await createClient();
  const t = await getTranslations('Dashboard');

  // 1. VerificaciÃ³ de SessiÃ³ al Servidor
  const { data: { user }, error } = await supabase.auth.getUser();

  if (error || !user) {
    // RedirecciÃ³ manual incloent l'idioma
    redirect(`/${locale}/auth/login`);
  }

  return (
    <div className="flex min-h-screen flex-col md:flex-row">
      {/* Sidebar */}
      <aside className="w-full md:w-64 bg-slate-900 text-white p-6 flex flex-col">
        <div className="font-bold text-xl mb-8">DigitAI Studios</div>
        <nav className="flex flex-col gap-4">
          <Link href="/dashboard" className="hover:text-slate-300">Resum</Link>
          <Link href="/dashboard/audits" className="hover:text-slate-300 font-bold text-blue-400">
            {t('my_audits')}
          </Link>
          {/* Exemple de ruta futura */}
          <button className="text-left hover:text-slate-300 text-slate-500 cursor-not-allowed">
            ConfiguraciÃ³ (Aviat)
          </button>
          
          <form action="/auth/signout" method="post" className="mt-auto">
            <button className="text-sm text-slate-400 hover:text-white w-full text-left">
              Tancar SessiÃ³
            </button>
          </form>
        </nav>
      </aside>

      {/* Contingut Principal */}
      <main className="flex-1 bg-slate-50 p-8">
        {children}
      </main>
    </div>
  );
}

// =================== FILE: src/app/[locale]/dashboard/page.tsx ===================

import { createClient } from '@/lib/supabase/server';
import { getTranslations } from 'next-intl/server';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { redirect } from 'next/navigation';
import { Link } from '@/routing';
export default async function DashboardPage() {
    const supabase = await createClient();
    const t = await getTranslations('Dashboard');

    // Obtenim l'usuari actual
    const { data: { user } } = await supabase.auth.getUser();

    // ProtecciÃ³ extra per TypeScript (encara que el layout ja ho fa)
    if (!user || !user.email) {
        redirect('/');
    }

    // Consultem les auditories
    const { data: audits } = await supabase
        .from('web_audits') // Ara els tipus funcionaran bÃ©
        .select('*')
        .eq('email', user.email) // ğŸ‘ˆ Ara Ã©s segur perquÃ¨ hem fet el check a dalt
        .order('created_at', { ascending: false });

    return (
        <div className="space-y-6">
            {/* ğŸ‘ˆ Usem ?? '' per si de cas, per evitar l'error de tipatge */}
            <h1 className="text-3xl font-bold">{t('welcome', { name: user.email ?? 'Client' })}</h1>

            <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                {audits?.map((audit) => (
                    // Embolcallem la Card amb el Link
                    <Link key={audit.id} href={`/dashboard/audits/${audit.id}`} className="block transition-transform hover:scale-[1.02]">
                        <Card>
                            <CardHeader>
                                <CardTitle className="text-lg truncate" title={audit.url}>
                                    {audit.url}
                                </CardTitle>
                            </CardHeader>
                            <CardContent>
                                {/* ... el mateix contingut d'abans ... */}
                                <div className="flex justify-between items-center">
                                    <span className={`px-2 py-1 rounded text-xs ${audit.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                        }`}>
                                        {audit.status}
                                    </span>
                                    {/* Mostrar puntuaciÃ³ si existeix */}
                                    {audit.seo_score && (
                                        <span className="font-bold text-slate-700">SEO: {audit.seo_score}</span>
                                    )}
                                </div>
                            </CardContent>
                        </Card>
                    </Link>
                ))}

                {(!audits || audits.length === 0) && (
                    <p className="text-slate-500 col-span-3 text-center py-10">
                        Encara no tens cap auditoria registrada.
                    </p>
                )}
            </div>
        </div>
    );
}

// =================== FILE: src/app/[locale]/layout.tsx ===================

import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';
import { notFound } from 'next/navigation';
// Ara utilitzem @/routing grÃ cies al canvi del tsconfig
import { routing, type Locale } from '@/routing'; 

// âœ… SOLUCIÃ“ DEFINITIVA: Import absolut
// AixÃ² buscarÃ  sempre a src/app/globals.css, sense importar on moguis aquest fitxer
import "@/app/globals.css"; 

export default async function LocaleLayout({
  children,
  params
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  const { locale } = await params;

  if (!routing.locales.includes(locale as Locale)) {
    notFound();
  }

  const messages = await getMessages();

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}

// =================== FILE: src/components/ui/button.tsx ===================

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

// DefiniciÃ³ de les variants de disseny
const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, ...props }, ref) => {
    return (
      <button
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

// =================== FILE: src/components/ui/card.tsx ===================

import * as React from "react"
import { cn } from "@/lib/utils"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)} {...props} />
  )
)
Card.displayName = "Card"

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  )
)
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3 ref={ref} className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props} />
  )
)
CardTitle.displayName = "CardTitle"

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
  )
)
CardContent.displayName = "CardContent"

export { Card, CardHeader, CardTitle, CardContent }

// =================== FILE: src/components/ui/input.tsx ===================

import * as React from "react"
import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.InputHTMLAttributes<HTMLInputElement>>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

// =================== FILE: src/features/auth/ui/RegisterForm.tsx ===================

'use client'

import { useState } from 'react';
import { useTranslations } from 'next-intl';
import { useRouter } from '@/routing'; // ğŸ‘ˆ Important: Fem servir el router de next-intl
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent } from '@/components/ui/card';
import { createClient } from '@/lib/supabase/client';
import { Loader2 } from 'lucide-react';

export function RegisterForm({ prefilledEmail }: { prefilledEmail: string }) {
  const t = useTranslations('Auth');
  const router = useRouter(); // Per redirigir
  const [isLoading, setIsLoading] = useState(false);
  const [email, setEmail] = useState(prefilledEmail);
  const [password, setPassword] = useState('');
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);

    const supabase = createClient();

    // Com que has desactivat "Confirm Email" a Supabase,
    // aixÃ² retorna una sessiÃ³ vÃ lida immediatament!
    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: email.split('@')[0],
        }
      }
    });

    if (error) {
      setError(error.message);
      setIsLoading(false);
    } else {
      // âœ… ÃˆXIT: Redirigim directament al Dashboard
      // Refresquem el router per actualitzar les cookies de sessiÃ³ al servidor
      router.refresh(); 
      router.push('/dashboard'); 
    }
  };

  return (
    <Card>
      <CardContent className="pt-6">
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <label className="text-sm font-medium leading-none" htmlFor="email">Email</label>
            <Input 
              id="email" 
              type="email" 
              value={email} 
              onChange={(e) => setEmail(e.target.value)}
              required 
            />
          </div>
          <div className="space-y-2">
            <label className="text-sm font-medium leading-none" htmlFor="password">Password</label>
            <Input 
              id="password" 
              type="password" 
              value={password} 
              onChange={(e) => setPassword(e.target.value)}
              required 
              minLength={6}
            />
          </div>

          {error && (
            <p className="text-sm text-red-500">{error}</p>
          )}

          <Button type="submit" className="w-full" disabled={isLoading}>
            {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            {t('cta_register')}
          </Button>
        </form>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/features/web-audit/actions.ts ===================

'use server'

import { z } from 'zod';
import { redirect } from 'next/navigation';
import { getLocale } from 'next-intl/server';
// ğŸ‘‡ Importem el repositori des del container
import { auditRepository } from '@/services/container';

// Esquema de validaciÃ³
const AuditSchema = z.object({
  url: z.string().url({ message: "La URL ha de ser vÃ lida (https://...)" }),
  email: z.string().email({ message: "L'email no Ã©s correcte" }),
});

export type FormState = {
  message?: string;
  errors?: {
    url?: string[];
    email?: string[];
  };
};

export async function processWebAudit(prevState: FormState, formData: FormData): Promise<FormState> {
  const locale = await getLocale();

  const rawData = {
    url: formData.get('url'),
    email: formData.get('email'),
  };

  const validation = AuditSchema.safeParse(rawData);

  if (!validation.success) {
    return {
      errors: validation.error.flatten().fieldErrors,
      message: "Revisa les dades del formulari.",
    };
  }

  try {
    // ğŸ‘‡ ARA USEM EL REPOSITORI (Codi net!)
    // Ja no cal fer createClient() ni saber que usem Supabase
    await auditRepository.createAudit(validation.data.url, validation.data.email);
    console.log("ACCION REBUDA AL SERVIDOR:", validation.data);
  } catch (err) {
    console.error(err);
    return { message: "Error al guardar la solÂ·licitud. Torna-ho a provar." };
  }

  // RedirecciÃ³
  redirect(`/${locale}/auth/register?email=${encodeURIComponent(validation.data.email)}`);
}

// =================== FILE: src/features/web-audit/ui/AuditForm.tsx ===================

'use client'

import { useActionState } from 'react';
import { useTranslations } from 'next-intl';
import { processWebAudit } from '../actions';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export function AuditForm() {
  const t = useTranslations('HomePage'); // Assegura't que tens les claus al JSON
  
  // Hook de Next.js 16 / React 19 per gestionar Server Actions
  const [state, action, isPending] = useActionState(processWebAudit, {
    message: '',
    errors: {}
  });

  return (
    <Card className="w-full max-w-md mx-auto mt-8 shadow-lg">
      <CardHeader>
        <CardTitle className="text-center">{t('form_title')}</CardTitle>
      </CardHeader>
      <CardContent>
        <form action={action} className="space-y-4">
          
          {/* Camp URL */}
          <div className="space-y-2">
            <Input 
              name="url" 
              placeholder="https://la-teva-web.com" 
              disabled={isPending}
              className={state.errors?.url ? "border-red-500" : ""}
            />
            {state.errors?.url && (
              <p className="text-sm text-red-500">{state.errors.url[0]}</p>
            )}
          </div>

          {/* Camp Email */}
          <div className="space-y-2">
            <Input 
              name="email" 
              type="email" 
              placeholder="el-teu@email.com" 
              disabled={isPending}
              className={state.errors?.email ? "border-red-500" : ""}
            />
             {state.errors?.email && (
              <p className="text-sm text-red-500">{state.errors.email[0]}</p>
            )}
          </div>

          {/* Missatge d'error general */}
          {state.message && (
            <p className="text-sm text-red-500 text-center">{state.message}</p>
          )}

          <Button type="submit" className="w-full" disabled={isPending}>
            {isPending ? 'Analitzant...' : t('cta')}
          </Button>
        </form>
      </CardContent>
    </Card>
  );
}

// =================== FILE: src/i18n/request.ts ===================

import { getRequestConfig } from 'next-intl/server';
import { notFound } from 'next/navigation';
import { routing, type Locale } from '@/routing'; // ğŸ‘ˆ IMPORTEM DE LA FONT ÃšNICA

export default getRequestConfig(async ({ requestLocale }) => {
  const locale = await requestLocale;

  // Ara validem contra la configuraciÃ³ centralitzada
  // AixÃ­ no hem de mantenir dues llistes d'idiomes
  if (!locale || !routing.locales.includes(locale as Locale)) {
    notFound();
  }

  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});

// =================== FILE: src/lib/mock-audit.ts ===================

// Dades falses per poder dissenyar la UI de l'informe
export const MOCK_REPORT = {
  scores: {
    seo: 85,
    performance: 62,
    accessibility: 90,
    best_practices: 75
  },
  issues: [
    { type: 'error', message: 'Falta l\'etiqueta H1 a la pÃ gina principal', impact: 'high' },
    { type: 'warning', message: 'Imatges sense atribut ALT detectades', impact: 'medium' },
    { type: 'success', message: 'Certificat SSL vÃ lid i actiu', impact: 'none' }
  ],
  technologies: ['Next.js', 'Tailwind CSS', 'Vercel']
};

// =================== FILE: src/lib/supabase/client.ts ===================

import { createBrowserClient } from '@supabase/ssr'
// ğŸ‘‡ Importa els tipus
import { Database } from '@/types/database.types' 

export function createClient() {
  // ğŸ‘‡ Afegeix el genÃ¨ric <Database> aquÃ­
  return createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}

// =================== FILE: src/lib/supabase/middleware.ts ===================

import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'
import { Database } from '@/types/database.types'

// ğŸ‘‡ Afegeix el genÃ¨ric <Database> aquÃ­
export async function updateSession(
  request: NextRequest, 
  response: NextResponse // âœ… Rebem la resposta del i18n
) {
  const supabase = createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            request.cookies.set(name, value)
            response.cookies.set(name, value, options)
          })
        },
      },
    }
  )

  // AixÃ² refresca el token si Ã©s necessari
  const { data: { user } } = await supabase.auth.getUser()

  // ğŸ›¡ï¸ PROTECCIÃ“ DE RUTES
  // Si intenta accedir a /dashboard sense usuari -> Login
  if (request.nextUrl.pathname.includes('/dashboard') && !user) {
    // Detectem el locale actual de la URL per redirigir al login correcte
    const locale = request.nextUrl.pathname.split('/')[1] || 'ca';
    const loginUrl = request.nextUrl.clone()
    loginUrl.pathname = `/${locale}/auth/login`
    return NextResponse.redirect(loginUrl)
  }

  return response
}

// =================== FILE: src/lib/supabase/server.ts ===================

import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
// ğŸ‘‡ Importem el client bÃ sic tambÃ©
import { createClient as createSupabaseClient } from '@supabase/supabase-js'
import { Database } from '@/types/database.types'

export async function createClient() {
  const cookieStore = await cookies()

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() { return cookieStore.getAll() },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch { }
        },
      },
    }
  )
}

// ğŸ‘‡ NOVA FUNCIÃ“: Client Admin (Bypass RLS)
// Aquest client NO fa servir cookies, fa servir la clau secreta
export function createAdminClient() {
  return createSupabaseClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!, // <--- Aquesta clau Ã©s CRÃTICA
    {
      auth: {
        autoRefreshToken: false,
        persistSession: false
      }
    }
  )
}

// =================== FILE: src/lib/utils.ts ===================

import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

/**
 * Combina classes de CSS de manera intelÂ·ligent.
 * Soluciona conflictes de Tailwind automÃ ticament.
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

// =================== FILE: src/proxy.ts ===================

import createMiddleware from 'next-intl/middleware';
import { routing } from '@/routing'; // ğŸ‘ˆ IMPORTEM CONFIG
import { updateSession } from '@/lib/supabase/middleware';
import { NextRequest } from 'next/server';

const intlMiddleware = createMiddleware(routing); // ğŸ‘ˆ LI PASSEM LA CONFIG

export async function proxy(request: NextRequest) {
  // 1. Next-intl fa la feina de routing (idiomes)
  const response = intlMiddleware(request);

  // 2. Supabase fa la feina de sessiÃ³
  return await updateSession(request, response);
}

export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};

// =================== FILE: src/repositories/interfaces/IAuditRepository.ts ===================

import { AuditDTO } from '@/types/models';

export interface IAuditRepository {
  getAuditsByUserEmail(email: string): Promise<AuditDTO[]>;
  getAuditById(id: string): Promise<AuditDTO | null>;
  createAudit(url: string, email: string): Promise<AuditDTO>;
  updateStatus(id: string, status: AuditDTO['status'], data?: Record<string, unknown>): Promise<void>;
}

// =================== FILE: src/repositories/supabase/SupabaseAuditRepository.ts ===================

import { createClient, createAdminClient } from '@/lib/supabase/server'; // ğŸ‘ˆ Importa l'Admin
import { IAuditRepository } from '../interfaces/IAuditRepository';
import { AuditDTO } from '@/types/models';
import { Database } from '@/types/database.types';

type AuditRow = Database['public']['Tables']['web_audits']['Row'];

export class SupabaseAuditRepository implements IAuditRepository {
  
  private mapToDTO(row: AuditRow): AuditDTO {
    // ... (el mateix codi de mapToDTO que tenies)
    return {
      id: row.id,
      url: row.url,
      status: row.status as AuditDTO['status'],
      seoScore: row.seo_score,
      performanceScore: row.performance_score,
      createdAt: row.created_at ? new Date(row.created_at) : new Date(),
      reportData: row.report_data,
    };
  }

  // ... (getAuditsByUserEmail i getAuditById es queden igual, usant createClient normal)
  async getAuditsByUserEmail(email: string): Promise<AuditDTO[]> {
      const supabase = await createClient(); // Client normal (respecta RLS)
      // ... resta del codi
      const { data, error } = await supabase.from('web_audits').select('*').eq('email', email).order('created_at', { ascending: false });
      if (error) throw new Error(error.message);
      return data.map(this.mapToDTO);
  }

  async getAuditById(id: string): Promise<AuditDTO | null> {
      const supabase = await createClient(); // Client normal
      // ... resta del codi
      const { data } = await supabase.from('web_audits').select('*').eq('id', id).single();
      return data ? this.mapToDTO(data) : null;
  }

  // ğŸ‘‡ AQUÃ ESTÃ€ LA MÃ€GIA I ELS CONSOLES
  async createAudit(url: string, email: string): Promise<AuditDTO> {
    console.log(`[Repo] Creant auditoria per: ${email} - URL: ${url}`);
    
    // Usem el CLIENT ADMIN per saltar-nos la restricciÃ³ de lectura
    const supabaseAdmin = createAdminClient();
    
    const { data, error } = await supabaseAdmin
      .from('web_audits')
      .insert({
        url,
        email,
        status: 'processing'
      })
      .select()
      .single();

    if (error) {
      console.error('[Repo] Error Supabase:', error); // Log d'error
      throw new Error(`Error creating audit: ${error.message}`);
    }
    
    console.log('[Repo] Auditoria creada OK:', data.id); // Log d'Ã¨xit
    return this.mapToDTO(data);
  }

  async updateStatus(id: string, status: AuditDTO['status'], data?: AuditDTO['reportData']): Promise<void> {
     // Aquest tambÃ© pot necessitar Admin si l'actualitza un worker, 
     // perÃ² si ho fa l'usuari, usa createClient()
     const supabaseAdmin = createAdminClient(); 
     await supabaseAdmin.from('web_audits').update({
        status: status,
        report_data: data as Database['public']['Tables']['web_audits']['Row']['report_data'] // type assertion to Json | undefined
     }).eq('id', id);
  }
}

// =================== FILE: src/routing.ts ===================

import { defineRouting } from 'next-intl/routing';
import { createNavigation } from 'next-intl/navigation';

export const routing = defineRouting({
  locales: ['ca', 'es', 'en'],
  defaultLocale: 'ca',
  localePrefix: 'as-needed' // Opcional: per si vols /ca o no
});

// Exportem tipus per a reutilitzar
export type Locale = (typeof routing.locales)[number];

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);

// =================== FILE: src/services/container.ts ===================

import { SupabaseAuditRepository } from '@/repositories/supabase/SupabaseAuditRepository';

// Singleton bÃ sic per a Next.js App Router
export const auditRepository = new SupabaseAuditRepository();

// Si en el futur tens un AuthService, el poses aquÃ­:
// export const authService = new AuthService();

// =================== FILE: src/types/database.types.ts ===================

export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "13.0.5"
  }
  public: {
    Tables: {
      analytics_events: {
        Row: {
          created_at: string | null
          event_name: string
          id: number
          meta: Json | null
          path: string
          user_id: string | null
          visitor_id: string | null
        }
        Insert: {
          created_at?: string | null
          event_name: string
          id?: never
          meta?: Json | null
          path: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Update: {
          created_at?: string | null
          event_name?: string
          id?: never
          meta?: Json | null
          path?: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "analytics_events_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "analytics_events_visitor_id_fkey"
            columns: ["visitor_id"]
            isOneToOne: false
            referencedRelation: "analytics_visitors"
            referencedColumns: ["visitor_id"]
          },
        ]
      }
      analytics_visitors: {
        Row: {
          country: string | null
          device_type: string | null
          first_seen_at: string | null
          last_seen_at: string | null
          referrer: string | null
          visitor_id: string
        }
        Insert: {
          country?: string | null
          device_type?: string | null
          first_seen_at?: string | null
          last_seen_at?: string | null
          referrer?: string | null
          visitor_id: string
        }
        Update: {
          country?: string | null
          device_type?: string | null
          first_seen_at?: string | null
          last_seen_at?: string | null
          referrer?: string | null
          visitor_id?: string
        }
        Relationships: []
      }
      content_queue: {
        Row: {
          created_at: string | null
          generated_mdx: string | null
          id: string
          image_prompt: string | null
          prompt_context: string | null
          status: Database["public"]["Enums"]["content_status"] | null
          target_keywords: string[] | null
          topic: string
        }
        Insert: {
          created_at?: string | null
          generated_mdx?: string | null
          id?: string
          image_prompt?: string | null
          prompt_context?: string | null
          status?: Database["public"]["Enums"]["content_status"] | null
          target_keywords?: string[] | null
          topic: string
        }
        Update: {
          created_at?: string | null
          generated_mdx?: string | null
          id?: string
          image_prompt?: string | null
          prompt_context?: string | null
          status?: Database["public"]["Enums"]["content_status"] | null
          target_keywords?: string[] | null
          topic?: string
        }
        Relationships: []
      }
      profiles: {
        Row: {
          avatar_url: string | null
          created_at: string | null
          email: string
          full_name: string | null
          id: string
          role: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id: string | null
          updated_at: string | null
        }
        Insert: {
          avatar_url?: string | null
          created_at?: string | null
          email: string
          full_name?: string | null
          id: string
          role?: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id?: string | null
          updated_at?: string | null
        }
        Update: {
          avatar_url?: string | null
          created_at?: string | null
          email?: string
          full_name?: string | null
          id?: string
          role?: Database["public"]["Enums"]["user_role"] | null
          stripe_customer_id?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      projects: {
        Row: {
          client_id: string
          created_at: string | null
          domain: string | null
          features_enabled: Json | null
          hosting_url: string | null
          id: string
          name: string
          repository_url: string | null
          status: Database["public"]["Enums"]["project_status"] | null
        }
        Insert: {
          client_id: string
          created_at?: string | null
          domain?: string | null
          features_enabled?: Json | null
          hosting_url?: string | null
          id?: string
          name: string
          repository_url?: string | null
          status?: Database["public"]["Enums"]["project_status"] | null
        }
        Update: {
          client_id?: string
          created_at?: string | null
          domain?: string | null
          features_enabled?: Json | null
          hosting_url?: string | null
          id?: string
          name?: string
          repository_url?: string | null
          status?: Database["public"]["Enums"]["project_status"] | null
        }
        Relationships: [
          {
            foreignKeyName: "projects_client_id_fkey"
            columns: ["client_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      web_audits: {
        Row: {
          created_at: string | null
          email: string | null
          id: string
          performance_score: number | null
          report_data: Json | null
          seo_score: number | null
          status: Database["public"]["Enums"]["audit_status"] | null
          url: string
          user_id: string | null
          visitor_id: string | null
        }
        Insert: {
          created_at?: string | null
          email?: string | null
          id?: string
          performance_score?: number | null
          report_data?: Json | null
          seo_score?: number | null
          status?: Database["public"]["Enums"]["audit_status"] | null
          url: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Update: {
          created_at?: string | null
          email?: string | null
          id?: string
          performance_score?: number | null
          report_data?: Json | null
          seo_score?: number | null
          status?: Database["public"]["Enums"]["audit_status"] | null
          url?: string
          user_id?: string | null
          visitor_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "web_audits_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      audit_status: "processing" | "completed" | "failed"
      content_status: "queued" | "generating" | "review" | "published"
      project_status: "pending" | "active" | "maintenance" | "archived"
      user_role: "admin" | "client" | "lead"
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  public: {
    Enums: {
      audit_status: ["processing", "completed", "failed"],
      content_status: ["queued", "generating", "review", "published"],
      project_status: ["pending", "active", "maintenance", "archived"],
      user_role: ["admin", "client", "lead"],
    },
  },
} as const


// =================== FILE: src/types/index.ts ===================

import { Database } from './database.types';

// Exportem el tipus base per als clients de Supabase
export type { Database };

// Helpers per tenir tipus nets als components
// En lloc d'escriure la ruta llarga, farÃ s servir 'Audit' o 'Profile'
export type Audit = Database['public']['Tables']['web_audits']['Row'];
export type NewAudit = Database['public']['Tables']['web_audits']['Insert']; // Per formularis
export type Profile = Database['public']['Tables']['profiles']['Row'];
export type Project = Database['public']['Tables']['projects']['Row'];

// Tipus per als Enums (molt Ãºtil per dropdowns)
export type UserRole = Database['public']['Enums']['user_role'];
export type AuditStatus = Database['public']['Enums']['audit_status'];

// =================== FILE: src/types/models.ts ===================

// 1. DTO - AixÃ­ Ã©s com la nostra UI vol veure una auditoria (Tipatge net)
export type AuditDTO = {
  id: string;
  url: string;
  status: 'processing' | 'completed' | 'failed';
  seoScore: number | null; // CamelCase per JS
  performanceScore: number | null;
  createdAt: Date; // Objecte Date real, no string
  reportData: unknown; // O un tipus mÃ©s especÃ­fic si en tenim
};

// 2. Interface del Repository - El contracte
// AixÃ² permetrÃ  fer mocks per tests fÃ cilment
export interface IAuditRepository {
  getAuditsByUserEmail(email: string): Promise<AuditDTO[]>;
  getAuditById(id: string): Promise<AuditDTO | null>;
  createAudit(url: string, email: string): Promise<AuditDTO>;
  updateStatus(id: string, status: AuditDTO['status'], data?: unknown): Promise<void>;
}